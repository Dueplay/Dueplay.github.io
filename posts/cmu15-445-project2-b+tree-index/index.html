<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CMU15-445 Project2 B&#43;Tree Index | Cookie&#39;s Blog</title>
<meta name="keywords" content="Database">
<meta name="description" content="Building a Concurrent B&#43;Tree Index.">
<meta name="author" content="Me">
<link rel="canonical" href="https://canonical.url/to/page">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js" integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="apple-touch-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<link rel="mask-icon" href="http://localhost:1313/%3Clink%20/%20abs%20url%3E">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/cmu15-445-project2-b&#43;tree-index/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-4XHWHM02GB"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-4XHWHM02GB', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="CMU15-445 Project2 B&#43;Tree Index" />
<meta property="og:description" content="Building a Concurrent B&#43;Tree Index." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/posts/cmu15-445-project2-b&#43;tree-index/" />
<meta property="og:image" content="http://localhost:1313/%3Cimage%20path/url%3E" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-01T20:10:29&#43;08:00" />
<meta property="article:modified_time" content="2022-11-01T20:10:29&#43;08:00" /><meta property="og:site_name" content="ExampleSite" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/%3Cimage%20path/url%3E" />
<meta name="twitter:title" content="CMU15-445 Project2 B&#43;Tree Index"/>
<meta name="twitter:description" content="Building a Concurrent B&#43;Tree Index."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CMU15-445 Project2 B+Tree Index",
      "item": "http://localhost:1313/posts/cmu15-445-project2-b+tree-index/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CMU15-445 Project2 B+Tree Index",
  "name": "CMU15-445 Project2 B\u002bTree Index",
  "description": "Building a Concurrent B+Tree Index.",
  "keywords": [
    "Database"
  ],
  "articleBody": "æ¥è®°å½•ä¸€ä¸‹ Bustub å™©æ¢¦ B+ æ ‘çš„å®ç°è¿‡ç¨‹ã€‚\nResources https://15445.courses.cs.cmu.edu/fall2022 è¯¾ç¨‹å®˜ç½‘ https://github.com/cmu-db/bustub Bustub Github Repo https://www.gradescope.com/ è‡ªåŠ¨æµ‹è¯„ç½‘ç«™ GradeScopeï¼Œcourse entry code: PXWVR5 https://discord.gg/YF7dMCg Discord è®ºå›ï¼Œè¯¾ç¨‹äº¤æµç”¨ bilibili æœ‰æ¬è¿çš„è¯¾ç¨‹è§†é¢‘ï¼Œè‡ªå¯»ã€‚ https://goneill.co.nz/btree-demo.php B+ æ ‘æ’å…¥åˆ é™¤çš„åŠ¨æ€æ¼”ç¤º è¯·ä¸è¦å°†å®ç°ä»£ç å…¬å¼€ï¼Œå°Šé‡ Andy å’Œ TAs çš„åŠ³åŠ¨æˆæœï¼\nOverview Project 2 éœ€è¦ä¸º Bustub å®ç° B+ æ ‘ç´¢å¼•ã€‚æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š\nCheckpoint1: å•çº¿ç¨‹ B+ æ ‘ Checkpoint2: å¤šçº¿ç¨‹ B+ æ ‘ å®éªŒä¸­ç»™å‡ºçš„ B+ æ ‘æ¥å£éå¸¸ç®€å•ï¼ŒåŸºæœ¬åªæœ‰æŸ¥è¯¢ã€æ’å…¥å’Œåˆ é™¤ä¸‰ä¸ªæ¥å£ï¼Œå†…éƒ¨åŸºæœ¬æ²¡æœ‰ç»™å‡ºåˆ«çš„è¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±å‘æŒ¥ï¼ˆæ— ä»ä¸‹æ‰‹ï¼‰ã€‚å› æ­¤ï¼Œä»»ä½•åˆæ³•çš„ B+ æ ‘å®ç°éƒ½æ˜¯å…è®¸çš„ã€‚\nB+ æ ‘ç´¢å¼•åœ¨ Bustub ä¸­çš„ä½ç½®å¦‚å›¾æ‰€ç¤ºï¼š\néœ€è¦ä½¿ç”¨æˆ‘ä»¬åœ¨ Project 1 ä¸­å®ç°çš„ buffer pool manager æ¥è·å– pageã€‚\nCheckpoint1 Single Thread B+Tree Checkpoint1 åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š\nTask1: B+Tree pagesï¼ŒB+æ ‘ä¸­çš„å„ç§ pageã€‚åœ¨ Bustub ç´¢å¼• B+ æ ‘ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ pageã€‚åŒ…å« leaf pageï¼Œinternal page ï¼Œå’Œå®ƒä»¬çš„çˆ¶ç±» tree pageã€‚ Task2ï¼šB+Tree Data Structure (Insertion, Deletion, Point Search)ã€‚Checkpoint1 çš„é‡ç‚¹ï¼Œå³ B+æ ‘çš„æ’å…¥ã€åˆ é™¤å’Œå•ç‚¹æŸ¥è¯¢ã€‚ Task1 B+Tree Pages Task1 çš„å®ç°éå¸¸ç®€å•ï¼Œéƒ½æ˜¯ä¸€äº›æ™®é€šçš„ Getter å’Œ Setterã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹ page çš„å†…å­˜å¸ƒå±€ã€‚\nåœ¨ Project 1 ä¸­æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸ page æ‰“äº¤é“ã€‚page å®é™…ä¸Šå¯ä»¥å­˜å‚¨æ•°æ®åº“å†…å¾ˆå¤šç§ç±»çš„æ•°æ®ã€‚ä¾‹å¦‚ç´¢å¼•å’Œå®é™…çš„è¡¨æ•°æ®ç­‰ç­‰ã€‚\n/** The actual data that is stored within a page. */ char data_[BUSTUB_PAGE_SIZE]{}; /** The ID of this page. */ page_id_t page_id_ = INVALID_PAGE_ID; /** The pin count of this page. */ int pin_count_ = 0; /** True if the page is dirty, i.e. it is different from its corresponding page on disk. */ bool is_dirty_ = false; /** Page latch. */ ReaderWriterLatch rwlatch_; å…¶ä¸­ï¼Œdata_ æ˜¯å®é™…å­˜æ”¾ page æ•°æ®çš„åœ°æ–¹ï¼Œå¤§å°ä¸º BUSTUB_PAGE_SIZEï¼Œä¸º 4KBã€‚å…¶ä»–çš„æˆå‘˜æ˜¯ page çš„ metadataã€‚\nB+æ ‘ä¸­çš„ tree age æ•°æ®å‡å­˜æ”¾åœ¨ page çš„ data æˆå‘˜ä¸­ã€‚\nB_PLUS_TREE_PAGE\nb_plus_tree_page æ˜¯å¦å¤–ä¸¤ä¸ª page çš„çˆ¶ç±»ï¼Œå³ B+æ ‘ä¸­ tree page çš„æŠ½è±¡ã€‚\nIndexPageType page_type_; // leaf or internal. 4 Byte lsn_t lsn_ // temporarily unused. 4 Byte int size_; // tree page data size(not in byte, in count). 4 Byte int max_size_; // tree page data max size(not in byte, in count). 4 Byte page_id_t parent_page_id_; // 4 Byte page_id_t page_id_; // 4 Byte // 24 Byte in total ä»¥ä¸Šæ•°æ®ç»„æˆäº† tree page çš„ headerã€‚\npage data çš„ 4KB ä¸­ï¼Œ24Byte ç”¨äºå­˜æ”¾ headerï¼Œå‰©ä¸‹çš„åˆ™ç”¨äºå­˜æ”¾ tree page çš„æ•°æ®ï¼Œå³ KV å¯¹ã€‚\nB_PLUS_TREE_INTERNAL_PAGE\nå¯¹åº” B+ æ ‘ä¸­çš„å†…éƒ¨èŠ‚ç‚¹ã€‚\nMappingType array_[1]; internal page ä¸­æ²¡æœ‰æ–°çš„ metadataï¼Œheader å¤§å°ä»ä¸º 24Bã€‚å®ƒå”¯ä¸€çš„æˆå‘˜æ˜¯è¿™ä¸ªæ€ªæ€ªçš„å¤§å°ä¸º 1 çš„æ•°ç»„ã€‚å¤§å°ä¸º 1 æ˜¾ç„¶ä¸åˆç†ï¼Œä»£è¡¨åªèƒ½å­˜æ”¾ä¸€ä¸ª KV å¯¹ã€‚ä½†åˆæ²¡æ³•æ”¹å˜å®ƒçš„å¤§å°ï¼Œéš¾é“è¦ç”¨ undefined behavior æ¥è¶Šç•Œè®¿é—®å…¶åçš„åœ°å€ï¼Ÿå®é™…ä¸Šå·®ä¸å¤šå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚ä½†è¿™ä¸æ˜¯ undefined behaviorï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å†™æ³•ï¼Œå«åš flexible arrayã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ã€‚\nç®€å•æ¥è¯´å°±æ˜¯ï¼Œå½“ä½ æœ‰ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜ä¸ºæ•°ç»„ã€‚åœ¨ç”¨è¿™ä¸ªç±»åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½ ä¸èƒ½ç¡®å®šè¯¥å°†è¿™ä¸ªæ•°ç»„çš„å¤§å°è®¾ç½®ä¸ºå¤šå°‘ï¼Œä½†çŸ¥é“è¿™æ•´ä¸ªå¯¹è±¡çš„å¤§å°æ˜¯å¤šå°‘ byteï¼Œä½ å°±å¯ä»¥ç”¨åˆ° flexible arrayã€‚flexible array å¿…é¡»æ˜¯ç±»ä¸­çš„æœ€åä¸€ä¸ªæˆå‘˜ï¼Œå¹¶ä¸”ä»…èƒ½æœ‰ä¸€ä¸ªã€‚åœ¨ä¸ºå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œflexible array ä¼šè‡ªåŠ¨å¡«å……ï¼Œå ç”¨æœªè¢«å…¶ä»–å˜é‡ä½¿ç”¨çš„å†…å­˜ã€‚è¿™æ ·å°±å¯ä»¥ç¡®å®šè‡ªå·±çš„é•¿åº¦äº†ã€‚\nä¾‹å¦‚æœ‰ä¸€ä¸ªç±» Cï¼š\nclass C { int a; // 4 byte int array[1]; // unknown size }; ç°åœ¨åˆå§‹åŒ–ä¸€ä¸ª C çš„å¯¹è±¡ï¼Œå¹¶ä¸ºå…¶åˆ†é…äº† 24 byte çš„å†…å­˜ã€‚a å äº† 4 byte å†…å­˜ï¼Œé‚£ä¹ˆ array ä¼šå°è¯•å¡«å……å‰©ä¸‹çš„å†…å­˜ï¼Œå¤§å°å˜ä¸º 5ã€‚\nå®é™…ä¸Šè¿™å°±æ˜¯ C++ å¯¹è±¡å†…å­˜å¸ƒå±€çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å› æ­¤ flexible array ä¸ºä»€ä¹ˆåªèƒ½æœ‰ä¸€ä¸ªä¸”å¿…é¡»æ”¾åœ¨æœ€åä¸€ä¸ªå°±å¾ˆæ˜æ˜¾äº†ï¼Œå› ä¸ºéœ€è¦å‘åå°è¯•å¡«å……ã€‚\næ­¤å¤–ï¼Œè™½ç„¶æˆå‘˜åœ¨å†…å­˜ä¸­çš„å…ˆåé¡ºåºå’Œå£°æ˜çš„é¡ºåºä¸€è‡´ï¼Œä½†éœ€è¦æ³¨æ„å¯èƒ½å­˜åœ¨çš„å†…å­˜å¯¹é½çš„é—®é¢˜ã€‚header ä¸­çš„æ•°æ®å¤§å°éƒ½ä¸º 4 byteï¼Œæ²¡æœ‰å¯¹é½é—®é¢˜ã€‚\nåˆ°è¿™é‡Œï¼Œè¿™ä¸ªå¤§å°ä¸º 1 çš„æ•°ç»„çš„ä½œç”¨å°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚åˆ©ç”¨ flexible array çš„ç‰¹æ€§æ¥è‡ªåŠ¨å¡«å…… page data 4KB å‡æ‰ header 24byte åå‰©ä½™çš„å†…å­˜ã€‚å‰©ä¸‹çš„è¿™äº›å†…å­˜ç”¨æ¥å­˜æ”¾ KV å¯¹ã€‚\ninternal page ä¸­ï¼ŒKV å¯¹çš„ K æ˜¯èƒ½å¤Ÿæ¯”è¾ƒå¤§å°çš„ç´¢å¼•ï¼ŒV æ˜¯ page idï¼Œç”¨æ¥æŒ‡å‘ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚Project ä¸­è¦æ±‚ï¼Œç¬¬ä¸€ä¸ª Key ä¸ºç©ºã€‚ä¸»è¦æ˜¯å› ä¸ºåœ¨ internal page ä¸­ï¼Œn ä¸ª key å¯ä»¥å°†æ•°è½´åˆ’åˆ†ä¸º n+1 ä¸ªåŒºåŸŸï¼Œä¹Ÿå°±å¯¹åº”ç€ n+1 ä¸ª valueã€‚å®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æŠŠæœ€åä¸€ä¸ª key å½“ä½œæ˜¯ç©ºçš„ï¼Œåªè¦åç»­çš„å¤„ç†è‡ªæ´½å°±å¯ä»¥äº†ã€‚\né€šè¿‡æ¯”è¾ƒ key çš„å¤§å°é€‰ä¸­ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚å®é™…ä¸Šç­‰å·çš„ä½ç½®ä¹Ÿå¯ä»¥æ”¹å˜ï¼Œæ€»ä¹‹ï¼Œåªè¦æ˜¯åˆæ³•çš„ B+ æ ‘ï¼Œå³èŠ‚ç‚¹å¤§å°éœ€è¦æ»¡è¶³æœ€å¤§æœ€å°å€¼çš„é™åˆ¶ï¼Œå„ç§å®ç°ç»†èŠ‚éƒ½æ˜¯è‡ªç”±çš„ã€‚\nå¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œinternal page ä¸­çš„ key å¹¶ä¸ä»£è¡¨å®é™…ä¸Šçš„ç´¢å¼•å€¼ï¼Œä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªå‘å¯¼ï¼Œå¼•å¯¼éœ€è¦æ’å…¥/åˆ é™¤/æŸ¥è¯¢çš„ key æ‰¾åˆ°è¿™ä¸ª key çœŸæ­£æ‰€åœ¨çš„ leaf pageã€‚\nB_PLUS_TREE_LEAF_PAGE\nleaf page å’Œ internal page çš„å†…å­˜å¸ƒå±€åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯ leaf page å¤šäº†ä¸€ä¸ªæˆå‘˜å˜é‡ next_page_idï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ª leaf pageï¼ˆç”¨äº range scanï¼‰ã€‚å› æ­¤ leaf page çš„ header å¤§å°ä¸º 28 Byteã€‚\nleaf page çš„ KV å¯¹ä¸­ï¼ŒK æ˜¯å®é™…çš„ç´¢å¼•ï¼ŒV æ˜¯ record idã€‚record id ç”¨äºè¯†åˆ«è¡¨ä¸­çš„æŸä¸€æ¡æ•°æ®ã€‚leaf page çš„ KV å¯¹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸åƒ internal page çš„ value å¤šä¸€ä¸ªã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ Bustub æ‰€æœ‰çš„ B+ æ ‘ç´¢å¼•ï¼Œæ— è®ºæ˜¯ä¸»é”®ç´¢å¼•è¿˜æ˜¯äºŒçº§ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚\nè¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹èšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•ã€äºŒçº§ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰çš„åŒºåˆ«ã€‚ åœ¨èšç°‡ç´¢å¼•é‡Œï¼Œleaf page çš„ value ä¸ºè¡¨ä¸­ä¸€æ¡æ•°æ®çš„æŸå‡ ä¸ªå­—æ®µæˆ–æ‰€æœ‰å­—æ®µï¼Œä¸€å®šåŒ…å«ä¸»é”®å­—æ®µã€‚è€Œéèšç°‡ç´¢å¼• leaf page çš„ value æ˜¯ record idï¼Œå³æŒ‡å‘ä¸€æ¡æ•°æ®çš„æŒ‡é’ˆã€‚ åœ¨ä½¿ç”¨èšç°‡ç´¢å¼•æ—¶ï¼Œä¸»é”®ç´¢å¼•çš„ leaf page åŒ…å«æ‰€æœ‰å­—æ®µï¼ŒäºŒçº§ç´¢å¼•çš„ leaf page åŒ…å«ä¸»é”®å’Œç´¢å¼•å­—æ®µã€‚å½“ä½¿ç”¨ä¸»é”®æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢åˆ° leaf page å³å¯è·å¾—æ•´æ¡æ•°æ®ã€‚å½“ä½¿ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œè‹¥æŸ¥è¯¢å­—æ®µåŒ…å«åœ¨ç´¢å¼•å†…ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°ç»“æœï¼Œä½†å¦‚æœæŸ¥è¯¢å­—æ®µä¸åŒ…å«åœ¨ç´¢å¼•å†…ï¼Œåˆ™éœ€ä½¿ç”¨å¾—åˆ°çš„ä¸»é”®å­—æ®µåœ¨ä¸»é”®ç´¢å¼•ä¸­å†æ¬¡æŸ¥è¯¢ï¼Œä»¥å¾—åˆ°æ‰€æœ‰çš„å­—æ®µï¼Œè¿›è€Œå¾—åˆ°éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼Œè¿™å°±æ˜¯å›è¡¨çš„è¿‡ç¨‹ã€‚ åœ¨ä½¿ç”¨éèšç°‡ç´¢å¼•æ—¶ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ä¸»é”®æŸ¥è¯¢è¿˜æ˜¯äºŒçº§ç´¢å¼•æŸ¥è¯¢ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœéƒ½æ˜¯ record idï¼Œéœ€è¦ä½¿ç”¨ record id å»æŸ¥è¯¢çœŸæ­£å¯¹åº”çš„æ•´æ¡è®°å½•ã€‚ èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´æ¡è®°å½•ç›´æ¥å­˜æ”¾åœ¨ leaf pageï¼Œæ— éœ€äºŒæ¬¡æŸ¥è¯¢ï¼Œä¸”ç¼“å­˜å‘½ä¸­ç‡é«˜ï¼Œåœ¨ä½¿ç”¨ä¸»é”®æŸ¥è¯¢æ—¶æ€§èƒ½æ¯”è¾ƒå¥½ã€‚ç¼ºç‚¹åˆ™æ˜¯äºŒçº§ç´¢å¼•å¯èƒ½éœ€è¦å›è¡¨ï¼Œä¸”ç”±äºæ•´æ¡æ•°æ®å­˜æ”¾åœ¨ leaf pageï¼Œæ›´æ–°ç´¢å¼•çš„ä»£ä»·å¾ˆé«˜ï¼Œé¡µåˆ†è£‚ã€åˆå¹¶ç­‰æƒ…å†µå¼€é”€æ¯”è¾ƒå¤§ã€‚ éèšç°‡ç´¢å¼•çš„ä¼˜ç‚¹æ˜¯ï¼Œç”±äº leaf page ä»…å­˜æ”¾ record idï¼Œæ›´æ–°çš„ä»£ä»·è¾ƒä½ï¼ŒäºŒçº§ç´¢å¼•çš„æ€§èƒ½å’Œä¸»é”®ç´¢å¼•å‡ ä¹ç›¸åŒã€‚ç¼ºç‚¹æ˜¯æŸ¥è¯¢æ—¶å‡éœ€ä½¿ç”¨ record id è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ã€‚\nTask1 çš„ä¸»è¦å†…å®¹å°±æ˜¯è¿™äº›ã€‚å®é™…ä¸Šè¦å®ç°çš„å†…å®¹éå¸¸ç®€å•ï¼Œé‡ç‚¹æ˜¯ç†è§£å„ä¸ª page çš„ä½œç”¨å’Œå†…å­˜å¸ƒå±€ã€‚\nTask2 B+Tree Data Structure (Insertion, Deletion, Point Search) Task2 æ˜¯å•çº¿ç¨‹ B+ æ ‘çš„é‡ç‚¹ã€‚é¦–å…ˆæä¾›æ¼”ç¤ºä¸€ä¸ª B+ æ ‘æ’å…¥åˆ é™¤æ“ä½œçš„ ç½‘ç«™ã€‚ä¸»è¦æ˜¯çœ‹çœ‹ B+ æ ‘æ’å…¥åˆ é™¤çš„å„ç§ç»†èŠ‚å˜åŒ–ã€‚å½“ç„¶å…·ä½“å®ç°æ˜¯è‡ªç”±çš„ï¼Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚\nSearch\nå…ˆä»æœ€ç®€å•çš„ Point Search å¼€å§‹ã€‚B+ æ ‘çš„ç»“æ„åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼ŒèŠ‚ç‚¹åˆ†ä¸º internal page å’Œ leaf pageï¼Œæ¯ä¸ª page ä¸Šçš„ key æœ‰åºæ’åˆ—ã€‚å½“æ‹¿åˆ°ä¸€ä¸ª key éœ€è¦æŸ¥æ‰¾å¯¹åº”çš„ value æ—¶ï¼Œé¦–å…ˆéœ€è¦ç»ç”± internal page é€’å½’åœ°å‘ä¸‹æŸ¥æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ° key æ‰€åœ¨çš„ leaf pageã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªå‡½æ•° Findleaf()ã€‚\nFindleaf() ä» root page å¼€å§‹æŸ¥æ‰¾ã€‚åœ¨æŸ¥æ‰¾åˆ° leaf page æ—¶ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ ¹æ® key åœ¨å½“å‰ internal page ä¸­æ‰¾åˆ°å¯¹åº”çš„ child page idï¼Œé€’å½’è°ƒç”¨ Findleafã€‚æ ¹æ® key æŸ¥æ‰¾å¯¹åº” child id æ—¶ï¼Œç”±äº key æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ç›´æ¥è¿›è¡ŒäºŒåˆ†æœç´¢ã€‚15-445 Lecture ä¸­ä¹Ÿä»‹ç»äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚ç”¨ SIMD å¹¶è¡Œæ¯”è¾ƒï¼Œæ’å€¼æ³•ç­‰ç­‰ã€‚åœ¨è¿™é‡ŒäºŒåˆ†æœç´¢å°±å¯ä»¥äº†ã€‚\ninternal page ä¸­å‚¨å­˜ key å’Œ child page idï¼Œé‚£ä¹ˆåœ¨æ‹¿åˆ° page id åå¦‚ä½•è·å¾—å¯¹åº”çš„ page æŒ‡é’ˆï¼Ÿç”¨ Project 1 ä¸­å®ç°çš„ buffer poolã€‚\nPage *page = buffer_pool_manager_-\u003eFetchPage(page_id); åŒæ ·åœ°ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª pageï¼Œä¹Ÿæ˜¯è°ƒç”¨ buffer pool çš„ NewPage()ã€‚\nåœ¨è·å–åˆ°ä¸€ä¸ª page åï¼Œå¦‚ä½•ä½¿ç”¨è¿™ä¸ª page æ¥å­˜å‚¨æ•°æ®ï¼Ÿä¹‹å‰å·²ç»æåˆ°è¿‡ï¼Œpage çš„ data_ å­—æ®µæ˜¯å®é™…ç”¨äºå­˜å‚¨æ•°æ®çš„ 4KB å¤§å°çš„å­—èŠ‚æ•°ç»„ã€‚é€šè¿‡ reinterpret_cast å°†è¿™ä¸ªå­—èŠ‚æ•°ç»„å¼ºåˆ¶è½¬æ¢ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨çš„ç±»å‹ï¼Œä¾‹å¦‚ leaf pageï¼š\nauto leaf_page = reinterpret_cast\u003cB_PLUS_TREE_LEAF_PAGE_TYPE *\u003e(page-\u003eGetData()) reinterpret_cast ç”¨äºæ— å…³ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼Œè½¬æ¢æ–¹æ³•å¾ˆç®€å•ï¼ŒåŸå§‹ bits ä¸å˜ï¼Œåªæ˜¯å¯¹è¿™äº› bits ç”¨æ–°ç±»å‹è¿›è¡Œäº†é‡æ–°çš„è§£è¯»ã€‚å¯æƒ³è€ŒçŸ¥è¿™ç§è½¬æ¢éå¸¸ä¸å®‰å…¨ï¼Œéœ€è¦ç¡®ä¿è½¬æ¢åçš„å†…å­˜å¸ƒå±€ä»æ˜¯åˆæ³•çš„ã€‚åœ¨è¿™é‡ŒåŸç±»å‹æ˜¯ byte æ•°ç»„ï¼Œæ–°ç±»å‹æ˜¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„ tree pageã€‚\næ‰¾åˆ° leaf page åï¼ŒåŒæ ·æ˜¯äºŒåˆ†æŸ¥æ‰¾ keyï¼Œæ‰¾åˆ°å¯¹åº”çš„ record idã€‚\næŸ¥æ‰¾çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦ä¸”å¤æ‚çš„ç»†èŠ‚ï¼Œå°±æ˜¯ page unpin çš„é—®é¢˜ã€‚\næˆ‘ä»¬åœ¨æ‹¿åˆ° page id åï¼Œè°ƒç”¨ buffer pool çš„ FetchPage() å‡½æ•°æ¥è·å–å¯¹åº”çš„ page æŒ‡é’ˆã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨å®Œ page ä¹‹åï¼Œéœ€è¦å°† page unpin æ‰ï¼Œå¦åˆ™æœ€ç»ˆä¼šå¯¼è‡´ buffer pool ä¸­çš„æ‰€æœ‰ page éƒ½è¢« pin ä½ï¼Œæ— æ³•ä» disk è¯»å–å…¶ä»–çš„ pageã€‚\næ¯”è¾ƒåˆé€‚çš„åšæ³•æ˜¯ï¼Œåœ¨æœ¬æ¬¡æ“ä½œä¸­ï¼Œæ‰¾å‡º page æœ€åä¸€æ¬¡è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼Œå¹¶åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨å unpinã€‚\nInsert\nä¸ Search ç›¸åŒï¼Œç¬¬ä¸€æ­¥æ˜¯æ ¹æ® key æ‰¾åˆ°éœ€è¦æ’å…¥çš„ leaf pageã€‚åŒæ ·æ˜¯è°ƒç”¨ Findleaf()ã€‚å¾—åˆ° leaf page åï¼Œå°† key æ’å…¥ leaf pageã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ’å…¥æ—¶ä»éœ€ä¿è¯ key çš„æœ‰åºæ€§ã€‚åŒæ ·å¯ä»¥äºŒåˆ†æœç´¢æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ’å…¥ã€‚\nåœ¨æ’å…¥åï¼Œéœ€è¦æ£€æŸ¥å½“å‰ leaf page size æ˜¯å¦ç­‰äº max sizeã€‚è‹¥ç›¸ç­‰ï¼Œåˆ™è¦è¿›è¡Œä¸€æ¬¡ leaf page åˆ†è£‚æ“ä½œã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š\næ–°å»ºä¸€ä¸ªç©ºçš„ pageï¼Œ å°†åŸ page çš„ä¸€åŠè½¬ç§»åˆ°æ–° page ä¸­ï¼Œï¼ˆå‡å¦‚é€‰æ‹©å°†æ–° page æ”¾åœ¨åŸ page å³ä¾§ï¼Œåˆ™è½¬ç§»åŸ page çš„å³åŠéƒ¨åˆ†ï¼‰ æ›´æ–°åŸ page å’Œæ–° page çš„ next page idï¼Œ è·å– parent pageï¼Œ å°†ç”¨äºåŒºåˆ†åŸ page å’Œæ–° page çš„ key æ’å…¥ parent page ä¸­ï¼Œ æ›´æ–° parent page æ‰€æœ‰ child page çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚ è¿™äº›æ­¥éª¤éƒ½æ¯”è¾ƒå¥½ç†è§£ã€‚éœ€è¦ç»™ parent page æ’å…¥ä¸€ä¸ªæ–° key çš„åŸå› æ˜¯ï¼Œå¤šäº†ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè‡ªç„¶éœ€è¦å¤šä¸€ä¸ª key æ¥åŒºåˆ†ã€‚å…¶ä¸­ç¬¬ 4 æ­¥æ˜¯é‡ç‚¹ã€‚è·å– parent page å¹¶ä¸æ˜¯ç®€å•åœ°é€šè¿‡å½“å‰ page çš„ parent id æ¥è·å–ï¼Œå› ä¸º parent page ä¹Ÿå¯èƒ½å‘ç”Ÿåˆ†è£‚ã€‚\nå‡å¦‚æˆ‘ä»¬æœ‰ä¸€æ£µ 5 é˜¶çš„ B+ æ ‘ã€‚5 é˜¶åªæ˜¯ä¸€ç§å¸¸ç”¨çš„è¯´æ³•ï¼Œä»£è¡¨ B+ æ ‘èŠ‚ç‚¹æœ€å¤šèƒ½å®¹çº³äº”ä¸ª KV å¯¹ã€‚å¯¹äº leaf page æ¥è¯´ï¼Œå½“ B+ æ ‘å¤„äºç¨³å®šçŠ¶æ€æ—¶ï¼ˆæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œå·²ç»å®Œå…¨ç»“æŸï¼‰ï¼Œæœ€å¤šåªèƒ½æœ‰ 4 ä¸ª KV å¯¹ã€‚å¯¹äº internal pageï¼Œæœ€å¤šæœ‰ 4 ä¸ª keyï¼Œ5 ä¸ª valueï¼Œå¯ä»¥çœ‹æˆæ˜¯æœ‰ 5 ä¸ª KV å¯¹ã€‚\nå› æ­¤ï¼Œinstruction ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š\nYou should correctly perform splits if insertion triggers the splitting condition (number of key/value pairs AFTER insertion equals to max_size for leaf nodes, number of children BEFORE insertion equals to max_size for internal nodes.).\nåœ¨æ’å…¥åæ£€æµ‹ leaf page æ˜¯å¦éœ€è¦åˆ†è£‚ï¼Œå› ä¸º leaf page ç¨³å®šæ—¶åªæœ‰ 4 ä¸ª KV å¯¹ï¼Œæ’å…¥åæœ‰ 5 ä¸ªï¼Œä»èƒ½å®¹çº³ã€‚åœ¨æ’å…¥å‰æ£€æµ‹ internal pageï¼Œå› ä¸º internal page ç¨³å®šæ—¶å°±æœ‰ 5 ä¸ª KV å¯¹ï¼Œè‹¥æ’å…¥åå†æ£€æµ‹ï¼Œæ’å…¥çš„ç¬¬ 6 ä¸ª KV å¯¹ä¼šé€ æˆè¶Šç•Œã€‚\nå®é™…ä¸Šè¿™ä¹Ÿåªæ˜¯ä¸€ç§çº¦å®šï¼Œå¹¶ä¸æ˜¯å¼ºåˆ¶çš„è§„åˆ™ã€‚\nåœ¨ç¬¬ 5 æ­¥æˆ‘ä»¬å¯ä»¥æ‹¿åˆ° parent page å®‰å…¨åœ°æ’å…¥ KV å¯¹ï¼Œæ˜¯å› ä¸ºåœ¨ç¬¬ 4 æ­¥ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ªå®‰å…¨çš„ parent pageã€‚\nç¬¬ 4 æ­¥å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š\næ ¹æ® parent page id æ‹¿åˆ° parent pageï¼Œ åˆ¤æ–­ parent page size æ˜¯å¦ç­‰äº max sizeï¼Œï¼ˆæ’å…¥å‰æ£€æŸ¥ï¼‰ è‹¥å°äºï¼Œç›´æ¥è¿”å› parent pageï¼Œ å¦åˆ™ï¼Œåˆ†è£‚å½“å‰ internal pageã€‚å¹¶æ ¹æ®æ­¤åéœ€è¦æ’å…¥çš„ key é€‰æ‹©åˆ†è£‚åçš„ä¸¤ä¸ª page ä¹‹ä¸€ä½œä¸º parent page è¿”å›ã€‚ åˆ†è£‚ internal page çš„æ­¥éª¤ä¸ºï¼š\næ–°å»ºä¸€ä¸ªç©ºçš„ pageï¼Œ å°†åŸ page çš„ä¸€åŠè½¬ç§»åˆ°æ–° page ä¸­ï¼Œéœ€è¦æ³¨æ„åŸ page å’Œæ–° page çš„ç¬¬ä¸€ä¸ª key éƒ½æ˜¯æ— æ•ˆçš„ï¼Œ æ›´æ–°æ–° page æ‰€æœ‰ child page çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆï¼ŒæŒ‡å‘æ–° pageï¼Œ è·å– parent pageï¼Œ å°†ç”¨äºåŒºåˆ†åŸ page å’Œæ–° page çš„ key æ’å…¥ parent page ä¸­ï¼Œ æ›´æ–° parent page æ‰€æœ‰ child page çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚ å¯ä»¥å‘ç°ï¼Œç¬¬ 4 æ­¥åŒæ ·æ˜¯éœ€è¦é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚è¿™é‡Œå°±å‘ç”Ÿäº†å‘ä¸Šçš„é€’å½’ï¼Œç›´åˆ°é‡åˆ°å®‰å…¨çš„çˆ¶èŠ‚ç‚¹æˆ–è€…é‡åˆ°æ ¹èŠ‚ç‚¹ã€‚åœ¨é‡åˆ°æ ¹èŠ‚ç‚¹æ—¶ï¼Œè‹¥æ ¹èŠ‚ç‚¹ä¹Ÿéœ€è¦åˆ†è£‚ï¼Œåˆ™é™¤äº†éœ€è¦æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ç”¨æ¥å®¹çº³åŸæ ¹èŠ‚ç‚¹ä¸€åŠçš„ KV å¯¹ï¼Œè¿˜éœ€è¦æ–°å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹ã€‚\nå¦å¤–éœ€è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œåœ¨ leaf page åˆ†è£‚æ—¶ï¼Œå‘çˆ¶èŠ‚ç‚¹æ’å…¥ key æ—¶æ˜¯å¤åˆ¶åæ’å…¥ï¼Œè€Œ internal page åˆ†è£‚æ—¶ï¼Œå‘çˆ¶èŠ‚ç‚¹æ’å…¥ key æ˜¯åˆ é™¤åæ’å…¥ï¼Œæœ‰ç‚¹åƒæŠŠ key ä¸Šæ¨ã€‚\nå‡å¦‚æœ‰ä¸€æ£µ 4 é˜¶çš„ B+ æ ‘ï¼š\nè¿™äº›ç»†èŠ‚éƒ½å¯ä»¥åœ¨ B+ æ ‘ç¤ºä¾‹ç½‘ç«™ä¸Šå…ˆå°è¯•ä¸€éï¼Œå†æ¥å®ç°ä¼šç®€å•å¾ˆå¤šã€‚\nInsert çš„æ•´ä¸ªæµç¨‹å¤§è‡´å°±æ˜¯å…ˆå‘ä¸‹é€’å½’æ‰¾åˆ° leaf pageï¼Œæ’å…¥ KV åå†å‘ä¸Šé€’å½’åˆ†è£‚ã€‚\nDelete\nåŒæ ·åœ°ï¼Œå…ˆæ‰¾åˆ° leaf pageã€‚åˆ é™¤ leaf page ä¸­ key å¯¹åº”çš„ KV å¯¹åï¼Œæ£€æŸ¥ size æ˜¯å¦å°äº min sizeã€‚å¦‚æœå°äºçš„è¯ï¼Œé¦–å…ˆå°è¯•ä»ä¸¤ä¾§çš„å…„å¼ŸèŠ‚ç‚¹ä¸­å·ä¸€ä¸ª KV å¯¹ã€‚æ³¨æ„åªèƒ½ä»å…„å¼ŸèŠ‚ç‚¹ï¼Œå³çˆ¶èŠ‚ç‚¹ç›¸åŒçš„èŠ‚ç‚¹ä¸­é€‰å–ã€‚å‡å¦‚å­˜åœ¨ä¸€ä¾§èŠ‚ç‚¹æœ‰å¯Œä½™çš„ KV å¯¹ï¼Œåˆ™æˆåŠŸå·å–ï¼Œç»“æŸæ“ä½œã€‚è‹¥ä¸¤ä¾§éƒ½æ²¡æœ‰å¯Œä½™çš„ KV å¯¹ï¼Œåˆ™é€‰æ‹©ä¸€ä¾§èŠ‚ç‚¹ä¸å…¶åˆå¹¶ã€‚\nå·å–çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä»å·¦ä¾§èŠ‚ç‚¹å·å–æ—¶ï¼ŒæŠŠå·¦ä¾§èŠ‚ç‚¹æœ€åä¸€ä¸ª KV å¯¹è½¬ç§»è‡³å½“å‰èŠ‚ç‚¹ç¬¬ä¸€ä¸ª KV å¯¹ï¼Œä»å³ä¾§èŠ‚ç‚¹å·å–æ—¶ï¼ŒæŠŠå³ä¾§èŠ‚ç‚¹çš„ KV å¯¹è½¬ç§»è‡³å½“å‰èŠ‚ç‚¹æœ€åä¸€ä¸ª KV å¯¹ã€‚leaf page å’Œ internal page çš„å·å–è¿‡ç¨‹åŸºæœ¬ç›¸åŒï¼Œä»…éœ€æ³¨æ„ internal page å·å–åæ›´æ–°å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚\nç¨éš¾çš„æ˜¯åˆå¹¶çš„è¿‡ç¨‹ã€‚åŒæ ·ï¼Œä»»é€‰å·¦å³ä¾§ä¸€å…„å¼ŸèŠ‚ç‚¹è¿›è¡Œåˆå¹¶ã€‚å°†ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ KV å¯¹è½¬ç§»è‡³å¦ä¸€èŠ‚ç‚¹ã€‚è‹¥åˆå¹¶çš„æ˜¯ leaf pageï¼Œè®°å¾—æ›´æ–° next page idã€‚è‹¥åˆå¹¶çš„æ˜¯ internal pageï¼Œè®°å¾—æ›´æ–°åˆå¹¶å page çš„å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚ç„¶åï¼Œåˆ é™¤ parent èŠ‚ç‚¹ä¸­å¯¹åº”çš„ keyã€‚åˆ é™¤åï¼Œå†æ¬¡æ£€æŸ¥ size æ˜¯å¦å°äº min sizeï¼Œå½¢æˆå‘ä¸Šé€’å½’ã€‚\nå½“åˆå¹¶ leaf page åï¼Œåˆ é™¤çˆ¶èŠ‚ç‚¹ä¸­å¯¹åº”çš„ key æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åˆ é™¤å³å¯ã€‚ä¾‹å¦‚ 4 é˜¶ B+ æ ‘ï¼š\nåˆå¹¶ internal page åï¼Œå¹¶ä¸æ˜¯ç®€å•åœ°åˆ é™¤çˆ¶èŠ‚ç‚¹ä¸­å¯¹åº” keyï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ key ä¸‹æ¨çš„è¿‡ç¨‹ï¼š\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œroot page å¹¶ä¸å— min size çš„é™åˆ¶ã€‚ä½†å¦‚æœ root page è¢«åˆ åˆ° size åªå‰© 1ï¼Œå³åªæœ‰ä¸€ä¸ª child page çš„æ—¶å€™ï¼Œåº”å°†æ­¤ child page è®¾ç½®ä¸ºæ–°çš„ root pageã€‚\nå¦å¤–ï¼Œåœ¨åˆå¹¶æ—¶ï¼Œä¸¤ä¸ª page åˆå¹¶æˆä¸€ä¸ª pageï¼Œå¦ä¸€ä¸ª page åº”è¯¥åˆ é™¤ï¼Œé‡Šæ”¾èµ„æºã€‚åˆ é™¤ page æ—¶ï¼Œä»æ˜¯è°ƒç”¨ buffer pool çš„ DeletePage() å‡½æ•°ã€‚\nå’Œ Insert ç±»ä¼¼ï¼ŒDelete è¿‡ç¨‹ä¹Ÿæ˜¯å…ˆå‘ä¸‹é€’å½’æŸ¥è¯¢ leaf pageï¼Œä¸æ»¡è¶³ min size åå…ˆå°è¯•å·å–ï¼Œæ— æ³•å·å–åˆ™åˆå¹¶ï¼Œå¹¶å‘ä¸Šé€’å½’åœ°æ£€æŸ¥æ˜¯å¦æ»¡è¶³ min sizeã€‚\nDebug Your B+Tree å†æ¬¡æ„Ÿå¹çœŸæ­£çš„ä¸–ç•Œä¸€æµ CS é«˜æ ¡å¯¹è¯¾ç¨‹é¡¹ç›®è®¾è®¡çš„ç”¨å¿ƒä¸ä½“è´´ã€‚ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œ15-445 ç«Ÿç„¶å¸®æˆ‘ä»¬å®ç°äº† B+ æ ‘çš„å¯è§†åŒ–ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹å¼ï¼š\nä½¿ç”¨å·²å®ç°å¥½çš„ b_plus_tree_printer å·¥å…·ï¼Œå¯ä»¥è‡ªå·±å¯¹ B+ æ ‘æ‰§è¡Œæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œï¼Œå¹¶å°†ç»“æœè¾“å‡ºä¸º dot æ–‡ä»¶ã€‚ $ # To build the tool $ mkdir build $ cd build $ make b_plus_tree_printer -j$(nproc) $ ./bin/b_plus_tree_printer \u003e\u003e ... USAGE ... \u003e\u003e 5 5 # set leaf node and internal node max size to be 5 \u003e\u003e f input.txt # Insert into the tree with some inserts \u003e\u003e g my-tree.dot # output the tree to dot format \u003e\u003e q # Quit the test (Or use another terminal) åœ¨ä»£ç ä¸­è°ƒç”¨ BPlusTree çš„ Draw() å‡½æ•°ï¼Œå¯ä»¥åœ¨æŒ‡å®šç›®å½•ç”Ÿæˆä¸€ä¸ª dot æ–‡ä»¶ã€‚ æ‹¿åˆ° dot æ–‡ä»¶åï¼Œå¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆå¯¹åº”çš„ B+ æ ‘ pngï¼š\ndot -Tpng -O my-tree.dot æˆ–è€…æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶åˆ° è¿™é‡Œã€‚ï¼ˆæ›´æ¨èï¼Œç”Ÿæˆ svgï¼Œå¯¹ B+ æ ‘å¤§å°æ— é™åˆ¶ï¼‰\nè¿™ä¸ªå¯è§†åŒ–å·¥å…·å¯¹æ—©æœŸå‘ç° B+ æ ‘çš„å„ç§åŸºæœ¬ bug éå¸¸æœ‰ç”¨ã€‚\nè‡³æ­¤ï¼ŒCheckpoint1 çš„å†…å®¹å·²ç»å…¨éƒ¨å®Œæˆã€‚å…¶å®æœ‰å¾ˆå¤šç»†èŠ‚æˆ‘éƒ½æ²¡æœ‰æåˆ°ï¼Œæ¯”å¦‚äºŒåˆ†æœç´¢çš„è¾¹ç•Œé—®é¢˜ï¼Œå¦‚ä½•æŸ¥è¯¢å·¦å³å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚ä½•åœ¨å…„å¼ŸèŠ‚ç‚¹é—´ç§»åŠ¨ KV å¯¹ï¼Œç¬¬ä¸€æ¬¡ Insert æ ‘ä¸ºç©ºæ€ä¹ˆåŠç­‰ç­‰ã€‚è¿™äº›éƒ½å±äºæ¯”è¾ƒç»†ææœ«èŠ‚çš„é—®é¢˜ï¼Œæ¯”è¾ƒæŠ˜ç£¨äººï¼Œä½†è®¤çœŸæ€è€ƒåº”è¯¥éƒ½èƒ½å¤Ÿè§£å†³ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™äº›å®ç°éƒ½æ˜¯è‡ªç”±çš„ã€‚\nCheckpoint2 Multi Thread B+Tree Checkpoint2 ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š\nTask3ï¼šIndex Iteratorã€‚å®ç° leaf page çš„ range scanã€‚ Task4ï¼šConcurrent Indexã€‚æ”¯æŒ B+ æ ‘å¹¶å‘æ“ä½œã€‚ Task3 Index Iterator è¿™ä¸ªéƒ¨åˆ†æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šå¥½è¯´çš„ï¼Œå®ç°ä¸€ä¸ªéå† leaf page çš„è¿­ä»£å™¨ã€‚åœ¨è¿­ä»£å™¨ä¸­å­˜å‚¨å½“å‰ leaf page çš„æŒ‡é’ˆå’Œå½“å‰åœç•™çš„ä½ç½®å³å¯ã€‚éå†å®Œå½“å‰ page åï¼Œé€šè¿‡ next page id æ‰¾åˆ°ä¸‹ä¸€ä¸ª leaf pageã€‚åŒæ ·ï¼Œè®°å¾— unpin å·²ç»éå†å®Œçš„ pageã€‚å…³äºå¯èƒ½å­˜åœ¨çš„æ­»é”é—®é¢˜ï¼Œæš‚æ—¶ä¸è®¨è®ºã€‚\nTask4 Concurrent Index è¿™æ˜¯å¹¶å‘ B+ æ ‘çš„é‡ç‚¹ï¼Œåº”è¯¥ä¹Ÿæ˜¯ Project2 ä¸­æœ€éš¾çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬è¦ä½¿æ­¤å‰å®ç°çš„ B+ æ ‘æ”¯æŒå¹¶å‘çš„ Search/Insert/Delete æ“ä½œã€‚æ•´æ£µæ ‘ä¸€æŠŠé”é€»è¾‘ä¸Šæ¥è¯´å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ€§èƒ½ä¹Ÿä¼šå¯æƒ³è€ŒçŸ¥åœ°ç³Ÿç³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„åŠ é”æ–¹å¼ï¼Œå«åš latch crabbingã€‚é¡¾åæ€ä¹‰ï¼Œå°±åƒèƒèŸ¹ä¸€æ ·ï¼Œç§»åŠ¨ä¸€åªè„šï¼Œæ”¾ä¸‹ï¼Œç§»åŠ¨å¦ä¸€åªè„šï¼Œå†æ”¾ä¸‹ã€‚åŸºæœ¬æ€æƒ³æ˜¯ï¼š\nå…ˆé”ä½ parent pageï¼Œ å†é”ä½ child pageï¼Œ å‡è®¾ child page æ˜¯å®‰å…¨çš„ï¼Œåˆ™é‡Šæ”¾ parent page çš„é”ã€‚å®‰å…¨æŒ‡å½“å‰ page åœ¨å½“å‰æ“ä½œä¸‹ä¸€å®šä¸ä¼šå‘ç”Ÿ split/steal/mergeã€‚åŒæ—¶ï¼Œå®‰å…¨å¯¹ä¸åŒæ“ä½œçš„å®šä¹‰æ˜¯ä¸åŒçš„ï¼ŒSearch æ—¶ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å®‰å…¨ï¼›Insert æ—¶ï¼Œåˆ¤æ–­ max sizeï¼›Delete æ—¶ï¼Œåˆ¤æ–­ min sizeã€‚ è¿™ä¹ˆåšçš„åŸå› å’Œæ­£ç¡®æ€§è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚å½“ page ä¸ºå®‰å…¨çš„æ—¶å€™ï¼Œå½“å‰æ“ä½œä»…å¯èƒ½æ”¹å˜æ­¤ page åŠå…¶ child page çš„å€¼ï¼Œå› æ­¤å¯ä»¥æå‰é‡Šæ”¾æ‰å…¶ç¥–å…ˆçš„é”æ¥æé«˜å¹¶å‘æ€§èƒ½ã€‚\nSearch\nSearch æ—¶ï¼Œä» root page å¼€å§‹ï¼Œå…ˆç»™ parent ä¸Šè¯»é”ï¼Œå†ç»™ child page ä¸Šè¯»é”ï¼Œç„¶åé‡Šæ”¾ parent page çš„é”ã€‚å¦‚æ­¤å‘ä¸‹é€’å½’ã€‚\nInsert\nInsert æ—¶ï¼Œä» root page å¼€å§‹ï¼Œå…ˆç»™ parent ä¸Šå†™é”ï¼Œå†ç»™ child page ä¸Šå†™é”ã€‚å‡å¦‚ child page å®‰å…¨ï¼Œåˆ™é‡Šæ”¾æ‰€æœ‰ç¥–å…ˆçš„é”ï¼›å¦åˆ™ä¸é‡Šæ”¾é”ï¼Œç»§ç»­å‘ä¸‹é€’å½’ã€‚\nåœ¨ child page ä¸å®‰å…¨æ—¶ï¼Œéœ€è¦æŒç»­æŒæœ‰ç¥–å…ˆçš„å†™é”ã€‚å¹¶åœ¨å‡ºç°å®‰å…¨çš„ child page åï¼Œé‡Šæ”¾æ‰€æœ‰ç¥–å…ˆå†™é”ã€‚å¦‚ä½•è®°å½•å“ªäº› page å½“å‰æŒæœ‰é”ï¼Ÿè¿™é‡Œå°±è¦ç”¨åˆ°åœ¨ Checkpoint1 é‡Œä¸€ç›´æ²¡æœ‰æåˆ°çš„ä¸€ä¸ªå‚æ•°ï¼Œtransactionã€‚\ntransaction å°±æ˜¯ Bustub é‡Œçš„äº‹åŠ¡ã€‚åœ¨ Project2 ä¸­ï¼Œå¯ä»¥æš‚æ—¶ä¸ç”¨ç†è§£äº‹åŠ¡æ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯å°†å…¶çœ‹ä½œå½“å‰åœ¨å¯¹ B+ æ ‘è¿›è¡Œæ“ä½œçš„çº¿ç¨‹ã€‚è°ƒç”¨ transaction çš„ AddIntoPageSet() æ–¹æ³•ï¼Œæ¥è·Ÿè¸ªå½“å‰çº¿ç¨‹è·å–çš„ page é”ã€‚åœ¨å‘ç°ä¸€ä¸ªå®‰å…¨çš„ child page åï¼Œå°† transaction ä¸­è®°å½•çš„ page é”å…¨éƒ¨é‡Šæ”¾æ‰ã€‚æŒ‰ç†æ¥è¯´ï¼Œé‡Šæ”¾é”çš„é¡ºåºå¯ä»¥ä»ä¸Šåˆ°ä¸‹ä¹Ÿå¯ä»¥ä»ä¸‹åˆ°ä¸Šï¼Œä½†ç”±äºä¸Šå±‚èŠ‚ç‚¹çš„ç«äº‰ä¸€èˆ¬æ›´åŠ æ¿€çƒˆï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ä»ä¸Šåˆ°ä¸‹åœ°é‡Šæ”¾é”ã€‚\nåœ¨å®Œæˆæ•´ä¸ª Insert æ“ä½œåï¼Œé‡Šæ”¾æ‰€æœ‰é”ã€‚\nDelete\nå’Œ Insert åŸºæœ¬ä¸€æ ·ã€‚ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å®‰å…¨çš„æ–¹æ³•ä¸åŒï¼ˆæ£€æµ‹ min sizeï¼‰ã€‚éœ€è¦å¦å¤–æ³¨æ„çš„æ˜¯ï¼Œå½“éœ€è¦ steal/merge sibling æ—¶ï¼Œä¹Ÿéœ€è¦å¯¹ sibling åŠ é”ã€‚å¹¶åœ¨å®Œæˆ steal/merge åé©¬ä¸Šé‡Šæ”¾ã€‚è¿™é‡Œæ˜¯ä¸ºäº†é¿å…å…¶ä»–çº¿ç¨‹æ­£åœ¨å¯¹ sibling è¿›è¡Œ Search/Insert æ“ä½œï¼Œä»è€Œå‘ç”Ÿ data raceã€‚è¿™é‡Œçš„åŠ é”å°±ä¸éœ€è¦åœ¨ transaction é‡Œè®°å½•äº†ï¼Œåªæ˜¯ä¸´æ—¶ä½¿ç”¨ã€‚\nImplementation\nå¯ä»¥å‘ç°ï¼Œlatch crabbing æ˜¯åœ¨ Find Leaf çš„è¿‡ç¨‹ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹ Checkpoint1 ä¸­çš„ FindLeaf()ï¼Œæ ¹æ®æ“ä½œçš„ä¸åŒæ²¿é€”åŠ é”ã€‚\nWhen should we unlatch and unpin pages? åœ¨è¿™é‡Œï¼Œæˆ‘è¿˜æƒ³æä¸€æ unpin page çš„é—®é¢˜ã€‚åœ¨å‰é¢æˆ‘åªæ˜¯ç®€å•åœ°è¯´äº†ä¸€å¥åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨çš„åœ°æ–¹ unpinã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªé—®é¢˜åœ¨æ•´ä¸ª Project2 ä¸­æ—¶æ—¶å›°æ‰°ç€æˆ‘ã€‚ç‰¹åˆ«æ˜¯åœ¨ Checkpoint2 ä¸­å¼•å…¥ page é”ä¹‹åã€‚åˆ°åº•è¯¥å¦‚ä½•ä¼˜é›…åœ°é‡Šæ”¾æˆ‘ä»¬è·å¾—çš„ pageï¼Ÿ\né¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ unpin pageï¼Ÿè¿™ä¸ªåº”è¯¥æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œé¿å…å¯¹ buffer pool ä¸€ç›´å ç”¨ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ç§èµ„æºçš„æ³„éœ²ã€‚\nè¯´åˆ°èµ„æºæ³„éœ²ï¼Œå¯ä»¥è‡ªç„¶åœ°æƒ³åˆ° RAIIã€‚RAII çš„ä¸»è¦æ€æƒ³æ˜¯ï¼Œåœ¨åˆå§‹åŒ–æ—¶è·å–èµ„æºï¼Œåœ¨ææ„æ—¶é‡Šæ”¾èµ„æºã€‚è¿™æ ·å°±é¿å…äº†ç¨‹åºä¸­é€”é€€å‡ºï¼Œæˆ–æŠ›å‡ºå¼‚å¸¸åï¼Œèµ„æºæ²¡æœ‰è¢«æˆåŠŸé‡Šæ”¾ã€‚å¸¸å¸¸ç”¨åœ¨ open socketã€acquire mutex ç­‰æ“ä½œä¸­ã€‚å…¶å®æˆ‘ä»¬åœ¨ Project1 ä¸­å·²ç»é‡åˆ°äº† RAII çš„ç”¨æ³•ï¼š\nstd::scoped_lock\u003cstd::mutex\u003e lock(mutex_); è¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªç»å…¸çš„ RAIIã€‚åœ¨åˆå§‹åŒ– lock æ—¶ï¼Œè°ƒç”¨ mutex_.Lock()ï¼Œåœ¨ææ„ lock æ—¶ï¼Œè°ƒç”¨ mutex_.Unlock()ã€‚è¿™æ ·å°±é€šè¿‡ç®€å•çš„ä¸€è¡Œä»£ç æˆåŠŸä¿è¯äº†åœ¨ lock çš„ä½œç”¨åŸŸä¸­å¯¹ mutex å…¨ç¨‹ä¸Šé”ã€‚ç¦»å¼€ lock çš„ä½œç”¨åŸŸåï¼Œç”±äº lock ææ„ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ã€‚\nä¸€å¼€å§‹ï¼Œæˆ‘ä¹Ÿæƒ³è¿‡ç”¨è¿™ç§æ–¹æ³•æ¥ç®¡ç† pageã€‚ä¾‹å¦‚ç¼–å†™ä¸€ä¸ªç±» PageManagerï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œfetch page \u0026 latch pageï¼Œåœ¨ææ„æ—¶ï¼Œunlatch page \u0026 unpin pageã€‚è¿™ä¸ªæƒ³æ³•å¥½åƒè¿˜è¡Œï¼Œä½†æ˜¯é‡åˆ°äº†ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼špage ä¼šåœ¨ä¸åŒå‡½æ•°é—´äº’ç›¸ä¼ é€’ï¼Œä»¥åŠå­˜åœ¨ç¦»å¼€ä½œç”¨åŸŸåä»éœ€æŒæœ‰ page èµ„æºçš„æƒ…å†µï¼Œæ¯”å¦‚ latch crabbing æ—¶å¯èƒ½éœ€è¦è·¨å‡½æ•°æŒé”ã€‚æˆ–è®¸å¯ä»¥é€šè¿‡ä¼ é€’ PageManager æŒ‡é’ˆçš„æ–¹å¼æ¥å¤„ç†ï¼Œä½†è¿™æ ·ä¼¼ä¹æ›´åŠ å¤æ‚äº†ã€‚\næ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ Insert æ“ä½œæ—¶ï¼Œå‡å¦‚éœ€è¦åˆ†è£‚ï¼Œä¼šå‘ä¸‹é€’å½’æ²¿é€”æŒé”ï¼Œç„¶åå‘ä¸Šé€’å½’è¿›è¡Œåˆ†è£‚ã€‚åœ¨åˆ†è£‚æ—¶ï¼Œéœ€è¦é‡æ–°ä» buffer pool è·å– pageã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè·å– page æ—¶ä¸èƒ½å¤Ÿå¯¹ page åŠ é”ï¼Œå› ä¸ºæ­¤å‰å‘ä¸‹é€’å½’æ—¶ page å·²ç»åŠ è¿‡é”äº†ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å†åŠ é”ä¼šæŠ›å¼‚å¸¸ã€‚\næ¯”å¦‚è¿™é‡Œçš„ä¾‹å­ã€‚åœ¨å‘ä¸Šé€’å½’æ—¶ï¼Œæˆ‘ä»¬å·²ç»è·å–è¿‡ parent page çš„é”ï¼Œå› æ­¤å†æ¬¡ä» buffer pool è·å– parent page æ—¶ï¼Œæ— éœ€å¯¹ parent page å†æ¬¡åŠ é”ã€‚\né‚£æœ‰æ²¡æœ‰åŠæ³•èƒ½å¤ŸçŸ¥é“æˆ‘ä»¬å¯¹å“ªäº› page åŠ è¿‡é”ï¼Ÿtransactionã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ª page å‡ºç°åœ¨ transaction çš„ page set ä¸­ï¼Œå°±ä»£è¡¨è¿™ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº†è¿™ä¸ª page çš„é”ã€‚\nå½“ç„¶ï¼Œé€šè¿‡è®¤çœŸåˆ†æå„ä¸ªæ“ä½œè·å– page çš„è·¯å¾„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°æŒé”çš„è§„å¾‹ã€‚\nSearch\nä»…å‘ä¸‹é€’å½’ï¼Œæ‹¿åˆ° child page å°±é‡Šæ”¾ parent pageã€‚è¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚è·å– page çš„è·¯å¾„ä» root åˆ° leaf æ˜¯ä¸€æ¡çº¿ã€‚åˆ°è¾¾ leaf æ—¶ï¼Œä»…æŒæœ‰ leaf çš„èµ„æºã€‚\nInsert\nå…ˆå‘ä¸‹é€’å½’ï¼Œå¯èƒ½ä¼šæŒæœ‰å¤šä¸ª parent page çš„é”ã€‚è·å– page çš„è·¯å¾„ä» root åˆ° leaf ä¹Ÿæ˜¯ä¸€æ¡çº¿ï¼ŒåŒºåˆ«æ˜¯ï¼Œåˆ°è¾¾ leaf æ—¶ï¼Œè¿˜å¯èƒ½æŒæœ‰å…¶ç¥–å…ˆçš„èµ„æºã€‚å†å‘ä¸Šé€’å½’ã€‚å‘ä¸Šé€’å½’çš„è·¯å¾„ä¸å‘ä¸‹é€’å½’çš„å®Œå…¨é‡åˆï¼Œä»…æ˜¯æ–¹å‘ç›¸åã€‚å› æ­¤ï¼Œå‘ä¸Šé€’å½’æ—¶ä¸éœ€è¦é‡å¤è·å– page èµ„æºï¼Œå¯ä»¥ç›´æ¥ä» transaction é‡Œæ‹¿åˆ° page æŒ‡é’ˆï¼Œç»•è¿‡å¯¹ buffer pool çš„è®¿é—®ã€‚åœ¨åˆ†è£‚æ—¶ï¼Œæ–°å»ºçš„ page ç”±äºè¿˜æœªè¿æ¥åˆ°æ ‘ä¸­ï¼Œä¸å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦ä¸Šé”ï¼Œä»…éœ€ unpinã€‚\nDelete\nå‘ä¸‹é€’å½’çš„æƒ…å†µä¸ Insert ç›¸åŒï¼Œè·¯å¾„ä¸ºä¸€æ¡çº¿ã€‚åˆ°è¾¾ leaf page åï¼Œæƒ…å†µæœ‰æ‰€ä¸åŒã€‚ç”±äºå¯èƒ½éœ€è¦å¯¹ sibling è¿›è¡Œ steal/mergeï¼Œè¿˜éœ€è·å– sibling çš„èµ„æºã€‚å› æ­¤ï¼Œåœ¨å‘ä¸Šé€’å½’æ—¶ï¼Œä¸»è¦è·¯å¾„ä¹Ÿä¸å‘ä¸‹é€’å½’çš„é‡åˆï¼Œä½†é™¤äº†è¿™æ¡çº¿ï¼Œè¿˜ä¼šæ²¿é€”è·å– sibling çš„èµ„æºï¼Œsibling éœ€è¦åŠ é”ï¼Œè€Œ parent page æ— éœ€å†æ¬¡åŠ é”ã€‚sibling åªæ˜¯æš‚æ—¶ä½¿ç”¨ï¼Œä½¿ç”¨å®Œä¹‹åå¯ä»¥ç›´æ¥é‡Šæ”¾ã€‚è€Œå‘ä¸‹é€’å½’è·¯å¾„ä¸Šçš„é”åœ¨æ•´ä¸ª Delete æ“ä½œå®Œæˆä¹‹åå†é‡Šæ”¾ã€‚\nç»è¿‡ä¸Šé¢çš„è®¨è®ºï¼Œå¯ä»¥å¾—å‡ºæˆ‘ä»¬é‡Šæ”¾èµ„æºçš„æ—¶æœºï¼šå‘ä¸‹é€’å½’è·¯å¾„ä¸Šçš„ page éœ€è¦å…¨ç¨‹æŒæœ‰ï¼ˆé™¤éèŠ‚ç‚¹å®‰å…¨ï¼Œæå‰é‡Šæ”¾ï¼‰ï¼Œåœ¨æ•´ä¸ªæ“ä½œå®Œæˆåç»Ÿä¸€é‡Šæ”¾ã€‚å…¶ä½™ page è¦ä¹ˆæ˜¯é‡å¤è·å–ï¼Œè¦ä¹ˆæ˜¯æš‚æ—¶è·å–ã€‚é‡å¤è·å–æ— éœ€åŠ é”ï¼Œä½¿ç”¨å®Œåç›´æ¥ unpinã€‚æš‚æ—¶è·å–ï¼ˆsteal/merge siblingï¼‰éœ€è¦åŠ é”ï¼Œä½¿ç”¨å®Œå unlatch \u0026 unpinã€‚\nDeadlockï¼Ÿ å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦æŒå¤šä¸ªé”æ—¶ï¼Œéƒ½æ˜¯ä»ä¸Šåˆ°ä¸‹åœ°è·å–é”ï¼Œè·å–é”çš„æ–¹å‘æ˜¯ç›¸åŒçš„ã€‚åœ¨å¯¹ sibling ä¸Šé”æ—¶ï¼Œä¸€å®šæŒæœ‰å…¶ parent page çš„é”ï¼Œå› æ­¤ä¸å¯èƒ½å­˜åœ¨å¦ä¸€ä¸ªæ—¢æŒæœ‰ sibling é”åˆæŒæœ‰ parent page é”çš„çº¿ç¨‹æ¥é€ æˆå¾ªç¯ç­‰å¾…ã€‚å› æ­¤ï¼Œæ­»é”æ˜¯ä¸å­˜åœ¨çš„ã€‚\nä½†å¦‚æœæŠŠ Index Iterator ä¹Ÿçº³å…¥è®¨è®ºï¼Œå°±æœ‰å¯èƒ½äº§ç”Ÿæ­»é”äº†ã€‚Index Iterator æ˜¯ä»å·¦åˆ°å³åœ°è·å– leaf page çš„é”ï¼Œå‡å¦‚å­˜åœ¨ä¸€ä¸ªéœ€è¦ steal/merge çš„ page å°è¯•è·å–å…¶ left sibling çš„é”ï¼Œåˆ™ä¸€ä¸ªä»å·¦åˆ°å³ï¼Œä¸€ä¸ªä»å³åˆ°å·¦ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”ã€‚å› æ­¤åœ¨ Index Iterator æ— æ³•è·å–é”æ—¶ï¼Œåº”æ”¾å¼ƒè·å–ã€‚\nOptimization å¯¹äº latch crabbingï¼Œå­˜åœ¨ä¸€ç§æ¯”è¾ƒç®€å•çš„ä¼˜åŒ–ã€‚åœ¨æ™®é€šçš„ latch crabbing ä¸­ï¼ŒInsert/Delete å‡éœ€å¯¹èŠ‚ç‚¹ä¸Šå†™é”ï¼Œè€Œè¶Šä¸Šå±‚çš„èŠ‚ç‚¹è¢«è®¿é—®çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œé”ç«äº‰ä¹Ÿè¶Šæ¿€çƒˆï¼Œé¢‘ç¹å¯¹ä¸Šå±‚èŠ‚ç‚¹ä¸Šäº’æ–¥çš„å†™é”å¯¹æ€§èƒ½å½±å“è¾ƒå¤§ã€‚å› æ­¤å¯ä»¥åšå‡ºå¦‚ä¸‹ä¼˜åŒ–ï¼š\nSearch æ“ä½œä¸å˜ï¼Œåœ¨ Insert/Delete æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä¹è§‚åœ°è®¤ä¸ºä¸ä¼šå‘ç”Ÿ split/steal/mergeï¼Œå¯¹æ²¿é€”çš„èŠ‚ç‚¹ä¸Šè¯»é”ï¼Œå¹¶åŠæ—¶é‡Šæ”¾ï¼Œå¯¹ leaf page ä¸Šå†™é”ã€‚å½“å‘ç°æ“ä½œå¯¹ leaf page ç¡®å®ä¸ä¼šé€ æˆ split/steal/merge æ—¶ï¼Œå¯ä»¥ç›´æ¥å®Œæˆæ“ä½œã€‚å½“å‘ç°æ“ä½œä¼šä½¿ leaf page split/steal/merge æ—¶ï¼Œåˆ™æ”¾å¼ƒæ‰€æœ‰æŒæœ‰çš„é”ï¼Œä» root page å¼€å§‹é‡æ–°æ‚²è§‚åœ°è¿›è¡Œè¿™æ¬¡æ“ä½œï¼Œå³æ²¿é€”ä¸Šå†™é”ã€‚\nè¿™ä¸ªä¼˜åŒ–å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹ FindLeaf() å³å¯ã€‚\nSummary æ•´ä¸ª Project2 çš„å†…å®¹å¤§è‡´å°±æ˜¯è¿™äº›ã€‚éš¾åº¦ç›¸å¯¹äº Project1 å¯ä»¥è¯´æ˜¯é™¡å¢ã€‚Checkpoint1 çš„éš¾ç‚¹ä¸»è¦åœ¨ç»†èŠ‚çš„å¤„ç†ä¸Šï¼ŒCheckpoint2 çš„éš¾ç‚¹åˆ™æ˜¯å¯¹ latch crabbing çš„æ­£ç¡®ç†è§£ã€‚å½“çœ‹åˆ°è‡ªå·±ä» 0 å®ç°çš„ B+ æ ‘èƒ½å¤Ÿæ­£ç¡®è¿è¡Œï¼Œç‰¹åˆ«æ˜¯å¯è§†åŒ–æ—¶ï¼Œè¿˜æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿçš„ã€‚\n",
  "wordCount" : "1644",
  "inLanguage": "en",
  "image":"http://localhost:1313/%3Cimage%20path/url%3E","datePublished": "2022-11-01T20:10:29+08:00",
  "dateModified": "2022-11-01T20:10:29+08:00",
  "author":{
    "@type": "Person",
    "name": "Me"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/cmu15-445-project2-b+tree-index/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Cookie's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/%3Clink%20/%20abs%20url%3E"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Home (Alt + H)">Home</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                <ul class="lang-switch"><li>|</li>
                </ul>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="â±archives">
                    <span>â±archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="ğŸ”Search">
                    <span>ğŸ”Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="ğŸ”–Tags">
                    <span>ğŸ”–Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;Â»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title">
      CMU15-445 Project2 B&#43;Tree Index
    </h1>
    <div class="post-description">
      Building a Concurrent B&#43;Tree Index.
    </div>
    <div class="post-meta">&lt;span title=&#39;2022-11-01 20:10:29 &#43;0800 CST&#39;&gt;2022-11-01&lt;/span&gt;&amp;nbsp;Â·&amp;nbsp;8 min&amp;nbsp;Â·&amp;nbsp;1644 words&amp;nbsp;Â·&amp;nbsp;Me&nbsp;|&nbsp;<a href="https://github.com/el-even-11/blog/content/posts/CMU15-445-Project2-B&#43;Tree-Index.md" rel="noopener noreferrer" target="_blank">Suggest Changes</a>

</div>
  </header> <div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#resources">Resources</a></li>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#checkpoint1-single-thread-btree">Checkpoint1 Single Thread B+Tree</a>
      <ul>
        <li><a href="#task1-btree-pages">Task1 B+Tree Pages</a></li>
        <li><a href="#task2-btree-data-structure-insertion-deletion-point-search">Task2 B+Tree Data Structure (Insertion, Deletion, Point Search)</a></li>
        <li><a href="#debug-your-btree">Debug Your B+Tree</a></li>
      </ul>
    </li>
    <li><a href="#checkpoint2-multi-thread-btree">Checkpoint2 Multi Thread B+Tree</a>
      <ul>
        <li><a href="#task3-index-iterator">Task3 Index Iterator</a></li>
        <li><a href="#task4-concurrent-index">Task4 Concurrent Index</a></li>
        <li><a href="#when-should-we-unlatch-and-unpin-pages">When should we unlatch and unpin pages?</a></li>
        <li><a href="#deadlock">Deadlockï¼Ÿ</a></li>
        <li><a href="#optimization">Optimization</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>æ¥è®°å½•ä¸€ä¸‹ Bustub å™©æ¢¦ B+ æ ‘çš„å®ç°è¿‡ç¨‹ã€‚</p>
<h2 id="resources">Resources<a hidden class="anchor" aria-hidden="true" href="#resources">#</a></h2>
<ul>
<li><a href="https://15445.courses.cs.cmu.edu/fall2022">https://15445.courses.cs.cmu.edu/fall2022</a> è¯¾ç¨‹å®˜ç½‘</li>
<li><a href="https://github.com/cmu-db/bustub">https://github.com/cmu-db/bustub</a> Bustub Github Repo</li>
<li><a href="https://www.gradescope.com/">https://www.gradescope.com/</a> è‡ªåŠ¨æµ‹è¯„ç½‘ç«™ GradeScopeï¼Œcourse entry code: PXWVR5</li>
<li><a href="https://discord.gg/YF7dMCg">https://discord.gg/YF7dMCg</a> Discord è®ºå›ï¼Œè¯¾ç¨‹äº¤æµç”¨</li>
<li>bilibili æœ‰æ¬è¿çš„è¯¾ç¨‹è§†é¢‘ï¼Œè‡ªå¯»ã€‚</li>
<li><a href="https://goneill.co.nz/btree-demo.php">https://goneill.co.nz/btree-demo.php</a> B+ æ ‘æ’å…¥åˆ é™¤çš„åŠ¨æ€æ¼”ç¤º</li>
</ul>
<p><strong>è¯·ä¸è¦å°†å®ç°ä»£ç å…¬å¼€ï¼Œå°Šé‡ Andy å’Œ TAs çš„åŠ³åŠ¨æˆæœï¼</strong></p>
<h2 id="overview">Overview<a hidden class="anchor" aria-hidden="true" href="#overview">#</a></h2>
<p>Project 2 éœ€è¦ä¸º Bustub å®ç° B+ æ ‘ç´¢å¼•ã€‚æ‹†åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>Checkpoint1: å•çº¿ç¨‹ B+ æ ‘</li>
<li>Checkpoint2: å¤šçº¿ç¨‹ B+ æ ‘</li>
</ul>
<p>å®éªŒä¸­ç»™å‡ºçš„ B+ æ ‘æ¥å£éå¸¸ç®€å•ï¼ŒåŸºæœ¬åªæœ‰æŸ¥è¯¢ã€æ’å…¥å’Œåˆ é™¤ä¸‰ä¸ªæ¥å£ï¼Œå†…éƒ¨åŸºæœ¬æ²¡æœ‰ç»™å‡ºåˆ«çš„è¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±å‘æŒ¥ï¼ˆæ— ä»ä¸‹æ‰‹ï¼‰ã€‚å› æ­¤ï¼Œä»»ä½•åˆæ³•çš„ B+ æ ‘å®ç°éƒ½æ˜¯å…è®¸çš„ã€‚</p>
<p>B+ æ ‘ç´¢å¼•åœ¨ Bustub ä¸­çš„ä½ç½®å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img loading="lazy" src="../../imgs/15-445-2-1.png" alt=""  />
</p>
<p>éœ€è¦ä½¿ç”¨æˆ‘ä»¬åœ¨ Project 1 ä¸­å®ç°çš„ buffer pool manager æ¥è·å– pageã€‚</p>
<h2 id="checkpoint1-single-thread-btree">Checkpoint1 Single Thread B+Tree<a hidden class="anchor" aria-hidden="true" href="#checkpoint1-single-thread-btree">#</a></h2>
<p>Checkpoint1 åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>Task1: B+Tree pagesï¼ŒB+æ ‘ä¸­çš„å„ç§ pageã€‚åœ¨ Bustub ç´¢å¼• B+ æ ‘ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ pageã€‚åŒ…å« leaf pageï¼Œinternal page ï¼Œå’Œå®ƒä»¬çš„çˆ¶ç±» tree pageã€‚</li>
<li>Task2ï¼šB+Tree Data Structure (Insertion, Deletion, Point Search)ã€‚Checkpoint1 çš„é‡ç‚¹ï¼Œå³ B+æ ‘çš„æ’å…¥ã€åˆ é™¤å’Œå•ç‚¹æŸ¥è¯¢ã€‚</li>
</ul>
<h3 id="task1-btree-pages">Task1 B+Tree Pages<a hidden class="anchor" aria-hidden="true" href="#task1-btree-pages">#</a></h3>
<p>Task1 çš„å®ç°éå¸¸ç®€å•ï¼Œéƒ½æ˜¯ä¸€äº›æ™®é€šçš„ Getter å’Œ Setterã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸€ä¸‹ page çš„å†…å­˜å¸ƒå±€ã€‚</p>
<p>åœ¨ Project 1 ä¸­æˆ‘ä»¬ç¬¬ä¸€æ¬¡ä¸ page æ‰“äº¤é“ã€‚page å®é™…ä¸Šå¯ä»¥å­˜å‚¨æ•°æ®åº“å†…å¾ˆå¤šç§ç±»çš„æ•°æ®ã€‚ä¾‹å¦‚ç´¢å¼•å’Œå®é™…çš„è¡¨æ•°æ®ç­‰ç­‰ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="cm">/** The actual data that is stored within a page. */</span>
</span></span><span class="line"><span class="cl"><span class="kt">char</span> <span class="n">data_</span><span class="p">[</span><span class="n">BUSTUB_PAGE_SIZE</span><span class="p">]{};</span>
</span></span><span class="line"><span class="cl"><span class="cm">/** The ID of this page. */</span>
</span></span><span class="line"><span class="cl"><span class="n">page_id_t</span> <span class="n">page_id_</span> <span class="o">=</span> <span class="n">INVALID_PAGE_ID</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/** The pin count of this page. */</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">pin_count_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/** True if the page is dirty, i.e. it is different from its corresponding page on disk. */</span>
</span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">is_dirty_</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/** Page latch. */</span>
</span></span><span class="line"><span class="cl"><span class="n">ReaderWriterLatch</span> <span class="n">rwlatch_</span><span class="p">;</span>
</span></span></code></pre></div><p><img loading="lazy" src="../../imgs/15-445-2-2.png" alt=""  />
</p>
<p>å…¶ä¸­ï¼Œ<code>data_</code> æ˜¯å®é™…å­˜æ”¾ page æ•°æ®çš„åœ°æ–¹ï¼Œå¤§å°ä¸º <code>BUSTUB_PAGE_SIZE</code>ï¼Œä¸º 4KBã€‚å…¶ä»–çš„æˆå‘˜æ˜¯ page çš„ metadataã€‚</p>
<p>B+æ ‘ä¸­çš„ tree age æ•°æ®å‡å­˜æ”¾åœ¨ page çš„ data æˆå‘˜ä¸­ã€‚</p>
<p><strong>B_PLUS_TREE_PAGE</strong></p>
<p><code>b_plus_tree_page</code> æ˜¯å¦å¤–ä¸¤ä¸ª page çš„çˆ¶ç±»ï¼Œå³ B+æ ‘ä¸­ tree page çš„æŠ½è±¡ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">IndexPageType</span> <span class="n">page_type_</span><span class="p">;</span>   <span class="c1">// leaf or internal. 4 Byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">lsn_t</span> <span class="n">lsn_</span>  <span class="c1">// temporarily unused. 4 Byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">size_</span><span class="p">;</span>  <span class="c1">// tree page data size(not in byte, in count). 4 Byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">max_size_</span><span class="p">;</span>  <span class="c1">// tree page data max size(not in byte, in count). 4 Byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">page_id_t</span> <span class="n">parent_page_id_</span><span class="p">;</span> <span class="c1">// 4 Byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">page_id_t</span> <span class="n">page_id_</span><span class="p">;</span> <span class="c1">// 4 Byte
</span></span></span><span class="line"><span class="cl"><span class="c1">// 24 Byte in total
</span></span></span></code></pre></div><p>ä»¥ä¸Šæ•°æ®ç»„æˆäº† tree page çš„ headerã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-3.png" alt=""  />
</p>
<p>page data çš„ 4KB ä¸­ï¼Œ24Byte ç”¨äºå­˜æ”¾ headerï¼Œå‰©ä¸‹çš„åˆ™ç”¨äºå­˜æ”¾ tree page çš„æ•°æ®ï¼Œå³ KV å¯¹ã€‚</p>
<p><strong>B_PLUS_TREE_INTERNAL_PAGE</strong></p>
<p>å¯¹åº” B+ æ ‘ä¸­çš„å†…éƒ¨èŠ‚ç‚¹ã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">MappingType</span> <span class="n">array_</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span></code></pre></div><p>internal page ä¸­æ²¡æœ‰æ–°çš„ metadataï¼Œheader å¤§å°ä»ä¸º 24Bã€‚å®ƒå”¯ä¸€çš„æˆå‘˜æ˜¯è¿™ä¸ªæ€ªæ€ªçš„å¤§å°ä¸º 1 çš„æ•°ç»„ã€‚å¤§å°ä¸º 1 æ˜¾ç„¶ä¸åˆç†ï¼Œä»£è¡¨åªèƒ½å­˜æ”¾ä¸€ä¸ª KV å¯¹ã€‚ä½†åˆæ²¡æ³•æ”¹å˜å®ƒçš„å¤§å°ï¼Œéš¾é“è¦ç”¨ undefined behavior æ¥è¶Šç•Œè®¿é—®å…¶åçš„åœ°å€ï¼Ÿå®é™…ä¸Šå·®ä¸å¤šå°±æ˜¯è¿™ä¸ªæ„æ€ã€‚ä½†è¿™ä¸æ˜¯ undefined behaviorï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„å†™æ³•ï¼Œå«åš flexible arrayã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘ã€‚</p>
<p>ç®€å•æ¥è¯´å°±æ˜¯ï¼Œå½“ä½ æœ‰ä¸€ä¸ªç±»ï¼Œè¿™ä¸ªç±»ä¸­æœ‰ä¸€ä¸ªæˆå‘˜ä¸ºæ•°ç»„ã€‚åœ¨ç”¨è¿™ä¸ªç±»åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä½ ä¸èƒ½ç¡®å®šè¯¥å°†è¿™ä¸ªæ•°ç»„çš„å¤§å°è®¾ç½®ä¸ºå¤šå°‘ï¼Œä½†çŸ¥é“è¿™æ•´ä¸ªå¯¹è±¡çš„å¤§å°æ˜¯å¤šå°‘ byteï¼Œä½ å°±å¯ä»¥ç”¨åˆ° flexible arrayã€‚flexible array å¿…é¡»æ˜¯ç±»ä¸­çš„æœ€åä¸€ä¸ªæˆå‘˜ï¼Œå¹¶ä¸”ä»…èƒ½æœ‰ä¸€ä¸ªã€‚åœ¨ä¸ºå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œflexible array ä¼šè‡ªåŠ¨å¡«å……ï¼Œå ç”¨æœªè¢«å…¶ä»–å˜é‡ä½¿ç”¨çš„å†…å­˜ã€‚è¿™æ ·å°±å¯ä»¥ç¡®å®šè‡ªå·±çš„é•¿åº¦äº†ã€‚</p>
<p>ä¾‹å¦‚æœ‰ä¸€ä¸ªç±» Cï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span> <span class="c1">// 4 byte
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">array</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">// unknown size
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></div><p>ç°åœ¨åˆå§‹åŒ–ä¸€ä¸ª C çš„å¯¹è±¡ï¼Œå¹¶ä¸ºå…¶åˆ†é…äº† 24 byte çš„å†…å­˜ã€‚<code>a</code> å äº† 4 byte å†…å­˜ï¼Œé‚£ä¹ˆ <code>array</code> ä¼šå°è¯•å¡«å……å‰©ä¸‹çš„å†…å­˜ï¼Œå¤§å°å˜ä¸º 5ã€‚</p>
<p>å®é™…ä¸Šè¿™å°±æ˜¯ C++ å¯¹è±¡å†…å­˜å¸ƒå±€çš„ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚å› æ­¤ flexible array ä¸ºä»€ä¹ˆåªèƒ½æœ‰ä¸€ä¸ªä¸”å¿…é¡»æ”¾åœ¨æœ€åä¸€ä¸ªå°±å¾ˆæ˜æ˜¾äº†ï¼Œå› ä¸ºéœ€è¦å‘åå°è¯•å¡«å……ã€‚</p>
<p>æ­¤å¤–ï¼Œè™½ç„¶æˆå‘˜åœ¨å†…å­˜ä¸­çš„å…ˆåé¡ºåºå’Œå£°æ˜çš„é¡ºåºä¸€è‡´ï¼Œä½†éœ€è¦æ³¨æ„å¯èƒ½å­˜åœ¨çš„å†…å­˜å¯¹é½çš„é—®é¢˜ã€‚header ä¸­çš„æ•°æ®å¤§å°éƒ½ä¸º 4 byteï¼Œæ²¡æœ‰å¯¹é½é—®é¢˜ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œè¿™ä¸ªå¤§å°ä¸º 1 çš„æ•°ç»„çš„ä½œç”¨å°±æ¯”è¾ƒæ¸…æ¥šäº†ã€‚åˆ©ç”¨ flexible array çš„ç‰¹æ€§æ¥è‡ªåŠ¨å¡«å…… page data 4KB å‡æ‰ header 24byte åå‰©ä½™çš„å†…å­˜ã€‚å‰©ä¸‹çš„è¿™äº›å†…å­˜ç”¨æ¥å­˜æ”¾ KV å¯¹ã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-4.png" alt=""  />
</p>
<p>internal page ä¸­ï¼ŒKV å¯¹çš„ K æ˜¯èƒ½å¤Ÿæ¯”è¾ƒå¤§å°çš„ç´¢å¼•ï¼ŒV æ˜¯ page idï¼Œç”¨æ¥æŒ‡å‘ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚Project ä¸­è¦æ±‚ï¼Œç¬¬ä¸€ä¸ª Key ä¸ºç©ºã€‚ä¸»è¦æ˜¯å› ä¸ºåœ¨ internal page ä¸­ï¼Œn ä¸ª key å¯ä»¥å°†æ•°è½´åˆ’åˆ†ä¸º n+1 ä¸ªåŒºåŸŸï¼Œä¹Ÿå°±å¯¹åº”ç€ n+1 ä¸ª valueã€‚å®é™…ä¸Šä½ ä¹Ÿå¯ä»¥æŠŠæœ€åä¸€ä¸ª key å½“ä½œæ˜¯ç©ºçš„ï¼Œåªè¦åç»­çš„å¤„ç†è‡ªæ´½å°±å¯ä»¥äº†ã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-5.png" alt=""  />
</p>
<p>é€šè¿‡æ¯”è¾ƒ key çš„å¤§å°é€‰ä¸­ä¸‹ä¸€å±‚çš„èŠ‚ç‚¹ã€‚å®é™…ä¸Šç­‰å·çš„ä½ç½®ä¹Ÿå¯ä»¥æ”¹å˜ï¼Œæ€»ä¹‹ï¼Œåªè¦æ˜¯åˆæ³•çš„ B+ æ ‘ï¼Œå³èŠ‚ç‚¹å¤§å°éœ€è¦æ»¡è¶³æœ€å¤§æœ€å°å€¼çš„é™åˆ¶ï¼Œå„ç§å®ç°ç»†èŠ‚éƒ½æ˜¯è‡ªç”±çš„ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œinternal page ä¸­çš„ key å¹¶ä¸ä»£è¡¨å®é™…ä¸Šçš„ç´¢å¼•å€¼ï¼Œä»…ä»…æ˜¯ä½œä¸ºä¸€ä¸ªå‘å¯¼ï¼Œå¼•å¯¼éœ€è¦æ’å…¥/åˆ é™¤/æŸ¥è¯¢çš„ key æ‰¾åˆ°è¿™ä¸ª key çœŸæ­£æ‰€åœ¨çš„ leaf pageã€‚</p>
<p><strong>B_PLUS_TREE_LEAF_PAGE</strong></p>
<p>leaf page å’Œ internal page çš„å†…å­˜å¸ƒå±€åŸºæœ¬ä¸€æ ·ï¼Œåªæ˜¯ leaf page å¤šäº†ä¸€ä¸ªæˆå‘˜å˜é‡ <code>next_page_id</code>ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ª leaf pageï¼ˆç”¨äº range scanï¼‰ã€‚å› æ­¤ leaf page çš„ header å¤§å°ä¸º 28 Byteã€‚</p>
<p>leaf page çš„ KV å¯¹ä¸­ï¼ŒK æ˜¯å®é™…çš„ç´¢å¼•ï¼ŒV æ˜¯ record idã€‚record id ç”¨äºè¯†åˆ«è¡¨ä¸­çš„æŸä¸€æ¡æ•°æ®ã€‚leaf page çš„ KV å¯¹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œä¸åƒ internal page çš„ value å¤šä¸€ä¸ªã€‚è¿™é‡Œä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ Bustub æ‰€æœ‰çš„ B+ æ ‘ç´¢å¼•ï¼Œæ— è®ºæ˜¯ä¸»é”®ç´¢å¼•è¿˜æ˜¯äºŒçº§ç´¢å¼•éƒ½æ˜¯éèšç°‡ç´¢å¼•ã€‚</p>
<blockquote>
<p>è¿™é‡Œç®€å•ä»‹ç»ä¸€ä¸‹èšç°‡ç´¢å¼•ã€éèšç°‡ç´¢å¼•ï¼Œä¸»é”®ç´¢å¼•ã€äºŒçº§ç´¢å¼•ï¼ˆéä¸»é”®ç´¢å¼•ï¼‰çš„åŒºåˆ«ã€‚
åœ¨èšç°‡ç´¢å¼•é‡Œï¼Œleaf page çš„ value ä¸ºè¡¨ä¸­ä¸€æ¡æ•°æ®çš„æŸå‡ ä¸ªå­—æ®µæˆ–æ‰€æœ‰å­—æ®µï¼Œä¸€å®šåŒ…å«ä¸»é”®å­—æ®µã€‚è€Œéèšç°‡ç´¢å¼• leaf page çš„ value æ˜¯ record idï¼Œå³æŒ‡å‘ä¸€æ¡æ•°æ®çš„æŒ‡é’ˆã€‚
åœ¨ä½¿ç”¨èšç°‡ç´¢å¼•æ—¶ï¼Œä¸»é”®ç´¢å¼•çš„ leaf page åŒ…å«æ‰€æœ‰å­—æ®µï¼ŒäºŒçº§ç´¢å¼•çš„ leaf page åŒ…å«ä¸»é”®å’Œç´¢å¼•å­—æ®µã€‚å½“ä½¿ç”¨ä¸»é”®æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢åˆ° leaf page å³å¯è·å¾—æ•´æ¡æ•°æ®ã€‚å½“ä½¿ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ—¶ï¼Œè‹¥æŸ¥è¯¢å­—æ®µåŒ…å«åœ¨ç´¢å¼•å†…ï¼Œå¯ä»¥ç›´æ¥å¾—åˆ°ç»“æœï¼Œä½†å¦‚æœæŸ¥è¯¢å­—æ®µä¸åŒ…å«åœ¨ç´¢å¼•å†…ï¼Œåˆ™éœ€ä½¿ç”¨å¾—åˆ°çš„ä¸»é”®å­—æ®µåœ¨ä¸»é”®ç´¢å¼•ä¸­å†æ¬¡æŸ¥è¯¢ï¼Œä»¥å¾—åˆ°æ‰€æœ‰çš„å­—æ®µï¼Œè¿›è€Œå¾—åˆ°éœ€è¦æŸ¥è¯¢çš„å­—æ®µï¼Œè¿™å°±æ˜¯å›è¡¨çš„è¿‡ç¨‹ã€‚
åœ¨ä½¿ç”¨éèšç°‡ç´¢å¼•æ—¶ï¼Œæ— è®ºæ˜¯ä½¿ç”¨ä¸»é”®æŸ¥è¯¢è¿˜æ˜¯äºŒçº§ç´¢å¼•æŸ¥è¯¢ï¼Œæœ€ç»ˆå¾—åˆ°çš„ç»“æœéƒ½æ˜¯ record idï¼Œéœ€è¦ä½¿ç”¨ record id å»æŸ¥è¯¢çœŸæ­£å¯¹åº”çš„æ•´æ¡è®°å½•ã€‚
èšç°‡ç´¢å¼•çš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´æ¡è®°å½•ç›´æ¥å­˜æ”¾åœ¨ leaf pageï¼Œæ— éœ€äºŒæ¬¡æŸ¥è¯¢ï¼Œä¸”ç¼“å­˜å‘½ä¸­ç‡é«˜ï¼Œåœ¨ä½¿ç”¨ä¸»é”®æŸ¥è¯¢æ—¶æ€§èƒ½æ¯”è¾ƒå¥½ã€‚ç¼ºç‚¹åˆ™æ˜¯äºŒçº§ç´¢å¼•å¯èƒ½éœ€è¦å›è¡¨ï¼Œä¸”ç”±äºæ•´æ¡æ•°æ®å­˜æ”¾åœ¨ leaf pageï¼Œæ›´æ–°ç´¢å¼•çš„ä»£ä»·å¾ˆé«˜ï¼Œé¡µåˆ†è£‚ã€åˆå¹¶ç­‰æƒ…å†µå¼€é”€æ¯”è¾ƒå¤§ã€‚
éèšç°‡ç´¢å¼•çš„ä¼˜ç‚¹æ˜¯ï¼Œç”±äº leaf page ä»…å­˜æ”¾ record idï¼Œæ›´æ–°çš„ä»£ä»·è¾ƒä½ï¼ŒäºŒçº§ç´¢å¼•çš„æ€§èƒ½å’Œä¸»é”®ç´¢å¼•å‡ ä¹ç›¸åŒã€‚ç¼ºç‚¹æ˜¯æŸ¥è¯¢æ—¶å‡éœ€ä½¿ç”¨ record id è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ã€‚</p>
</blockquote>
<p>Task1 çš„ä¸»è¦å†…å®¹å°±æ˜¯è¿™äº›ã€‚å®é™…ä¸Šè¦å®ç°çš„å†…å®¹éå¸¸ç®€å•ï¼Œé‡ç‚¹æ˜¯ç†è§£å„ä¸ª page çš„ä½œç”¨å’Œå†…å­˜å¸ƒå±€ã€‚</p>
<h3 id="task2-btree-data-structure-insertion-deletion-point-search">Task2 B+Tree Data Structure (Insertion, Deletion, Point Search)<a hidden class="anchor" aria-hidden="true" href="#task2-btree-data-structure-insertion-deletion-point-search">#</a></h3>
<p>Task2 æ˜¯å•çº¿ç¨‹ B+ æ ‘çš„é‡ç‚¹ã€‚é¦–å…ˆæä¾›æ¼”ç¤ºä¸€ä¸ª B+ æ ‘æ’å…¥åˆ é™¤æ“ä½œçš„ <a href="https://goneill.co.nz/btree-demo.php">ç½‘ç«™</a>ã€‚ä¸»è¦æ˜¯çœ‹çœ‹ B+ æ ‘æ’å…¥åˆ é™¤çš„å„ç§ç»†èŠ‚å˜åŒ–ã€‚å½“ç„¶å…·ä½“å®ç°æ˜¯è‡ªç”±çš„ï¼Œè¿™ä»…ä»…æ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<p><strong>Search</strong></p>
<p>å…ˆä»æœ€ç®€å•çš„ Point Search å¼€å§‹ã€‚B+ æ ‘çš„ç»“æ„åº”è¯¥éƒ½æ¯”è¾ƒç†Ÿæ‚‰äº†ï¼ŒèŠ‚ç‚¹åˆ†ä¸º internal page å’Œ leaf pageï¼Œæ¯ä¸ª page ä¸Šçš„ key æœ‰åºæ’åˆ—ã€‚å½“æ‹¿åˆ°ä¸€ä¸ª key éœ€è¦æŸ¥æ‰¾å¯¹åº”çš„ value æ—¶ï¼Œé¦–å…ˆéœ€è¦ç»ç”± internal page é€’å½’åœ°å‘ä¸‹æŸ¥æ‰¾ï¼Œæœ€ç»ˆæ‰¾åˆ° key æ‰€åœ¨çš„ leaf pageã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªå‡½æ•° <code>Findleaf()</code>ã€‚</p>
<p><code>Findleaf()</code> ä» root page å¼€å§‹æŸ¥æ‰¾ã€‚åœ¨æŸ¥æ‰¾åˆ° leaf page æ—¶ç›´æ¥è¿”å›ï¼Œå¦åˆ™æ ¹æ® key åœ¨å½“å‰ internal page ä¸­æ‰¾åˆ°å¯¹åº”çš„ child page idï¼Œé€’å½’è°ƒç”¨ <code>Findleaf</code>ã€‚æ ¹æ® key æŸ¥æ‰¾å¯¹åº” child id æ—¶ï¼Œç”±äº key æ˜¯æœ‰åºçš„ï¼Œå¯ä»¥ç›´æ¥è¿›è¡ŒäºŒåˆ†æœç´¢ã€‚15-445 Lecture ä¸­ä¹Ÿä»‹ç»äº†ä¸€äº›å…¶ä»–çš„æ–¹æ³•ï¼Œæ¯”å¦‚ç”¨ SIMD å¹¶è¡Œæ¯”è¾ƒï¼Œæ’å€¼æ³•ç­‰ç­‰ã€‚åœ¨è¿™é‡ŒäºŒåˆ†æœç´¢å°±å¯ä»¥äº†ã€‚</p>
<p>internal page ä¸­å‚¨å­˜ key å’Œ child page idï¼Œé‚£ä¹ˆåœ¨æ‹¿åˆ° page id åå¦‚ä½•è·å¾—å¯¹åº”çš„ page æŒ‡é’ˆï¼Ÿç”¨ Project 1 ä¸­å®ç°çš„ buffer poolã€‚</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">Page</span> <span class="o">*</span><span class="n">page</span> <span class="o">=</span> <span class="n">buffer_pool_manager_</span><span class="o">-&gt;</span><span class="n">FetchPage</span><span class="p">(</span><span class="n">page_id</span><span class="p">);</span>
</span></span></code></pre></div><p>åŒæ ·åœ°ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦æ–°å»ºä¸€ä¸ª pageï¼Œä¹Ÿæ˜¯è°ƒç”¨ buffer pool çš„ <code>NewPage()</code>ã€‚</p>
<p>åœ¨è·å–åˆ°ä¸€ä¸ª page åï¼Œå¦‚ä½•ä½¿ç”¨è¿™ä¸ª page æ¥å­˜å‚¨æ•°æ®ï¼Ÿä¹‹å‰å·²ç»æåˆ°è¿‡ï¼Œpage çš„ <code>data_</code> å­—æ®µæ˜¯å®é™…ç”¨äºå­˜å‚¨æ•°æ®çš„ 4KB å¤§å°çš„å­—èŠ‚æ•°ç»„ã€‚é€šè¿‡ <code>reinterpret_cast</code> å°†è¿™ä¸ªå­—èŠ‚æ•°ç»„å¼ºåˆ¶è½¬æ¢ä¸ºæˆ‘ä»¬è¦ä½¿ç”¨çš„ç±»å‹ï¼Œä¾‹å¦‚ leaf pageï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">auto</span> <span class="n">leaf_page</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">B_PLUS_TREE_LEAF_PAGE_TYPE</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">page</span><span class="o">-&gt;</span><span class="n">GetData</span><span class="p">())</span>
</span></span></code></pre></div><p><code>reinterpret_cast</code> ç”¨äºæ— å…³ç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼Œè½¬æ¢æ–¹æ³•å¾ˆç®€å•ï¼ŒåŸå§‹ bits ä¸å˜ï¼Œåªæ˜¯å¯¹è¿™äº› bits ç”¨æ–°ç±»å‹è¿›è¡Œäº†é‡æ–°çš„è§£è¯»ã€‚å¯æƒ³è€ŒçŸ¥è¿™ç§è½¬æ¢éå¸¸ä¸å®‰å…¨ï¼Œéœ€è¦ç¡®ä¿è½¬æ¢åçš„å†…å­˜å¸ƒå±€ä»æ˜¯åˆæ³•çš„ã€‚åœ¨è¿™é‡ŒåŸç±»å‹æ˜¯ byte æ•°ç»„ï¼Œæ–°ç±»å‹æ˜¯æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„ tree pageã€‚</p>
<p>æ‰¾åˆ° leaf page åï¼ŒåŒæ ·æ˜¯äºŒåˆ†æŸ¥æ‰¾ keyï¼Œæ‰¾åˆ°å¯¹åº”çš„ record idã€‚</p>
<p>æŸ¥æ‰¾çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦ä¸”å¤æ‚çš„ç»†èŠ‚ï¼Œå°±æ˜¯ page unpin çš„é—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ‹¿åˆ° page id åï¼Œè°ƒç”¨ buffer pool çš„ <code>FetchPage()</code> å‡½æ•°æ¥è·å–å¯¹åº”çš„ page æŒ‡é’ˆã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä½¿ç”¨å®Œ page ä¹‹åï¼Œéœ€è¦å°† page unpin æ‰ï¼Œå¦åˆ™æœ€ç»ˆä¼šå¯¼è‡´ buffer pool ä¸­çš„æ‰€æœ‰ page éƒ½è¢« pin ä½ï¼Œæ— æ³•ä» disk è¯»å–å…¶ä»–çš„ pageã€‚</p>
<p>æ¯”è¾ƒåˆé€‚çš„åšæ³•æ˜¯ï¼Œåœ¨æœ¬æ¬¡æ“ä½œä¸­ï¼Œæ‰¾å‡º page æœ€åä¸€æ¬¡è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼Œå¹¶åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨å unpinã€‚</p>
<p><strong>Insert</strong></p>
<p>ä¸ Search ç›¸åŒï¼Œç¬¬ä¸€æ­¥æ˜¯æ ¹æ® key æ‰¾åˆ°éœ€è¦æ’å…¥çš„ leaf pageã€‚åŒæ ·æ˜¯è°ƒç”¨ <code>Findleaf()</code>ã€‚å¾—åˆ° leaf page åï¼Œå°† key æ’å…¥ leaf pageã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œæ’å…¥æ—¶ä»éœ€ä¿è¯ key çš„æœ‰åºæ€§ã€‚åŒæ ·å¯ä»¥äºŒåˆ†æœç´¢æ‰¾åˆ°åˆé€‚çš„ä½ç½®æ’å…¥ã€‚</p>
<p>åœ¨æ’å…¥åï¼Œéœ€è¦æ£€æŸ¥å½“å‰ leaf page size æ˜¯å¦ç­‰äº max sizeã€‚è‹¥ç›¸ç­‰ï¼Œåˆ™è¦è¿›è¡Œä¸€æ¬¡ leaf page åˆ†è£‚æ“ä½œã€‚å…·ä½“æ­¥éª¤ä¸ºï¼š</p>
<ol>
<li>æ–°å»ºä¸€ä¸ªç©ºçš„ pageï¼Œ</li>
<li>å°†åŸ page çš„ä¸€åŠè½¬ç§»åˆ°æ–° page ä¸­ï¼Œï¼ˆå‡å¦‚é€‰æ‹©å°†æ–° page æ”¾åœ¨åŸ page å³ä¾§ï¼Œåˆ™è½¬ç§»åŸ page çš„å³åŠéƒ¨åˆ†ï¼‰</li>
<li>æ›´æ–°åŸ page å’Œæ–° page çš„ next page idï¼Œ</li>
<li>è·å– parent pageï¼Œ</li>
<li>å°†ç”¨äºåŒºåˆ†åŸ page å’Œæ–° page çš„ key æ’å…¥ parent page ä¸­ï¼Œ</li>
<li>æ›´æ–° parent page æ‰€æœ‰ child page çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
</ol>
<p>è¿™äº›æ­¥éª¤éƒ½æ¯”è¾ƒå¥½ç†è§£ã€‚éœ€è¦ç»™ parent page æ’å…¥ä¸€ä¸ªæ–° key çš„åŸå› æ˜¯ï¼Œå¤šäº†ä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œè‡ªç„¶éœ€è¦å¤šä¸€ä¸ª key æ¥åŒºåˆ†ã€‚å…¶ä¸­ç¬¬ 4 æ­¥æ˜¯é‡ç‚¹ã€‚è·å– parent page å¹¶ä¸æ˜¯ç®€å•åœ°é€šè¿‡å½“å‰ page çš„ parent id æ¥è·å–ï¼Œå› ä¸º parent page ä¹Ÿå¯èƒ½å‘ç”Ÿåˆ†è£‚ã€‚</p>
<p>å‡å¦‚æˆ‘ä»¬æœ‰ä¸€æ£µ 5 é˜¶çš„ B+ æ ‘ã€‚5 é˜¶åªæ˜¯ä¸€ç§å¸¸ç”¨çš„è¯´æ³•ï¼Œä»£è¡¨ B+ æ ‘èŠ‚ç‚¹æœ€å¤šèƒ½å®¹çº³äº”ä¸ª KV å¯¹ã€‚å¯¹äº leaf page æ¥è¯´ï¼Œå½“ B+ æ ‘å¤„äºç¨³å®šçŠ¶æ€æ—¶ï¼ˆæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œå·²ç»å®Œå…¨ç»“æŸï¼‰ï¼Œæœ€å¤šåªèƒ½æœ‰ 4 ä¸ª KV å¯¹ã€‚å¯¹äº internal pageï¼Œæœ€å¤šæœ‰ 4 ä¸ª keyï¼Œ5 ä¸ª valueï¼Œå¯ä»¥çœ‹æˆæ˜¯æœ‰ 5 ä¸ª KV å¯¹ã€‚</p>
<p>å› æ­¤ï¼Œinstruction ä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š</p>
<blockquote>
<p>You should correctly perform splits if insertion triggers the splitting condition (number of key/value pairs <strong>AFTER</strong> insertion equals to max_size for leaf nodes, number of children <strong>BEFORE</strong> insertion equals to max_size for internal nodes.).</p>
</blockquote>
<p>åœ¨æ’å…¥åæ£€æµ‹ leaf page æ˜¯å¦éœ€è¦åˆ†è£‚ï¼Œå› ä¸º leaf page ç¨³å®šæ—¶åªæœ‰ 4 ä¸ª KV å¯¹ï¼Œæ’å…¥åæœ‰ 5 ä¸ªï¼Œä»èƒ½å®¹çº³ã€‚åœ¨æ’å…¥å‰æ£€æµ‹ internal pageï¼Œå› ä¸º internal page ç¨³å®šæ—¶å°±æœ‰ 5 ä¸ª KV å¯¹ï¼Œè‹¥æ’å…¥åå†æ£€æµ‹ï¼Œæ’å…¥çš„ç¬¬ 6 ä¸ª KV å¯¹ä¼šé€ æˆè¶Šç•Œã€‚</p>
<p>å®é™…ä¸Šè¿™ä¹Ÿåªæ˜¯ä¸€ç§çº¦å®šï¼Œå¹¶ä¸æ˜¯å¼ºåˆ¶çš„è§„åˆ™ã€‚</p>
<p>åœ¨ç¬¬ 5 æ­¥æˆ‘ä»¬å¯ä»¥æ‹¿åˆ° parent page å®‰å…¨åœ°æ’å…¥ KV å¯¹ï¼Œæ˜¯å› ä¸ºåœ¨ç¬¬ 4 æ­¥ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›ä¸€ä¸ªå®‰å…¨çš„ parent pageã€‚</p>
<p>ç¬¬ 4 æ­¥å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p>
<ol>
<li>æ ¹æ® parent page id æ‹¿åˆ° parent pageï¼Œ</li>
<li>åˆ¤æ–­ parent page size æ˜¯å¦ç­‰äº max sizeï¼Œï¼ˆæ’å…¥å‰æ£€æŸ¥ï¼‰</li>
<li>è‹¥å°äºï¼Œç›´æ¥è¿”å› parent pageï¼Œ</li>
<li>å¦åˆ™ï¼Œåˆ†è£‚å½“å‰ internal pageã€‚å¹¶æ ¹æ®æ­¤åéœ€è¦æ’å…¥çš„ key é€‰æ‹©åˆ†è£‚åçš„ä¸¤ä¸ª page ä¹‹ä¸€ä½œä¸º parent page è¿”å›ã€‚</li>
</ol>
<p>åˆ†è£‚ internal page çš„æ­¥éª¤ä¸ºï¼š</p>
<ol>
<li>æ–°å»ºä¸€ä¸ªç©ºçš„ pageï¼Œ</li>
<li>å°†åŸ page çš„ä¸€åŠè½¬ç§»åˆ°æ–° page ä¸­ï¼Œéœ€è¦æ³¨æ„åŸ page å’Œæ–° page çš„ç¬¬ä¸€ä¸ª key éƒ½æ˜¯æ— æ•ˆçš„ï¼Œ</li>
<li>æ›´æ–°æ–° page æ‰€æœ‰ child page çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆï¼ŒæŒ‡å‘æ–° pageï¼Œ</li>
<li>è·å– parent pageï¼Œ</li>
<li>å°†ç”¨äºåŒºåˆ†åŸ page å’Œæ–° page çš„ key æ’å…¥ parent page ä¸­ï¼Œ</li>
<li>æ›´æ–° parent page æ‰€æœ‰ child page çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚</li>
</ol>
<p>å¯ä»¥å‘ç°ï¼Œç¬¬ 4 æ­¥åŒæ ·æ˜¯éœ€è¦é‡å¤ä¸Šè¿°æ­¥éª¤ã€‚è¿™é‡Œå°±å‘ç”Ÿäº†å‘ä¸Šçš„é€’å½’ï¼Œç›´åˆ°é‡åˆ°å®‰å…¨çš„çˆ¶èŠ‚ç‚¹æˆ–è€…é‡åˆ°æ ¹èŠ‚ç‚¹ã€‚åœ¨é‡åˆ°æ ¹èŠ‚ç‚¹æ—¶ï¼Œè‹¥æ ¹èŠ‚ç‚¹ä¹Ÿéœ€è¦åˆ†è£‚ï¼Œåˆ™é™¤äº†éœ€è¦æ–°å»ºä¸€ä¸ªèŠ‚ç‚¹ç”¨æ¥å®¹çº³åŸæ ¹èŠ‚ç‚¹ä¸€åŠçš„ KV å¯¹ï¼Œè¿˜éœ€è¦æ–°å»ºä¸€ä¸ªæ–°çš„æ ¹èŠ‚ç‚¹ã€‚</p>
<p>å¦å¤–éœ€è¦æ³¨æ„ä¸€ä¸ªç»†èŠ‚ï¼Œåœ¨ leaf page åˆ†è£‚æ—¶ï¼Œå‘çˆ¶èŠ‚ç‚¹æ’å…¥ key æ—¶æ˜¯å¤åˆ¶åæ’å…¥ï¼Œè€Œ internal page åˆ†è£‚æ—¶ï¼Œå‘çˆ¶èŠ‚ç‚¹æ’å…¥ key æ˜¯åˆ é™¤åæ’å…¥ï¼Œæœ‰ç‚¹åƒæŠŠ key ä¸Šæ¨ã€‚</p>
<p>å‡å¦‚æœ‰ä¸€æ£µ 4 é˜¶çš„ B+ æ ‘ï¼š</p>
<p><img loading="lazy" src="../../imgs/15-445-2-6.png" alt=""  />
</p>
<p>è¿™äº›ç»†èŠ‚éƒ½å¯ä»¥åœ¨ B+ æ ‘ç¤ºä¾‹ç½‘ç«™ä¸Šå…ˆå°è¯•ä¸€éï¼Œå†æ¥å®ç°ä¼šç®€å•å¾ˆå¤šã€‚</p>
<p>Insert çš„æ•´ä¸ªæµç¨‹å¤§è‡´å°±æ˜¯å…ˆå‘ä¸‹é€’å½’æ‰¾åˆ° leaf pageï¼Œæ’å…¥ KV åå†å‘ä¸Šé€’å½’åˆ†è£‚ã€‚</p>
<p><strong>Delete</strong></p>
<p>åŒæ ·åœ°ï¼Œå…ˆæ‰¾åˆ° leaf pageã€‚åˆ é™¤ leaf page ä¸­ key å¯¹åº”çš„ KV å¯¹åï¼Œæ£€æŸ¥ size æ˜¯å¦å°äº min sizeã€‚å¦‚æœå°äºçš„è¯ï¼Œé¦–å…ˆå°è¯•ä»ä¸¤ä¾§çš„å…„å¼ŸèŠ‚ç‚¹ä¸­å·ä¸€ä¸ª KV å¯¹ã€‚æ³¨æ„åªèƒ½ä»å…„å¼ŸèŠ‚ç‚¹ï¼Œå³çˆ¶èŠ‚ç‚¹ç›¸åŒçš„èŠ‚ç‚¹ä¸­é€‰å–ã€‚å‡å¦‚å­˜åœ¨ä¸€ä¾§èŠ‚ç‚¹æœ‰å¯Œä½™çš„ KV å¯¹ï¼Œåˆ™æˆåŠŸå·å–ï¼Œç»“æŸæ“ä½œã€‚è‹¥ä¸¤ä¾§éƒ½æ²¡æœ‰å¯Œä½™çš„ KV å¯¹ï¼Œåˆ™é€‰æ‹©ä¸€ä¾§èŠ‚ç‚¹ä¸å…¶åˆå¹¶ã€‚</p>
<p>å·å–çš„è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä»å·¦ä¾§èŠ‚ç‚¹å·å–æ—¶ï¼ŒæŠŠå·¦ä¾§èŠ‚ç‚¹æœ€åä¸€ä¸ª KV å¯¹è½¬ç§»è‡³å½“å‰èŠ‚ç‚¹ç¬¬ä¸€ä¸ª KV å¯¹ï¼Œä»å³ä¾§èŠ‚ç‚¹å·å–æ—¶ï¼ŒæŠŠå³ä¾§èŠ‚ç‚¹çš„ KV å¯¹è½¬ç§»è‡³å½“å‰èŠ‚ç‚¹æœ€åä¸€ä¸ª KV å¯¹ã€‚leaf page å’Œ internal page çš„å·å–è¿‡ç¨‹åŸºæœ¬ç›¸åŒï¼Œä»…éœ€æ³¨æ„ internal page å·å–åæ›´æ–°å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚</p>
<p>ç¨éš¾çš„æ˜¯åˆå¹¶çš„è¿‡ç¨‹ã€‚åŒæ ·ï¼Œä»»é€‰å·¦å³ä¾§ä¸€å…„å¼ŸèŠ‚ç‚¹è¿›è¡Œåˆå¹¶ã€‚å°†ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ KV å¯¹è½¬ç§»è‡³å¦ä¸€èŠ‚ç‚¹ã€‚è‹¥åˆå¹¶çš„æ˜¯ leaf pageï¼Œè®°å¾—æ›´æ–° next page idã€‚è‹¥åˆå¹¶çš„æ˜¯ internal pageï¼Œè®°å¾—æ›´æ–°åˆå¹¶å page çš„å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹æŒ‡é’ˆã€‚ç„¶åï¼Œåˆ é™¤ parent èŠ‚ç‚¹ä¸­å¯¹åº”çš„ keyã€‚åˆ é™¤åï¼Œå†æ¬¡æ£€æŸ¥ size æ˜¯å¦å°äº min sizeï¼Œå½¢æˆå‘ä¸Šé€’å½’ã€‚</p>
<p>å½“åˆå¹¶ leaf page åï¼Œåˆ é™¤çˆ¶èŠ‚ç‚¹ä¸­å¯¹åº”çš„ key æ¯”è¾ƒç®€å•ï¼Œç›´æ¥åˆ é™¤å³å¯ã€‚ä¾‹å¦‚ 4 é˜¶ B+ æ ‘ï¼š</p>
<p><img loading="lazy" src="../../imgs/15-445-2-7.png" alt=""  />
</p>
<p>åˆå¹¶ internal page åï¼Œå¹¶ä¸æ˜¯ç®€å•åœ°åˆ é™¤çˆ¶èŠ‚ç‚¹ä¸­å¯¹åº” keyï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ key ä¸‹æ¨çš„è¿‡ç¨‹ï¼š</p>
<p><img loading="lazy" src="../../imgs/15-445-2-8.png" alt=""  />
</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œroot page å¹¶ä¸å— min size çš„é™åˆ¶ã€‚ä½†å¦‚æœ root page è¢«åˆ åˆ° size åªå‰© 1ï¼Œå³åªæœ‰ä¸€ä¸ª child page çš„æ—¶å€™ï¼Œåº”å°†æ­¤ child page è®¾ç½®ä¸ºæ–°çš„ root pageã€‚</p>
<p>å¦å¤–ï¼Œåœ¨åˆå¹¶æ—¶ï¼Œä¸¤ä¸ª page åˆå¹¶æˆä¸€ä¸ª pageï¼Œå¦ä¸€ä¸ª page åº”è¯¥åˆ é™¤ï¼Œé‡Šæ”¾èµ„æºã€‚åˆ é™¤ page æ—¶ï¼Œä»æ˜¯è°ƒç”¨ buffer pool çš„ <code>DeletePage()</code> å‡½æ•°ã€‚</p>
<p>å’Œ Insert ç±»ä¼¼ï¼ŒDelete è¿‡ç¨‹ä¹Ÿæ˜¯å…ˆå‘ä¸‹é€’å½’æŸ¥è¯¢ leaf pageï¼Œä¸æ»¡è¶³ min size åå…ˆå°è¯•å·å–ï¼Œæ— æ³•å·å–åˆ™åˆå¹¶ï¼Œå¹¶å‘ä¸Šé€’å½’åœ°æ£€æŸ¥æ˜¯å¦æ»¡è¶³ min sizeã€‚</p>
<h3 id="debug-your-btree">Debug Your B+Tree<a hidden class="anchor" aria-hidden="true" href="#debug-your-btree">#</a></h3>
<p>å†æ¬¡æ„Ÿå¹çœŸæ­£çš„ä¸–ç•Œä¸€æµ CS é«˜æ ¡å¯¹è¯¾ç¨‹é¡¹ç›®è®¾è®¡çš„ç”¨å¿ƒä¸ä½“è´´ã€‚ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œ15-445 ç«Ÿç„¶å¸®æˆ‘ä»¬å®ç°äº† B+ æ ‘çš„å¯è§†åŒ–ã€‚æœ‰ä¸¤ç§ä¸»è¦çš„æ–¹å¼ï¼š</p>
<ul>
<li>ä½¿ç”¨å·²å®ç°å¥½çš„ b_plus_tree_printer å·¥å…·ï¼Œå¯ä»¥è‡ªå·±å¯¹ B+ æ ‘æ‰§è¡Œæ’å…¥ã€åˆ é™¤ç­‰æ“ä½œï¼Œå¹¶å°†ç»“æœè¾“å‡ºä¸º dot æ–‡ä»¶ã€‚</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ <span class="c1"># To build the tool</span>
</span></span><span class="line"><span class="cl">$ mkdir build
</span></span><span class="line"><span class="cl">$ <span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">$ make b_plus_tree_printer -j<span class="k">$(</span>nproc<span class="k">)</span>
</span></span><span class="line"><span class="cl">$ ./bin/b_plus_tree_printer
</span></span><span class="line"><span class="cl">&gt;&gt; ... USAGE ...
</span></span><span class="line"><span class="cl">&gt;&gt; <span class="m">5</span> <span class="m">5</span> <span class="c1"># set leaf node and internal node max size to be 5</span>
</span></span><span class="line"><span class="cl">&gt;&gt; f input.txt <span class="c1"># Insert into the tree with some inserts </span>
</span></span><span class="line"><span class="cl">&gt;&gt; g my-tree.dot <span class="c1"># output the tree to dot format </span>
</span></span><span class="line"><span class="cl">&gt;&gt; q <span class="c1"># Quit the test (Or use another terminal) </span>
</span></span></code></pre></div><ul>
<li>åœ¨ä»£ç ä¸­è°ƒç”¨ <code>BPlusTree</code> çš„ <code>Draw()</code> å‡½æ•°ï¼Œå¯ä»¥åœ¨æŒ‡å®šç›®å½•ç”Ÿæˆä¸€ä¸ª dot æ–‡ä»¶ã€‚</li>
</ul>
<p>æ‹¿åˆ° dot æ–‡ä»¶åï¼Œå¯ä»¥åœ¨æœ¬åœ°ç”Ÿæˆå¯¹åº”çš„ B+ æ ‘ pngï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">dot -Tpng -O my-tree.dot
</span></span></code></pre></div><p>æˆ–è€…æŠŠæ–‡ä»¶å†…å®¹å¤åˆ¶åˆ° <a href="http://dreampuf.github.io/GraphvizOnline/">è¿™é‡Œ</a>ã€‚ï¼ˆæ›´æ¨èï¼Œç”Ÿæˆ svgï¼Œå¯¹ B+ æ ‘å¤§å°æ— é™åˆ¶ï¼‰</p>
<p>è¿™ä¸ªå¯è§†åŒ–å·¥å…·å¯¹æ—©æœŸå‘ç° B+ æ ‘çš„å„ç§åŸºæœ¬ bug éå¸¸æœ‰ç”¨ã€‚</p>
<p>è‡³æ­¤ï¼ŒCheckpoint1 çš„å†…å®¹å·²ç»å…¨éƒ¨å®Œæˆã€‚å…¶å®æœ‰å¾ˆå¤šç»†èŠ‚æˆ‘éƒ½æ²¡æœ‰æåˆ°ï¼Œæ¯”å¦‚äºŒåˆ†æœç´¢çš„è¾¹ç•Œé—®é¢˜ï¼Œå¦‚ä½•æŸ¥è¯¢å·¦å³å…„å¼ŸèŠ‚ç‚¹ï¼Œå¦‚ä½•åœ¨å…„å¼ŸèŠ‚ç‚¹é—´ç§»åŠ¨ KV å¯¹ï¼Œç¬¬ä¸€æ¬¡ Insert æ ‘ä¸ºç©ºæ€ä¹ˆåŠç­‰ç­‰ã€‚è¿™äº›éƒ½å±äºæ¯”è¾ƒç»†ææœ«èŠ‚çš„é—®é¢˜ï¼Œæ¯”è¾ƒæŠ˜ç£¨äººï¼Œä½†è®¤çœŸæ€è€ƒåº”è¯¥éƒ½èƒ½å¤Ÿè§£å†³ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™äº›å®ç°éƒ½æ˜¯è‡ªç”±çš„ã€‚</p>
<h2 id="checkpoint2-multi-thread-btree">Checkpoint2 Multi Thread B+Tree<a hidden class="anchor" aria-hidden="true" href="#checkpoint2-multi-thread-btree">#</a></h2>
<p>Checkpoint2 ä¹Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>Task3ï¼šIndex Iteratorã€‚å®ç° leaf page çš„ range scanã€‚</li>
<li>Task4ï¼šConcurrent Indexã€‚æ”¯æŒ B+ æ ‘å¹¶å‘æ“ä½œã€‚</li>
</ul>
<h3 id="task3-index-iterator">Task3 Index Iterator<a hidden class="anchor" aria-hidden="true" href="#task3-index-iterator">#</a></h3>
<p>è¿™ä¸ªéƒ¨åˆ†æ²¡æœ‰ä»€ä¹ˆå¤ªå¤šå¥½è¯´çš„ï¼Œå®ç°ä¸€ä¸ªéå† leaf page çš„è¿­ä»£å™¨ã€‚åœ¨è¿­ä»£å™¨ä¸­å­˜å‚¨å½“å‰ leaf page çš„æŒ‡é’ˆå’Œå½“å‰åœç•™çš„ä½ç½®å³å¯ã€‚éå†å®Œå½“å‰ page åï¼Œé€šè¿‡ next page id æ‰¾åˆ°ä¸‹ä¸€ä¸ª leaf pageã€‚åŒæ ·ï¼Œè®°å¾— unpin å·²ç»éå†å®Œçš„ pageã€‚å…³äºå¯èƒ½å­˜åœ¨çš„æ­»é”é—®é¢˜ï¼Œæš‚æ—¶ä¸è®¨è®ºã€‚</p>
<h3 id="task4-concurrent-index">Task4 Concurrent Index<a hidden class="anchor" aria-hidden="true" href="#task4-concurrent-index">#</a></h3>
<p>è¿™æ˜¯å¹¶å‘ B+ æ ‘çš„é‡ç‚¹ï¼Œåº”è¯¥ä¹Ÿæ˜¯ Project2 ä¸­æœ€éš¾çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬è¦ä½¿æ­¤å‰å®ç°çš„ B+ æ ‘æ”¯æŒå¹¶å‘çš„ Search/Insert/Delete æ“ä½œã€‚æ•´æ£µæ ‘ä¸€æŠŠé”é€»è¾‘ä¸Šæ¥è¯´å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†æ€§èƒ½ä¹Ÿä¼šå¯æƒ³è€ŒçŸ¥åœ°ç³Ÿç³•ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ä¸€ç§ç‰¹æ®Šçš„åŠ é”æ–¹å¼ï¼Œå«åš latch crabbingã€‚é¡¾åæ€ä¹‰ï¼Œå°±åƒèƒèŸ¹ä¸€æ ·ï¼Œç§»åŠ¨ä¸€åªè„šï¼Œæ”¾ä¸‹ï¼Œç§»åŠ¨å¦ä¸€åªè„šï¼Œå†æ”¾ä¸‹ã€‚åŸºæœ¬æ€æƒ³æ˜¯ï¼š</p>
<ol>
<li>å…ˆé”ä½ parent pageï¼Œ</li>
<li>å†é”ä½ child pageï¼Œ</li>
<li>å‡è®¾ child page æ˜¯<em>å®‰å…¨</em>çš„ï¼Œåˆ™é‡Šæ”¾ parent page çš„é”ã€‚<em>å®‰å…¨</em>æŒ‡å½“å‰ page åœ¨å½“å‰æ“ä½œä¸‹ä¸€å®šä¸ä¼šå‘ç”Ÿ split/steal/mergeã€‚åŒæ—¶ï¼Œ<em>å®‰å…¨</em>å¯¹ä¸åŒæ“ä½œçš„å®šä¹‰æ˜¯ä¸åŒçš„ï¼ŒSearch æ—¶ï¼Œä»»ä½•èŠ‚ç‚¹éƒ½å®‰å…¨ï¼›Insert æ—¶ï¼Œåˆ¤æ–­ max sizeï¼›Delete æ—¶ï¼Œåˆ¤æ–­ min sizeã€‚</li>
</ol>
<p>è¿™ä¹ˆåšçš„åŸå› å’Œæ­£ç¡®æ€§è¿˜æ˜¯æ¯”è¾ƒæ˜æ˜¾çš„ã€‚å½“ page ä¸ºå®‰å…¨çš„æ—¶å€™ï¼Œå½“å‰æ“ä½œä»…å¯èƒ½æ”¹å˜æ­¤ page åŠå…¶ child page çš„å€¼ï¼Œå› æ­¤å¯ä»¥æå‰é‡Šæ”¾æ‰å…¶ç¥–å…ˆçš„é”æ¥æé«˜å¹¶å‘æ€§èƒ½ã€‚</p>
<p><strong>Search</strong></p>
<p>Search æ—¶ï¼Œä» root page å¼€å§‹ï¼Œå…ˆç»™ parent ä¸Šè¯»é”ï¼Œå†ç»™ child page ä¸Šè¯»é”ï¼Œç„¶åé‡Šæ”¾ parent page çš„é”ã€‚å¦‚æ­¤å‘ä¸‹é€’å½’ã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-9.png" alt=""  />

<img loading="lazy" src="../../imgs/15-445-2-10.png" alt=""  />

<img loading="lazy" src="../../imgs/15-445-2-11.png" alt=""  />

<img loading="lazy" src="../../imgs/15-445-2-12.png" alt=""  />
</p>
<p><strong>Insert</strong></p>
<p>Insert æ—¶ï¼Œä» root page å¼€å§‹ï¼Œå…ˆç»™ parent ä¸Šå†™é”ï¼Œå†ç»™ child page ä¸Šå†™é”ã€‚å‡å¦‚ child page å®‰å…¨ï¼Œåˆ™é‡Šæ”¾æ‰€æœ‰ç¥–å…ˆçš„é”ï¼›å¦åˆ™ä¸é‡Šæ”¾é”ï¼Œç»§ç»­å‘ä¸‹é€’å½’ã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-13.png" alt=""  />

<img loading="lazy" src="../../imgs/15-445-2-14.png" alt=""  />

<img loading="lazy" src="../../imgs/15-445-2-15.png" alt=""  />

<img loading="lazy" src="../../imgs/15-445-2-16.png" alt=""  />
</p>
<p>åœ¨ child page ä¸å®‰å…¨æ—¶ï¼Œéœ€è¦æŒç»­æŒæœ‰ç¥–å…ˆçš„å†™é”ã€‚å¹¶åœ¨å‡ºç°å®‰å…¨çš„ child page åï¼Œé‡Šæ”¾æ‰€æœ‰ç¥–å…ˆå†™é”ã€‚å¦‚ä½•è®°å½•å“ªäº› page å½“å‰æŒæœ‰é”ï¼Ÿè¿™é‡Œå°±è¦ç”¨åˆ°åœ¨ Checkpoint1 é‡Œä¸€ç›´æ²¡æœ‰æåˆ°çš„ä¸€ä¸ªå‚æ•°ï¼Œ<code>transaction</code>ã€‚</p>
<p>transaction å°±æ˜¯ Bustub é‡Œçš„äº‹åŠ¡ã€‚åœ¨ Project2 ä¸­ï¼Œå¯ä»¥æš‚æ—¶ä¸ç”¨ç†è§£äº‹åŠ¡æ˜¯ä»€ä¹ˆï¼Œè€Œæ˜¯å°†å…¶çœ‹ä½œå½“å‰åœ¨å¯¹ B+ æ ‘è¿›è¡Œæ“ä½œçš„çº¿ç¨‹ã€‚è°ƒç”¨ transaction çš„ <code>AddIntoPageSet()</code> æ–¹æ³•ï¼Œæ¥è·Ÿè¸ªå½“å‰çº¿ç¨‹è·å–çš„ page é”ã€‚åœ¨å‘ç°ä¸€ä¸ªå®‰å…¨çš„ child page åï¼Œå°† transaction ä¸­è®°å½•çš„ page é”å…¨éƒ¨é‡Šæ”¾æ‰ã€‚æŒ‰ç†æ¥è¯´ï¼Œé‡Šæ”¾é”çš„é¡ºåºå¯ä»¥ä»ä¸Šåˆ°ä¸‹ä¹Ÿå¯ä»¥ä»ä¸‹åˆ°ä¸Šï¼Œä½†ç”±äºä¸Šå±‚èŠ‚ç‚¹çš„ç«äº‰ä¸€èˆ¬æ›´åŠ æ¿€çƒˆï¼Œæ‰€ä»¥æœ€å¥½æ˜¯ä»ä¸Šåˆ°ä¸‹åœ°é‡Šæ”¾é”ã€‚</p>
<p>åœ¨å®Œæˆæ•´ä¸ª Insert æ“ä½œåï¼Œé‡Šæ”¾æ‰€æœ‰é”ã€‚</p>
<p><strong>Delete</strong></p>
<p>å’Œ Insert åŸºæœ¬ä¸€æ ·ã€‚ä»…æ˜¯åˆ¤æ–­æ˜¯å¦å®‰å…¨çš„æ–¹æ³•ä¸åŒï¼ˆæ£€æµ‹ min sizeï¼‰ã€‚éœ€è¦å¦å¤–æ³¨æ„çš„æ˜¯ï¼Œå½“éœ€è¦ steal/merge sibling æ—¶ï¼Œä¹Ÿéœ€è¦å¯¹ sibling åŠ é”ã€‚å¹¶åœ¨å®Œæˆ steal/merge åé©¬ä¸Šé‡Šæ”¾ã€‚è¿™é‡Œæ˜¯ä¸ºäº†é¿å…å…¶ä»–çº¿ç¨‹æ­£åœ¨å¯¹ sibling è¿›è¡Œ Search/Insert æ“ä½œï¼Œä»è€Œå‘ç”Ÿ data raceã€‚è¿™é‡Œçš„åŠ é”å°±ä¸éœ€è¦åœ¨ transaction é‡Œè®°å½•äº†ï¼Œåªæ˜¯ä¸´æ—¶ä½¿ç”¨ã€‚</p>
<p><strong>Implementation</strong></p>
<p>å¯ä»¥å‘ç°ï¼Œlatch crabbing æ˜¯åœ¨ Find Leaf çš„è¿‡ç¨‹ä¸­è¿›è¡Œçš„ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹ Checkpoint1 ä¸­çš„ <code>FindLeaf()</code>ï¼Œæ ¹æ®æ“ä½œçš„ä¸åŒæ²¿é€”åŠ é”ã€‚</p>
<h3 id="when-should-we-unlatch-and-unpin-pages">When should we unlatch and unpin pages?<a hidden class="anchor" aria-hidden="true" href="#when-should-we-unlatch-and-unpin-pages">#</a></h3>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘è¿˜æƒ³æä¸€æ unpin page çš„é—®é¢˜ã€‚åœ¨å‰é¢æˆ‘åªæ˜¯ç®€å•åœ°è¯´äº†ä¸€å¥åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨çš„åœ°æ–¹ unpinã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªé—®é¢˜åœ¨æ•´ä¸ª Project2 ä¸­æ—¶æ—¶å›°æ‰°ç€æˆ‘ã€‚ç‰¹åˆ«æ˜¯åœ¨ Checkpoint2 ä¸­å¼•å…¥ page é”ä¹‹åã€‚åˆ°åº•è¯¥å¦‚ä½•ä¼˜é›…åœ°é‡Šæ”¾æˆ‘ä»¬è·å¾—çš„ pageï¼Ÿ</p>
<p>é¦–å…ˆï¼Œä¸ºä»€ä¹ˆè¦ unpin pageï¼Ÿè¿™ä¸ªåº”è¯¥æ¯”è¾ƒæ¸…æ¥šäº†ï¼Œé¿å…å¯¹ buffer pool ä¸€ç›´å ç”¨ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ç§èµ„æºçš„æ³„éœ²ã€‚</p>
<p>è¯´åˆ°èµ„æºæ³„éœ²ï¼Œå¯ä»¥è‡ªç„¶åœ°æƒ³åˆ° RAIIã€‚RAII çš„ä¸»è¦æ€æƒ³æ˜¯ï¼Œåœ¨åˆå§‹åŒ–æ—¶è·å–èµ„æºï¼Œåœ¨ææ„æ—¶é‡Šæ”¾èµ„æºã€‚è¿™æ ·å°±é¿å…äº†ç¨‹åºä¸­é€”é€€å‡ºï¼Œæˆ–æŠ›å‡ºå¼‚å¸¸åï¼Œèµ„æºæ²¡æœ‰è¢«æˆåŠŸé‡Šæ”¾ã€‚å¸¸å¸¸ç”¨åœ¨ open socketã€acquire mutex ç­‰æ“ä½œä¸­ã€‚å…¶å®æˆ‘ä»¬åœ¨ Project1 ä¸­å·²ç»é‡åˆ°äº† RAII çš„ç”¨æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">scoped_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">mutex</span><span class="o">&gt;</span> <span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
</span></span></code></pre></div><p>è¿™é‡Œå…¶å®å°±æ˜¯ä¸€ä¸ªç»å…¸çš„ RAIIã€‚åœ¨åˆå§‹åŒ– lock æ—¶ï¼Œè°ƒç”¨ <code>mutex_.Lock()</code>ï¼Œåœ¨ææ„ lock æ—¶ï¼Œè°ƒç”¨ <code>mutex_.Unlock()</code>ã€‚è¿™æ ·å°±é€šè¿‡ç®€å•çš„ä¸€è¡Œä»£ç æˆåŠŸä¿è¯äº†åœ¨ lock çš„ä½œç”¨åŸŸä¸­å¯¹ mutex å…¨ç¨‹ä¸Šé”ã€‚ç¦»å¼€ lock çš„ä½œç”¨åŸŸåï¼Œç”±äº lock ææ„ï¼Œé”è‡ªåŠ¨é‡Šæ”¾ã€‚</p>
<p>ä¸€å¼€å§‹ï¼Œæˆ‘ä¹Ÿæƒ³è¿‡ç”¨è¿™ç§æ–¹æ³•æ¥ç®¡ç† pageã€‚ä¾‹å¦‚ç¼–å†™ä¸€ä¸ªç±» PageManagerï¼Œåœ¨åˆå§‹åŒ–æ—¶ï¼Œfetch page &amp; latch pageï¼Œåœ¨ææ„æ—¶ï¼Œunlatch page &amp; unpin pageã€‚è¿™ä¸ªæƒ³æ³•å¥½åƒè¿˜è¡Œï¼Œä½†æ˜¯é‡åˆ°äº†ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼špage ä¼šåœ¨ä¸åŒå‡½æ•°é—´äº’ç›¸ä¼ é€’ï¼Œä»¥åŠå­˜åœ¨ç¦»å¼€ä½œç”¨åŸŸåä»éœ€æŒæœ‰ page èµ„æºçš„æƒ…å†µï¼Œæ¯”å¦‚ latch crabbing æ—¶å¯èƒ½éœ€è¦è·¨å‡½æ•°æŒé”ã€‚æˆ–è®¸å¯ä»¥é€šè¿‡ä¼ é€’ PageManager æŒ‡é’ˆçš„æ–¹å¼æ¥å¤„ç†ï¼Œä½†è¿™æ ·ä¼¼ä¹æ›´åŠ å¤æ‚äº†ã€‚</p>
<p>æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æ¯”å¦‚ Insert æ“ä½œæ—¶ï¼Œå‡å¦‚éœ€è¦åˆ†è£‚ï¼Œä¼šå‘ä¸‹é€’å½’æ²¿é€”æŒé”ï¼Œç„¶åå‘ä¸Šé€’å½’è¿›è¡Œåˆ†è£‚ã€‚åœ¨åˆ†è£‚æ—¶ï¼Œéœ€è¦é‡æ–°ä» buffer pool è·å– pageã€‚è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè·å– page æ—¶ä¸èƒ½å¤Ÿå¯¹ page åŠ é”ï¼Œå› ä¸ºæ­¤å‰å‘ä¸‹é€’å½’æ—¶ page å·²ç»åŠ è¿‡é”äº†ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹å†åŠ é”ä¼šæŠ›å¼‚å¸¸ã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-17.png" alt=""  />
</p>
<p>æ¯”å¦‚è¿™é‡Œçš„ä¾‹å­ã€‚åœ¨å‘ä¸Šé€’å½’æ—¶ï¼Œæˆ‘ä»¬å·²ç»è·å–è¿‡ parent page çš„é”ï¼Œå› æ­¤å†æ¬¡ä» buffer pool è·å– parent page æ—¶ï¼Œæ— éœ€å¯¹ parent page å†æ¬¡åŠ é”ã€‚</p>
<p>é‚£æœ‰æ²¡æœ‰åŠæ³•èƒ½å¤ŸçŸ¥é“æˆ‘ä»¬å¯¹å“ªäº› page åŠ è¿‡é”ï¼Ÿtransactionã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ª page å‡ºç°åœ¨ transaction çš„ page set ä¸­ï¼Œå°±ä»£è¡¨è¿™ä¸ªçº¿ç¨‹å·²ç»æŒæœ‰äº†è¿™ä¸ª page çš„é”ã€‚</p>
<p>å½“ç„¶ï¼Œé€šè¿‡è®¤çœŸåˆ†æå„ä¸ªæ“ä½œè·å– page çš„è·¯å¾„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å‘ç°æŒé”çš„è§„å¾‹ã€‚</p>
<p><strong>Search</strong></p>
<p>ä»…å‘ä¸‹é€’å½’ï¼Œæ‹¿åˆ° child page å°±é‡Šæ”¾ parent pageã€‚è¿™ä¸ªæ¯”è¾ƒç®€å•ã€‚è·å– page çš„è·¯å¾„ä» root åˆ° leaf æ˜¯ä¸€æ¡çº¿ã€‚åˆ°è¾¾ leaf æ—¶ï¼Œä»…æŒæœ‰ leaf çš„èµ„æºã€‚</p>
<p><strong>Insert</strong></p>
<p>å…ˆå‘ä¸‹é€’å½’ï¼Œå¯èƒ½ä¼šæŒæœ‰å¤šä¸ª parent page çš„é”ã€‚è·å– page çš„è·¯å¾„ä» root åˆ° leaf ä¹Ÿæ˜¯ä¸€æ¡çº¿ï¼ŒåŒºåˆ«æ˜¯ï¼Œåˆ°è¾¾ leaf æ—¶ï¼Œè¿˜å¯èƒ½æŒæœ‰å…¶ç¥–å…ˆçš„èµ„æºã€‚å†å‘ä¸Šé€’å½’ã€‚å‘ä¸Šé€’å½’çš„è·¯å¾„ä¸å‘ä¸‹é€’å½’çš„å®Œå…¨é‡åˆï¼Œä»…æ˜¯æ–¹å‘ç›¸åã€‚å› æ­¤ï¼Œå‘ä¸Šé€’å½’æ—¶ä¸éœ€è¦é‡å¤è·å– page èµ„æºï¼Œå¯ä»¥ç›´æ¥ä» transaction é‡Œæ‹¿åˆ° page æŒ‡é’ˆï¼Œç»•è¿‡å¯¹ buffer pool çš„è®¿é—®ã€‚åœ¨åˆ†è£‚æ—¶ï¼Œæ–°å»ºçš„ page ç”±äºè¿˜æœªè¿æ¥åˆ°æ ‘ä¸­ï¼Œä¸å¯èƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®åˆ°ï¼Œå› æ­¤ä¹Ÿä¸éœ€è¦ä¸Šé”ï¼Œä»…éœ€ unpinã€‚</p>
<p><strong>Delete</strong></p>
<p>å‘ä¸‹é€’å½’çš„æƒ…å†µä¸ Insert ç›¸åŒï¼Œè·¯å¾„ä¸ºä¸€æ¡çº¿ã€‚åˆ°è¾¾ leaf page åï¼Œæƒ…å†µæœ‰æ‰€ä¸åŒã€‚ç”±äºå¯èƒ½éœ€è¦å¯¹ sibling è¿›è¡Œ steal/mergeï¼Œè¿˜éœ€è·å– sibling çš„èµ„æºã€‚å› æ­¤ï¼Œåœ¨å‘ä¸Šé€’å½’æ—¶ï¼Œä¸»è¦è·¯å¾„ä¹Ÿä¸å‘ä¸‹é€’å½’çš„é‡åˆï¼Œä½†é™¤äº†è¿™æ¡çº¿ï¼Œè¿˜ä¼šæ²¿é€”è·å– sibling çš„èµ„æºï¼Œsibling éœ€è¦åŠ é”ï¼Œè€Œ parent page æ— éœ€å†æ¬¡åŠ é”ã€‚sibling åªæ˜¯æš‚æ—¶ä½¿ç”¨ï¼Œä½¿ç”¨å®Œä¹‹åå¯ä»¥ç›´æ¥é‡Šæ”¾ã€‚è€Œå‘ä¸‹é€’å½’è·¯å¾„ä¸Šçš„é”åœ¨æ•´ä¸ª Delete æ“ä½œå®Œæˆä¹‹åå†é‡Šæ”¾ã€‚</p>
<p><img loading="lazy" src="../../imgs/15-445-2-18.png" alt=""  />
</p>
<p>ç»è¿‡ä¸Šé¢çš„è®¨è®ºï¼Œå¯ä»¥å¾—å‡ºæˆ‘ä»¬é‡Šæ”¾èµ„æºçš„æ—¶æœºï¼šå‘ä¸‹é€’å½’è·¯å¾„ä¸Šçš„ page éœ€è¦å…¨ç¨‹æŒæœ‰ï¼ˆé™¤éèŠ‚ç‚¹å®‰å…¨ï¼Œæå‰é‡Šæ”¾ï¼‰ï¼Œåœ¨æ•´ä¸ªæ“ä½œå®Œæˆåç»Ÿä¸€é‡Šæ”¾ã€‚å…¶ä½™ page è¦ä¹ˆæ˜¯é‡å¤è·å–ï¼Œè¦ä¹ˆæ˜¯æš‚æ—¶è·å–ã€‚é‡å¤è·å–æ— éœ€åŠ é”ï¼Œä½¿ç”¨å®Œåç›´æ¥ unpinã€‚æš‚æ—¶è·å–ï¼ˆsteal/merge siblingï¼‰éœ€è¦åŠ é”ï¼Œä½¿ç”¨å®Œå unlatch &amp; unpinã€‚</p>
<h3 id="deadlock">Deadlockï¼Ÿ<a hidden class="anchor" aria-hidden="true" href="#deadlock">#</a></h3>
<p>å¯ä»¥çœ‹å‡ºï¼Œéœ€è¦æŒå¤šä¸ªé”æ—¶ï¼Œéƒ½æ˜¯ä»ä¸Šåˆ°ä¸‹åœ°è·å–é”ï¼Œè·å–é”çš„æ–¹å‘æ˜¯ç›¸åŒçš„ã€‚åœ¨å¯¹ sibling ä¸Šé”æ—¶ï¼Œä¸€å®šæŒæœ‰å…¶ parent page çš„é”ï¼Œå› æ­¤ä¸å¯èƒ½å­˜åœ¨å¦ä¸€ä¸ªæ—¢æŒæœ‰ sibling é”åˆæŒæœ‰ parent page é”çš„çº¿ç¨‹æ¥é€ æˆå¾ªç¯ç­‰å¾…ã€‚å› æ­¤ï¼Œæ­»é”æ˜¯ä¸å­˜åœ¨çš„ã€‚</p>
<p>ä½†å¦‚æœæŠŠ Index Iterator ä¹Ÿçº³å…¥è®¨è®ºï¼Œå°±æœ‰å¯èƒ½äº§ç”Ÿæ­»é”äº†ã€‚Index Iterator æ˜¯ä»å·¦åˆ°å³åœ°è·å– leaf page çš„é”ï¼Œå‡å¦‚å­˜åœ¨ä¸€ä¸ªéœ€è¦ steal/merge çš„ page å°è¯•è·å–å…¶ left sibling çš„é”ï¼Œåˆ™ä¸€ä¸ªä»å·¦åˆ°å³ï¼Œä¸€ä¸ªä»å³åˆ°å·¦ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯ç­‰å¾…ï¼Œä¹Ÿå°±æ˜¯æ­»é”ã€‚å› æ­¤åœ¨ Index Iterator æ— æ³•è·å–é”æ—¶ï¼Œåº”æ”¾å¼ƒè·å–ã€‚</p>
<h3 id="optimization">Optimization<a hidden class="anchor" aria-hidden="true" href="#optimization">#</a></h3>
<p>å¯¹äº latch crabbingï¼Œå­˜åœ¨ä¸€ç§æ¯”è¾ƒç®€å•çš„ä¼˜åŒ–ã€‚åœ¨æ™®é€šçš„ latch crabbing ä¸­ï¼ŒInsert/Delete å‡éœ€å¯¹èŠ‚ç‚¹ä¸Šå†™é”ï¼Œè€Œè¶Šä¸Šå±‚çš„èŠ‚ç‚¹è¢«è®¿é—®çš„å¯èƒ½æ€§è¶Šå¤§ï¼Œé”ç«äº‰ä¹Ÿè¶Šæ¿€çƒˆï¼Œé¢‘ç¹å¯¹ä¸Šå±‚èŠ‚ç‚¹ä¸Šäº’æ–¥çš„å†™é”å¯¹æ€§èƒ½å½±å“è¾ƒå¤§ã€‚å› æ­¤å¯ä»¥åšå‡ºå¦‚ä¸‹ä¼˜åŒ–ï¼š</p>
<p>Search æ“ä½œä¸å˜ï¼Œåœ¨ Insert/Delete æ“ä½œä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä¹è§‚åœ°è®¤ä¸ºä¸ä¼šå‘ç”Ÿ split/steal/mergeï¼Œå¯¹æ²¿é€”çš„èŠ‚ç‚¹ä¸Šè¯»é”ï¼Œå¹¶åŠæ—¶é‡Šæ”¾ï¼Œå¯¹ leaf page ä¸Šå†™é”ã€‚å½“å‘ç°æ“ä½œå¯¹ leaf page ç¡®å®ä¸ä¼šé€ æˆ split/steal/merge æ—¶ï¼Œå¯ä»¥ç›´æ¥å®Œæˆæ“ä½œã€‚å½“å‘ç°æ“ä½œä¼šä½¿ leaf page split/steal/merge æ—¶ï¼Œåˆ™æ”¾å¼ƒæ‰€æœ‰æŒæœ‰çš„é”ï¼Œä» root page å¼€å§‹é‡æ–°æ‚²è§‚åœ°è¿›è¡Œè¿™æ¬¡æ“ä½œï¼Œå³æ²¿é€”ä¸Šå†™é”ã€‚</p>
<p>è¿™ä¸ªä¼˜åŒ–å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹ <code>FindLeaf()</code> å³å¯ã€‚</p>
<h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<p>æ•´ä¸ª Project2 çš„å†…å®¹å¤§è‡´å°±æ˜¯è¿™äº›ã€‚éš¾åº¦ç›¸å¯¹äº Project1 å¯ä»¥è¯´æ˜¯é™¡å¢ã€‚Checkpoint1 çš„éš¾ç‚¹ä¸»è¦åœ¨ç»†èŠ‚çš„å¤„ç†ä¸Šï¼ŒCheckpoint2 çš„éš¾ç‚¹åˆ™æ˜¯å¯¹ latch crabbing çš„æ­£ç¡®ç†è§£ã€‚å½“çœ‹åˆ°è‡ªå·±ä» 0 å®ç°çš„ B+ æ ‘èƒ½å¤Ÿæ­£ç¡®è¿è¡Œï¼Œç‰¹åˆ«æ˜¯å¯è§†åŒ–æ—¶ï¼Œè¿˜æ˜¯å¾ˆæœ‰æˆå°±æ„Ÿçš„ã€‚</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/database/">Database</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/cmu15-445-project3-query-execution/">
    <span class="title">Â« Prev</span>
    <br>
    <span>CMU15-445 Project3 Query Execution</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/cmu15-445-branch-use-perf-to-benchmark-your-code/">
    <span class="title">Next Â»</span>
    <br>
    <span>CMU15-445 Branch: Use Perf to Benchmark Your Code</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="http://localhost:1313/">Cookie&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
