<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>chronoåº“çš„ä½¿ç”¨ | Cookie's Blog</title>
<meta name=keywords content="c++11"><meta name=description content="c++11æ–°å¼•å…¥çš„chronoåº“ä»‹ç»å’Œä½¿ç”¨"><meta name=author content="Me"><link rel=canonical href=https://canonical.url/to/page><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dueplay.github.io/posts/chrono/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4XHWHM02GB"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4XHWHM02GB",{anonymize_ip:!1})}</script><meta property="og:title" content="chronoåº“çš„ä½¿ç”¨"><meta property="og:description" content="c++11æ–°å¼•å…¥çš„chronoåº“ä»‹ç»å’Œä½¿ç”¨"><meta property="og:type" content="article"><meta property="og:url" content="https://dueplay.github.io/posts/chrono/"><meta property="og:image" content="https://dueplay.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-23T13:42:01+08:00"><meta property="article:modified_time" content="2022-05-23T13:42:01+08:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dueplay.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="chronoåº“çš„ä½¿ç”¨"><meta name=twitter:description content="c++11æ–°å¼•å…¥çš„chronoåº“ä»‹ç»å’Œä½¿ç”¨"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dueplay.github.io/posts/"},{"@type":"ListItem","position":2,"name":"chronoåº“çš„ä½¿ç”¨","item":"https://dueplay.github.io/posts/chrono/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"chronoåº“çš„ä½¿ç”¨","name":"chronoåº“çš„ä½¿ç”¨","description":"c++11æ–°å¼•å…¥çš„chronoåº“ä»‹ç»å’Œä½¿ç”¨","keywords":["c++11"],"articleBody":"chronoåº“ä¸»è¦åŒ…å«ä¸‰ç§ç±»å‹çš„ç±»ï¼šæ—¶é—´é—´éš”durationã€æ—¶é’Ÿclocksã€æ—¶é—´ç‚¹time point\n1.duration ç”¨æ¥è®°å½•æ—¶é—´é•¿åº¦ï¼Œå¯ä»¥è¡¨ç¤ºå‡ ç§’ã€å‡ åˆ†é’Ÿã€å‡ ä¸ªå°æ—¶çš„æ—¶é—´é—´éš”\n// durationçš„å®šä¹‰ï¼Œå®šä¹‰äºå¤´æ–‡ä»¶ template\u003c class Rep, class Period = std::ratio\u003c1\u003e \u003e class duration; //è¡¨ç¤ºRepä¸ªPeriodï¼Œä¸€ä¸ªperiodæ˜¯ä¸€ä¸ªratioç±»ï¼Œé»˜è®¤ä¸º1s // ratioçš„å®šä¹‰ï¼Œå®šä¹‰äºå¤´æ–‡ä»¶ template\u003c std::intmax_t Num, std::intmax_t Denom = 1 \u003e class ratio; // ä»£è¡¨ Num / Denom ç§’ï¼Œåˆ†æ¯é»˜è®¤ä¸º1ï¼Œratio\u003c2\u003eä»£è¡¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæ˜¯2ç§’ ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œåœ¨æ ‡å‡†åº“ä¸­å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„æ—¶é—´é—´éš”,å®šä¹‰å¦‚ä¸‹\nçº³ç§’ï¼šusing std::chrono::nanoseconds = duration\u003cRep*/*Repè‡³å°‘ 64 ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/*, std::nano\u003e; std::nano ä¸º ratio\u003c1,10e9\u003e å¾®ç§’ï¼šstd::chrono::microseconds\tduration\u003cRep*/*è‡³å°‘ 55 ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/*, std::micro\u003e æ¯«ç§’ï¼šstd::chrono::milliseconds\tduration\u003cRep*/*è‡³å°‘ 45 ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/*, std::milli\u003e ç§’ï¼š std::chrono::seconds\tduration\u003cRep*/*è‡³å°‘ 35 ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/*\u003e åˆ†é’Ÿï¼šstd::chrono::minutes\tduration\u003cRep*/*è‡³å°‘ 29 ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/*, std::ratio\u003c60\u003e\u003e std::chrono::minutes m(1);//è¡¨ç¤º1m å°æ—¶ï¼šstd::chrono::hours\tduration\u003cRep*/*è‡³å°‘ 23 ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/*, std::ratio\u003c3600\u003e\u003e æ„é€ å‡½æ•°\n// 1. æ‹·è´æ„é€ å‡½æ•° duration( const duration\u0026 ) = default; // 2. é€šè¿‡æŒ‡å®šæ—¶é’Ÿå‘¨æœŸçš„ç±»å‹æ¥æ„é€ å¯¹è±¡ template\u003c class Rep2 \u003e constexpr explicit duration( const Rep2\u0026 r ); // 3. é€šè¿‡æŒ‡å®šæ—¶é’Ÿå‘¨æœŸç±»å‹ï¼Œå’Œæ—¶é’Ÿå‘¨æœŸé•¿åº¦æ¥æ„é€ å¯¹è±¡ template\u003c class Rep2, class Period2 \u003e constexpr duration( const duration\u003cRep2,Period2\u003e\u0026 d ); // è¿˜é‡è½½äº†ä»¥ä¸‹æ“ä½œç¬¦ operator=; operator+; operator-; operator++; operator++(int); operator--; operator--(int); +=,-=,*=,/=,%=; //è·å–æ—¶é—´é—´éš”çš„æ—¶é’Ÿå‘¨æœŸä¸ªæ•° constexpr rep count() const; example\nstd::chrono::hour h(2);// hè¡¨ç¤º2å°æ—¶çš„æ—¶é—´é—´éš”å¯¹è±¡ std::chrono::millisecond ms{3};// msè¡¨ç¤º3æ¯«ç§’ std::chrono::duration\u003cint,ratio\u003c60\u003e\u003e ten_m(3); // 3ä¸ª60ç§’ std::chrono::duration\u003cdouble,ratio\u003c1,1000\u003e\u003e ms_(5.5); // 5.5ä¸ª1msï¼Œä¹Ÿè®¡æ˜¯5.5ms std::chrono::minute t1(1); std::chrono::second t2(20); std::chrono::second t3 = t1 - t2;//1m - 30s = 30s,t3ä¸º30s durationçš„åŠ å‡è¿ç®—æœ‰ä¸€å®šçš„è§„åˆ™ï¼Œå½“ä¸¤ä¸ªdurationæ—¶é’Ÿå‘¨æœŸä¸ç›¸åŒçš„æ—¶å€™ï¼Œä¼šå…ˆç»Ÿä¸€æˆä¸€ç§æ—¶é’Ÿï¼Œç„¶åå†è¿›è¡Œç®—æœ¯è¿ç®—ï¼Œç»Ÿä¸€çš„è§„åˆ™å¦‚ä¸‹ï¼šå‡è®¾æœ‰ratio å’Œ ratioä¸¤ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œé¦–å…ˆéœ€è¦æ±‚å‡ºx1ï¼Œx2çš„æœ€å¤§å…¬çº¦æ•°Xï¼Œç„¶åæ±‚å‡ºy1ï¼Œy2çš„æœ€å°å…¬å€æ•°Yï¼Œç»Ÿä¸€ä¹‹åçš„æ—¶é’Ÿå‘¨æœŸratioä¸ºratioã€‚åˆ†å­æ±‚å…¬çº¦ï¼Œåˆ†æ¯æ±‚å…¬å€ã€‚å› ä¸ºæ˜¯x1 / y1 - x2 / y2,å°±é€šåˆ†å‘—ï¼ŒåŒ–ä¸º X/Y,x1/y1å¯ä»¥è¡¨ç¤ºä¸ºå¤šå°‘ä¸ª X/Yï¼Œ x2 / y2åŒç†ã€‚\nratio\u003c9, 7\u003eå’Œratio\u003c6, 5\u003eï¼Œç»Ÿä¸€ä¹‹åçš„æ—¶é’Ÿå‘¨æœŸratio\u003c3, 35\u003eï¼Œä¸€ä¸ªratio\u003c9, 7\u003eå°±è¡¨ç¤ºä¸º15ä¸ªratio\u003c3, 35\u003eï¼Œè€Œratio\u003c6, 5\u003eå¯è¡¨ç¤ºä¸º14ä¸ªratio\u003c3, 35\u003eã€‚å•ä½å°±ç»Ÿä¸€äº†ã€‚\n2.æ—¶é—´ç‚¹ time point ä¸€ä¸ªè¡¨ç¤ºæ—¶é—´ç‚¹çš„ç±»ï¼Œå®šä¹‰å¦‚ä¸‹\nè¯¥ç±»é€šå¸¸é…åˆclockä¸€èµ·ä½¿ç”¨\n// å®šä¹‰äºå¤´æ–‡ä»¶ template\u003c class Clock, class Duration = typename Clock::duration \u003e class time_point; // Clockï¼šæ­¤æ—¶é—´ç‚¹time_pointåœ¨æ­¤æ—¶é’ŸClockä¸Šè®¡é‡ // ç”¨äºè®¡é‡ä»çºªå…ƒèµ·æ—¶é—´çš„ std::chrono::duration ç±»å‹ï¼Œè¡¨ç¤ºä»clockæ—¶é—´æŒç»­durationæ®µæ—¶é—´çš„æ—¶é—´ç‚¹ // æ„é€ å‡½æ•° // 1. æ„é€ ä¸€ä¸ªä»¥æ–°çºªå…ƒ(epochï¼Œå³ï¼š1970.1.1)ä½œä¸ºå€¼çš„å¯¹è±¡ï¼Œéœ€è¦å’Œæ—¶é’Ÿç±»ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨è¯¥æ— å‚æ„é€ å‡½æ•° time_point(); // 2. æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œè¿™ä¸ªæ—¶é—´ç‚¹ä¸ºä»epochå¼€å§‹æŒç»­dè¿™ä¹ˆä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œéœ€è¦å’Œæ—¶é’Ÿç±»ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨è¯¥æ„é€ å‡½æ•° explicit time_point( const duration\u0026 d ); // 3. æ‹·è´æ„é€ å‡½æ•°ï¼Œæ„é€ ä¸tç›¸åŒæ—¶é—´ç‚¹çš„å¯¹è±¡ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•° template\u003c class Duration2 \u003e time_point( const time_point\u003cClock,Duration2\u003e\u0026 t ); //ç”¨æ¥è·å¾—1970å¹´1æœˆ1æ—¥åˆ°time_pointå¯¹è±¡ä¸­è®°å½•çš„æ—¶é—´ç‚¹ç»è¿‡çš„æ—¶é—´é—´éš”ï¼ˆdurationï¼‰ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š duration time_since_epoch() const; // æ­¤å¤–è¿˜æœ‰å¾ˆå¤šé‡è½½operator 3.æ—¶é’ŸClock chronoåº“ä¸­æä¾›äº†è·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´çš„æ—¶é’Ÿç±»ï¼ŒåŒ…å«çš„æ—¶é’Ÿä¸€å…±æœ‰ä¸‰ç§ï¼š\nsystem_clockï¼šç³»ç»Ÿçš„æ—¶é’Ÿï¼Œç³»ç»Ÿçš„æ—¶é’Ÿå¯ä»¥ä¿®æ”¹ï¼Œç”šè‡³å¯ä»¥ç½‘ç»œå¯¹æ—¶ï¼Œå› æ­¤ä½¿ç”¨ç³»ç»Ÿæ—¶é—´è®¡ç®—æ—¶é—´å·®å¯èƒ½ä¸å‡†ã€‚ steady_clockï¼šæ˜¯å›ºå®šçš„æ—¶é’Ÿï¼Œç›¸å½“äºç§’è¡¨ã€‚å¼€å§‹è®¡æ—¶åï¼Œæ—¶é—´åªä¼šå¢é•¿å¹¶ä¸”ä¸èƒ½ä¿®æ”¹ï¼Œé€‚åˆç”¨äºè®°å½•ç¨‹åºè€—æ—¶ high_resolution_clockï¼šå’Œæ—¶é’Ÿç±» steady_clock æ˜¯ç­‰ä»·çš„ï¼Œç²¾åº¦æ›´é«˜ï¼ˆæ˜¯å®ƒçš„åˆ«åï¼‰ã€‚\næ¯ä¸ªæ—¶é’Ÿç±»å†…éƒ¨æˆå‘˜æœ‰time_pointã€durationã€Repã€Periodç­‰ä¿¡æ¯ï¼ŒåŸºäºè¿™äº›ä¿¡æ¯æ¥è·å–å½“å‰æ—¶é—´ï¼Œä»¥åŠå®ç°time_tå’Œtime_pointä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚\nåœ¨ä½¿ç”¨chronoæä¾›çš„æ—¶é’Ÿç±»çš„æ—¶å€™ï¼Œä¸éœ€è¦åˆ›å»ºç±»å¯¹è±¡ï¼Œç›´æ¥è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ—¶é—´äº†ã€‚\n3.1system_clock å®šä¹‰\nstruct system_clock { // using å®šä¹‰åˆ«å using rep = long long; using period = ratio\u003c1, 10'000'000\u003e; // 100 çº³ç§’ using duration = chrono::duration\u003crep, period\u003e;//æ—¶é—´é—´éš”ä¸ºrep*period 100çº³ç§’ using time_point = chrono::time_point\u003csystem_clock\u003e; //æ—¶é—´ç‚¹é€šè¿‡ç³»ç»Ÿæ—¶é’Ÿåšäº†åˆå§‹åŒ– static constexpr bool is_steady = false; _NODISCARD static time_point now() noexcept { // get current timeï¼Œè¿”å›è¡¨ç¤ºå½“å‰æ—¶é—´çš„æ—¶é—´ç‚¹ã€‚ return time_point(duration(_Xtime_get_ticks())); } _NODISCARD static __time64_t to_time_t(const time_point\u0026 _Time) noexcept { // convert to __time64_tï¼Œå°† time_point æ—¶é—´ç‚¹ç±»å‹è½¬æ¢ä¸º std::time_t ç±»å‹ return duration_cast\u003cseconds\u003e(_Time.time_since_epoch()).count(); } _NODISCARD static time_point from_time_t(__time64_t _Tm) noexcept { // convert from __time64_tï¼Œå°† std::time_t ç±»å‹è½¬æ¢ä¸º time_point æ—¶é—´ç‚¹ç±»å‹ return time_point{seconds{_Tm}}; } }; example\n#include #include int main() { // æ–°çºªå…ƒ1970.1.1æ—¶é—´ std::chrono::system_clock::time_point epoch; std::chrono::duration\u003cint,std::ratio\u003c60 * 60 * 24\u003e\u003e day(1); // æ–°çºªå…ƒ1970.1.1æ—¶é—´ + 1å¤© std::chrono::system_clock::time_point ppt(day); using day_t = std::chrono::duration\u003cint, std::ratio\u003c60 * 60 * 24\u003e\u003e; // æ–°çºªå…ƒ1970.1.1æ—¶é—´ + 10å¤© // std::chrono::time_pointéœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•° std::chrono::time_point\u003cstd::chrono::system_clock,day_t\u003e t(day_t(10)); // ç³»ç»Ÿå½“å‰æ—¶é—´ // std::chrono::system_clock::time_point = chrono::time_point std::chrono::system_clock::time_point today = std::chrono::system_clock::now(); // è½¬æ¢ä¸ºtime_tæ—¶é—´ç±»å‹ time_t tm = std::chrono::system_clock::to_time_t(today); std::cout \u003c\u003c \"ä»Šå¤©çš„æ—¥æœŸæ˜¯: \" \u003c\u003c ctime(\u0026tm); time_t tm1 = std::chrono::system_clock::to_time_t(today+day); std::cout \u003c\u003c \"æ˜å¤©çš„æ—¥æœŸæ˜¯: \" \u003c\u003c ctime(\u0026tm1); time_t tm2 = std::chrono::system_clock::to_time_t(epoch); std::cout \u003c\u003c \"æ–°çºªå…ƒæ—¶é—´: \" \u003c\u003c ctime(\u0026tm2); time_t tm3 = std::chrono::system_clock::to_time_t(ppt); std::cout \u003c\u003c \"æ–°çºªå…ƒæ—¶é—´+1å¤©: \" \u003c\u003c ctime(\u0026tm3); time_t tm4 = std::chrono::system_clock::to_time_t(t); std::cout \u003c\u003c \"æ–°çºªå…ƒæ—¶é—´+10å¤©: \" \u003c\u003c ctime(\u0026tm4); } 3.2 steady_clock æƒ³è¦è·å–ç¨‹åºè€—æ—¶çš„æ—¶é•¿ï¼Œå¯ä»¥ä½¿ç”¨syetem_clockï¼Œå› ä¸ºè¿™ä¸ªæ—¶é—´å¯ä»¥è·Ÿéšç³»ç»Ÿçš„è®¾ç½®å‘ç”Ÿå˜åŒ–ã€‚\nsteady_clockç›¸å½“äºç§’è¡¨ï¼Œåªè¦å¯åŠ¨å°±ä¼šè¿›è¡Œæ—¶é—´çš„ç´¯åŠ ï¼Œå¹¶ä¸”ä¸èƒ½è¢«ä¿®æ”¹ï¼Œ\nå®šä¹‰\nstruct steady_clock { // wraps QueryPerformanceCounter using rep = long long;// é€šè¿‡long longæ•´å½¢æ¥è®°å½•æ—¶é’Ÿå‘¨æœŸçš„ä¸ªæ•° using period = nano;// æ—¶é’Ÿå‘¨æœŸä¸º1çº³ç§’ using duration = nanoseconds; // æ—¶é—´é—´éš”ä¸º1ns using time_point = chrono::time_point\u003csteady_clock\u003e; // é€šè¿‡steady_clockå¯¹æ—¶é—´ç‚¹è¿›è¡Œåˆå§‹åŒ– static constexpr bool is_steady = true; // get current time _NODISCARD static time_point now() noexcept { // doesn't change after system boot const long long _Freq = _Query_perf_frequency(); const long long _Ctr = _Query_perf_counter(); static_assert(period::num == 1, \"This assumes period::num == 1.\"); const long long _Whole = (_Ctr / _Freq) * period::den; const long long _Part = (_Ctr % _Freq) * period::den / _Freq; return time_point(duration(_Whole + _Part)); } }; example\n#include #include int main() { // è·å–å¼€å§‹æ—¶é—´ç‚¹ std::chrono::steady_clock::time_point start = std::chrono::steady_clock::now(); // éœ€è¦è·å–ç¨‹åºè€—æ—¶çš„ä»£ç æ®µ std::cout \u003c\u003c \"print 1000 stars ....\" \u003c\u003c std::endl; for (int i = 0; i \u003c 1000; ++i) { std::cout \u003c\u003c \"*\"; } std::cout \u003c\u003c std::endl; // è·å–ç»“æŸæ—¶é—´ç‚¹ std::chrono::steady_clock::time_point last = std::chrono::steady_clock::now(); // è®¡ç®—å·®å€¼ï¼Œæ˜¯ä¸€ä¸ªæ—¶é—´é—´éš” auto dt = last - start; // dt.count()è¿”å›æ—¶é—´é—´éš”ä¸­æœ‰å¤šå°‘ä¸ªæ—¶é’Ÿå‘¨æœŸ std::cout \u003c\u003c \"æ€»å…±è€—æ—¶: \" \u003c\u003c dt.count() \u003c\u003c \"çº³ç§’\" \u003c\u003c std::endl; std::cout \u003c\u003c \"æ€»å…±è€—æ—¶: \" \u003c\u003c dt.count() / (double)1000000 \u003c\u003c \"ms\" \u003c\u003c std::endl; } 3.3 high_resolution_clock high_resolution_clockæä¾›çš„æ—¶é’Ÿç²¾åº¦æ¯”system_clockè¦é«˜ï¼Œå®ƒä¹Ÿæ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ã€‚åœ¨åº•å±‚æºç ä¸­ï¼Œè¿™ä¸ªç±»å…¶å®æ˜¯steady_clockç±»çš„åˆ«å\nusing high_resolution_clock = steady_clock; å› æ­¤ä½¿ç”¨æ–¹å¼å’Œsteady_clockæ˜¯ä¸€æ ·çš„\n4.è½¬æ¢å‡½æ•° 4.1duration_cast duration_castæ˜¯chronoåº“æä¾›çš„ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸å±äºdurationç±»ã€‚é€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥å¯¹durationç±»å¯¹è±¡å†…éƒ¨çš„æ—¶é’Ÿå‘¨æœŸPeriodï¼Œå’Œå‘¨æœŸæ¬¡æ•°çš„ç±»å‹Repè¿›è¡Œä¿®æ”¹ã€‚\nå®šä¹‰å¦‚ä¸‹ï¼š\ntemplate \u003cclass ToDuration, class Rep, class Period\u003e constexpr ToDuration duration_cast (const duration\u003cRep,Period\u003e\u0026 dtn); // è¿”å›ç›®æ ‡ç±»å‹ToDurationçš„æ—¶é—´é—´éš” æ³¨æ„ï¼š\nå¦‚æœæ˜¯å¯¹æ—¶é’Ÿå‘¨æœŸè¿›è¡Œè½¬æ¢ï¼šæºæ—¶é’Ÿå‘¨æœŸå¿…é¡»èƒ½å¤Ÿæ•´é™¤ç›®çš„æ—¶é’Ÿå‘¨æœŸï¼ˆæ¯”å¦‚ï¼šå°æ—¶åˆ°åˆ†é’Ÿï¼‰ã€‚ å¦‚æœæ˜¯å¯¹æ—¶é’Ÿå‘¨æœŸæ¬¡æ•°çš„ç±»å‹è¿›è¡Œè½¬æ¢ï¼šä½ç­‰ç±»å‹é»˜è®¤å¯ä»¥å‘é«˜ç­‰ç±»å‹è¿›è¡Œè½¬æ¢ï¼ˆæ¯”å¦‚ï¼šint è½¬ doubleï¼‰ã€‚ å¦‚æœæ—¶é’Ÿå‘¨æœŸå’Œæ—¶é’Ÿå‘¨æœŸæ¬¡æ•°ç±»å‹éƒ½å˜äº†ï¼Œæ ¹æ®ç¬¬äºŒç‚¹è¿›è¡Œæ¨å¯¼ï¼ˆä¹Ÿå°±æ˜¯çœ‹æ—¶é—´å‘¨æœŸæ¬¡æ•°ç±»å‹ï¼‰ã€‚ ä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ duration_cast è¿›è¡Œæ˜¾ç¤ºè½¬æ¢ï¼Œæ¯”å¦‚å°çš„æ—¶é’Ÿå‘¨æœŸè½¬å¤§çš„æ—¶é’Ÿå‘¨æœŸã€‚\nexample\n#include #include void f(){ std::cout \u003c\u003c \"print 1000 stars ....\" \u003c\u003c std::endl; for (int i = 0; i \u003c 1000; ++i) { std::cout \u003c\u003c \"*\"; } std::cout \u003c\u003c std::endl; } int main() { // è·å–å¼€å§‹æ—¶é—´ç‚¹ std::chrono::steady_clock::time_point start = std::chrono::steady_clock::now(); // éœ€è¦è·å–ç¨‹åºè€—æ—¶çš„ä»£ç æ®µ f(); // è·å–ç»“æŸæ—¶é—´ç‚¹ std::chrono::steady_clock::time_point last = std::chrono::steady_clock::now(); // è®¡ç®—å·®å€¼ï¼Œæ˜¯ä¸€ä¸ªä¸ºå¤šå°‘nsçš„æ—¶é—´é—´éš” auto dt = last - start; // dt.count()è¿”å›æ—¶é—´é—´éš”ä¸­æœ‰å¤šå°‘ä¸ªæ—¶é’Ÿå‘¨æœŸ std::cout \u003c\u003c \"æ€»å…±è€—æ—¶: \" \u003c\u003c dt.count() \u003c\u003c \"çº³ç§’\" \u003c\u003c std::endl; // è½¬æ¢ // æ•´æ•°æ—¶é•¿ï¼šæ—¶é’Ÿå‘¨æœŸçº³ç§’è½¬æ¯«ç§’ï¼Œå°è½¬å¤§ï¼Œå¹¶ä¸”æ˜¯intè½¬intï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è½¬ï¼Œè¦æ±‚ duration_cast auto int_ms = std::chrono::duration_cast\u003cstd::chrono::milliseconds\u003e(dt); // å°æ•°æ—¶é•¿ï¼šintè½¬doubleï¼Œç¬¦åˆç¬¬äºŒç‚¹ï¼Œè™½ç„¶æ˜¯å°è½¬å¤§ä½†ä¸è¦æ±‚ duration_cast std::chrono::duration\u003cdouble, std::ratio\u003c1, 1000\u003e\u003e fp_ms = dt; std::cout \u003c\u003c \"f() took \" \u003c\u003c fp_ms.count() \u003c\u003c \" ms, \" \u003c\u003c \"or \" \u003c\u003c int_ms.count() \u003c\u003c \" whole milliseconds\\n\"\u003c\u003c std::endl; } 4.2 time_point_cast time_point_castä¹Ÿæ˜¯chronoåº“æä¾›çš„ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸å±äºtime_pointç±»ã€‚å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹æ—¶é—´ç‚¹è¿›è¡Œè½¬æ¢ï¼Œå› ä¸ºä¸åŒçš„æ—¶é—´ç‚¹å¯¹è±¡å†…éƒ¨çš„æ—¶é’Ÿå‘¨æœŸPeriodï¼Œå’Œå‘¨æœŸæ¬¡æ•°çš„ç±»å‹Repå¯èƒ½ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å®ƒä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ˜¾ç¤ºçš„è¿›è¡Œè½¬æ¢ã€‚\nå®šä¹‰ï¼š\ntemplate \u003cclass ToDuration, class Clock, class Duration\u003e time_point\u003cClock, ToDuration\u003e time_point_cast(const time_point\u003cClock, Duration\u003e \u0026t); example\n#include #include // å®šä¹‰åˆ«å using Clock = std::chrono::high_resolution_clock; using Ms = std::chrono::milliseconds; using Sec = std::chrono::seconds; template\u003cclass Duration\u003e using TimePoint = std::chrono::time_point\u003cClock, Duration\u003e;//clockç±»å‹ä¸ºhigh_resolution_clock void print_ms(const TimePoint\u003cMs\u003e\u0026 time_point) { std::cout \u003c\u003c time_point.time_since_epoch().count() \u003c\u003c \" ms\\n\"; } int main() { TimePoint\u003cSec\u003e time_point_sec(Sec(6)); // æ— ç²¾åº¦æŸå¤±, å¯ä»¥è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ TimePoint\u003cMs\u003e time_point_ms(time_point_sec); print_ms(time_point_ms); // 6000 ms time_point_ms = TimePoint\u003cMs\u003e(Ms(6789)); // errorï¼Œä¼šæŸå¤±ç²¾åº¦ï¼Œä¸å…è®¸è¿›è¡Œéšå¼çš„ç±»å‹è½¬æ¢ TimePoint\u003cSec\u003e sec(time_point_ms); // æ˜¾ç¤ºç±»å‹è½¬æ¢,ä¼šæŸå¤±ç²¾åº¦ã€‚6789 truncated to 6000 time_point_sec = std::chrono::time_point_cast\u003cSec\u003e(time_point_ms); print_ms(time_point_sec); // 6000 ms } ","wordCount":"861","inLanguage":"en","image":"https://dueplay.github.io/%3Cimage%20path/url%3E","datePublished":"2022-05-23T13:42:01+08:00","dateModified":"2022-05-23T13:42:01+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dueplay.github.io/posts/chrono/"},"publisher":{"@type":"Organization","name":"Cookie's Blog","logo":{"@type":"ImageObject","url":"https://dueplay.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dueplay.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu><li><a href=https://dueplay.github.io/archives/ title=â±archives><span>â±archives</span></a></li><li><a href=https://dueplay.github.io/search/ title=ğŸ”Search><span>ğŸ”Search</span></a></li><li><a href=https://dueplay.github.io/tags/ title=ğŸ”–Tags><span>ğŸ”–Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dueplay.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://dueplay.github.io/posts/>Posts</a></div><h1 class=post-title>chronoåº“çš„ä½¿ç”¨</h1><div class=post-description>c++11æ–°å¼•å…¥çš„chronoåº“ä»‹ç»å’Œä½¿ç”¨</div><div class=post-meta>&lt;span title='2022-05-23 13:42:01 +0800 +0800'>2022-05-23&lt;/span>&amp;nbsp;Â·&amp;nbsp;5 min&amp;nbsp;Â·&amp;nbsp;861 words&amp;nbsp;Â·&amp;nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/Dueplay/blog/content/posts/chrono.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#1duration>1.duration</a></li><li><a href=#2æ—¶é—´ç‚¹-time-point>2.æ—¶é—´ç‚¹ time point</a></li><li><a href=#3æ—¶é’Ÿclock>3.æ—¶é’ŸClock</a></li><li><a href=#4è½¬æ¢å‡½æ•°>4.è½¬æ¢å‡½æ•°</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>chronoåº“ä¸»è¦åŒ…å«ä¸‰ç§ç±»å‹çš„ç±»ï¼šæ—¶é—´é—´éš”durationã€æ—¶é’Ÿclocksã€æ—¶é—´ç‚¹time point</p><h3 id=1duration>1.duration<a hidden class=anchor aria-hidden=true href=#1duration>#</a></h3><p>ç”¨æ¥è®°å½•æ—¶é—´é•¿åº¦ï¼Œå¯ä»¥è¡¨ç¤ºå‡ ç§’ã€å‡ åˆ†é’Ÿã€å‡ ä¸ªå°æ—¶çš„æ—¶é—´é—´éš”</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// durationçš„å®šä¹‰ï¼Œå®šä¹‰äºå¤´æ–‡ä»¶ &lt;chrono&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Rep</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Period</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>duration</span><span class=p>;</span> <span class=c1>//è¡¨ç¤ºRepä¸ªPeriodï¼Œä¸€ä¸ªperiodæ˜¯ä¸€ä¸ªratioç±»ï¼Œé»˜è®¤ä¸º1s
</span></span></span><span class=line><span class=cl><span class=c1>// ratioçš„å®šä¹‰ï¼Œå®šä¹‰äºå¤´æ–‡ä»¶ &lt;ratio&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>intmax_t</span> <span class=n>Num</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>intmax_t</span> <span class=n>Denom</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>ratio</span><span class=p>;</span> <span class=c1>// ä»£è¡¨ Num / Denom ç§’ï¼Œåˆ†æ¯é»˜è®¤ä¸º1ï¼Œratio&lt;2&gt;ä»£è¡¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæ˜¯2ç§’
</span></span></span></code></pre></div><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œåœ¨æ ‡å‡†åº“ä¸­å®šä¹‰äº†ä¸€äº›å¸¸ç”¨çš„æ—¶é—´é—´éš”,å®šä¹‰å¦‚ä¸‹</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=err>çº³ç§’ï¼š</span><span class=k>using</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>nanoseconds</span> <span class=o>=</span> <span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=err>*/</span><span class=o>*</span><span class=n>Repè‡³å°‘</span> <span class=mi>64</span> <span class=err>ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/</span><span class=o>*</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>nano</span><span class=o>&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>     <span class=n>std</span><span class=o>::</span><span class=n>nano</span> <span class=err>ä¸º</span> <span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span><span class=mf>10e9</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=err>å¾®ç§’ï¼š</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>microseconds</span>	<span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=err>*/</span><span class=o>*</span><span class=err>è‡³å°‘</span> <span class=mi>55</span> <span class=err>ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/</span><span class=o>*</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>micro</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=err>æ¯«ç§’ï¼š</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>milliseconds</span>	<span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=err>*/</span><span class=o>*</span><span class=err>è‡³å°‘</span> <span class=mi>45</span> <span class=err>ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/</span><span class=o>*</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>milli</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=err>ç§’ï¼š</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>seconds</span>	<span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=err>*/</span><span class=o>*</span><span class=err>è‡³å°‘</span> <span class=mi>35</span> <span class=err>ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/</span><span class=o>*&gt;</span>
</span></span><span class=line><span class=cl><span class=err>åˆ†é’Ÿï¼š</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>minutes</span>	<span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=err>*/</span><span class=o>*</span><span class=err>è‡³å°‘</span> <span class=mi>29</span> <span class=err>ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/</span><span class=o>*</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>60</span><span class=o>&gt;&gt;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>minutes</span> <span class=n>m</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span><span class=c1>//è¡¨ç¤º1m
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=err>å°æ—¶ï¼š</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>hours</span>	<span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=err>*/</span><span class=o>*</span><span class=err>è‡³å°‘</span> <span class=mi>23</span> <span class=err>ä½çš„æœ‰ç¬¦å·æ•´æ•°ç±»å‹*/</span><span class=o>*</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>3600</span><span class=o>&gt;&gt;</span>
</span></span></code></pre></div><p>æ„é€ å‡½æ•°</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// 1. æ‹·è´æ„é€ å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>duration</span><span class=p>(</span> <span class=k>const</span> <span class=n>duration</span><span class=o>&amp;</span> <span class=p>)</span> <span class=o>=</span> <span class=k>default</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. é€šè¿‡æŒ‡å®šæ—¶é’Ÿå‘¨æœŸçš„ç±»å‹æ¥æ„é€ å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span> <span class=k>class</span> <span class=nc>Rep2</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=k>explicit</span> <span class=n>duration</span><span class=p>(</span> <span class=k>const</span> <span class=n>Rep2</span><span class=o>&amp;</span> <span class=n>r</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 3. é€šè¿‡æŒ‡å®šæ—¶é’Ÿå‘¨æœŸç±»å‹ï¼Œå’Œæ—¶é’Ÿå‘¨æœŸé•¿åº¦æ¥æ„é€ å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span> <span class=k>class</span> <span class=nc>Rep2</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Period2</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>constexpr</span> <span class=n>duration</span><span class=p>(</span> <span class=k>const</span> <span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep2</span><span class=p>,</span><span class=n>Period2</span><span class=o>&gt;&amp;</span> <span class=n>d</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// è¿˜é‡è½½äº†ä»¥ä¸‹æ“ä½œç¬¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>operator</span><span class=o>=</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>operator</span><span class=o>+</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>operator</span><span class=o>-</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>operator</span><span class=o>++</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>operator</span><span class=o>++</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>operator</span><span class=o>--</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>operator</span><span class=o>--</span><span class=p>(</span><span class=kt>int</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=o>+=</span><span class=p>,</span><span class=o>-=</span><span class=p>,</span><span class=o>*=</span><span class=p>,</span><span class=o>/=</span><span class=p>,</span><span class=o>%=</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//è·å–æ—¶é—´é—´éš”çš„æ—¶é’Ÿå‘¨æœŸä¸ªæ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>constexpr</span> <span class=n>rep</span> <span class=nf>count</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   
</span></span></code></pre></div><p>example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>hour</span> <span class=n>h</span><span class=p>(</span><span class=mi>2</span><span class=p>);</span><span class=c1>// hè¡¨ç¤º2å°æ—¶çš„æ—¶é—´é—´éš”å¯¹è±¡
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>millisecond</span> <span class=n>ms</span><span class=p>{</span><span class=mi>3</span><span class=p>};</span><span class=c1>// msè¡¨ç¤º3æ¯«ç§’
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>60</span><span class=o>&gt;&gt;</span> <span class=n>ten_m</span><span class=p>(</span><span class=mi>3</span><span class=p>);</span> <span class=c1>// 3ä¸ª60ç§’
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span><span class=mi>1000</span><span class=o>&gt;&gt;</span> <span class=n>ms_</span><span class=p>(</span><span class=mf>5.5</span><span class=p>);</span> <span class=c1>// 5.5ä¸ª1msï¼Œä¹Ÿè®¡æ˜¯5.5ms
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>minute</span> <span class=n>t1</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>second</span> <span class=n>t2</span><span class=p>(</span><span class=mi>20</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>second</span> <span class=n>t3</span> <span class=o>=</span> <span class=n>t1</span> <span class=o>-</span> <span class=n>t2</span><span class=p>;</span><span class=c1>//1m - 30s = 30s,t3ä¸º30s
</span></span></span></code></pre></div><p>durationçš„åŠ å‡è¿ç®—æœ‰ä¸€å®šçš„è§„åˆ™ï¼Œå½“ä¸¤ä¸ªdurationæ—¶é’Ÿå‘¨æœŸä¸ç›¸åŒçš„æ—¶å€™ï¼Œä¼šå…ˆç»Ÿä¸€æˆä¸€ç§æ—¶é’Ÿï¼Œç„¶åå†è¿›è¡Œç®—æœ¯è¿ç®—ï¼Œç»Ÿä¸€çš„è§„åˆ™å¦‚ä¸‹ï¼šå‡è®¾æœ‰ratio&lt;x1,y1> å’Œ ratio&lt;x2,y2>ä¸¤ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œé¦–å…ˆéœ€è¦æ±‚å‡ºx1ï¼Œx2çš„æœ€å¤§å…¬çº¦æ•°Xï¼Œç„¶åæ±‚å‡ºy1ï¼Œy2çš„æœ€å°å…¬å€æ•°Yï¼Œç»Ÿä¸€ä¹‹åçš„æ—¶é’Ÿå‘¨æœŸratioä¸ºratio&lt;X,Y>ã€‚åˆ†å­æ±‚å…¬çº¦ï¼Œåˆ†æ¯æ±‚å…¬å€ã€‚å› ä¸ºæ˜¯x1 / y1 - x2 / y2,å°±é€šåˆ†å‘—ï¼ŒåŒ–ä¸º X/Y,x1/y1å¯ä»¥è¡¨ç¤ºä¸ºå¤šå°‘ä¸ª X/Yï¼Œ x2 / y2åŒç†ã€‚</p><p>ratio&lt;9, 7>å’Œratio&lt;6, 5>ï¼Œç»Ÿä¸€ä¹‹åçš„æ—¶é’Ÿå‘¨æœŸratio&lt;3, 35>ï¼Œä¸€ä¸ªratio&lt;9, 7>å°±è¡¨ç¤ºä¸º15ä¸ªratio&lt;3, 35>ï¼Œè€Œratio&lt;6, 5>å¯è¡¨ç¤ºä¸º14ä¸ªratio&lt;3, 35>ã€‚å•ä½å°±ç»Ÿä¸€äº†ã€‚</p><h3 id=2æ—¶é—´ç‚¹-time-point>2.æ—¶é—´ç‚¹ time point<a hidden class=anchor aria-hidden=true href=#2æ—¶é—´ç‚¹-time-point>#</a></h3><p>ä¸€ä¸ªè¡¨ç¤ºæ—¶é—´ç‚¹çš„ç±»ï¼Œå®šä¹‰å¦‚ä¸‹</p><p>è¯¥ç±»é€šå¸¸é…åˆclockä¸€èµ·ä½¿ç”¨</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=c1>// å®šä¹‰äºå¤´æ–‡ä»¶ &lt;chrono&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Clock</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=nc>Duration</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>Clock</span><span class=o>::</span><span class=n>duration</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>time_point</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// Clockï¼šæ­¤æ—¶é—´ç‚¹time_pointåœ¨æ­¤æ—¶é’ŸClockä¸Šè®¡é‡
</span></span></span><span class=line><span class=cl><span class=c1>// ç”¨äºè®¡é‡ä»çºªå…ƒèµ·æ—¶é—´çš„ std::chrono::duration ç±»å‹ï¼Œè¡¨ç¤ºä»clockæ—¶é—´æŒç»­durationæ®µæ—¶é—´çš„æ—¶é—´ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// æ„é€ å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1>// 1. æ„é€ ä¸€ä¸ªä»¥æ–°çºªå…ƒ(epochï¼Œå³ï¼š1970.1.1)ä½œä¸ºå€¼çš„å¯¹è±¡ï¼Œéœ€è¦å’Œæ—¶é’Ÿç±»ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨è¯¥æ— å‚æ„é€ å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>time_point</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=c1>// 2. æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œè¿™ä¸ªæ—¶é—´ç‚¹ä¸ºä»epochå¼€å§‹æŒç»­dè¿™ä¹ˆä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œéœ€è¦å’Œæ—¶é’Ÿç±»ä¸€èµ·ä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨è¯¥æ„é€ å‡½æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>explicit</span> <span class=nf>time_point</span><span class=p>(</span> <span class=k>const</span> <span class=n>duration</span><span class=o>&amp;</span> <span class=n>d</span> <span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// 3. æ‹·è´æ„é€ å‡½æ•°ï¼Œæ„é€ ä¸tç›¸åŒæ—¶é—´ç‚¹çš„å¯¹è±¡ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>template</span><span class=o>&lt;</span> <span class=k>class</span> <span class=nc>Duration2</span> <span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>time_point</span><span class=p>(</span> <span class=k>const</span> <span class=n>time_point</span><span class=o>&lt;</span><span class=n>Clock</span><span class=p>,</span><span class=n>Duration2</span><span class=o>&gt;&amp;</span> <span class=n>t</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//ç”¨æ¥è·å¾—1970å¹´1æœˆ1æ—¥åˆ°time_pointå¯¹è±¡ä¸­è®°å½•çš„æ—¶é—´ç‚¹ç»è¿‡çš„æ—¶é—´é—´éš”ï¼ˆdurationï¼‰ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>duration</span> <span class=nf>time_since_epoch</span><span class=p>()</span> <span class=k>const</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// æ­¤å¤–è¿˜æœ‰å¾ˆå¤šé‡è½½operator
</span></span></span></code></pre></div><h3 id=3æ—¶é’Ÿclock>3.æ—¶é’ŸClock<a hidden class=anchor aria-hidden=true href=#3æ—¶é’Ÿclock>#</a></h3><p>chronoåº“ä¸­æä¾›äº†è·å–å½“å‰çš„ç³»ç»Ÿæ—¶é—´çš„æ—¶é’Ÿç±»ï¼ŒåŒ…å«çš„æ—¶é’Ÿä¸€å…±æœ‰ä¸‰ç§ï¼š</p><p>system_clockï¼šç³»ç»Ÿçš„æ—¶é’Ÿï¼Œç³»ç»Ÿçš„æ—¶é’Ÿå¯ä»¥ä¿®æ”¹ï¼Œç”šè‡³å¯ä»¥ç½‘ç»œå¯¹æ—¶ï¼Œå› æ­¤ä½¿ç”¨ç³»ç»Ÿæ—¶é—´è®¡ç®—æ—¶é—´å·®å¯èƒ½ä¸å‡†ã€‚
steady_clockï¼šæ˜¯å›ºå®šçš„æ—¶é’Ÿï¼Œç›¸å½“äºç§’è¡¨ã€‚å¼€å§‹è®¡æ—¶åï¼Œæ—¶é—´åªä¼šå¢é•¿å¹¶ä¸”ä¸èƒ½ä¿®æ”¹ï¼Œé€‚åˆç”¨äºè®°å½•ç¨‹åºè€—æ—¶
high_resolution_clockï¼šå’Œæ—¶é’Ÿç±» steady_clock æ˜¯ç­‰ä»·çš„ï¼Œç²¾åº¦æ›´é«˜ï¼ˆæ˜¯å®ƒçš„åˆ«åï¼‰ã€‚</p><p>æ¯ä¸ªæ—¶é’Ÿç±»å†…éƒ¨æˆå‘˜æœ‰time_pointã€durationã€Repã€Periodç­‰ä¿¡æ¯ï¼ŒåŸºäºè¿™äº›ä¿¡æ¯æ¥è·å–å½“å‰æ—¶é—´ï¼Œä»¥åŠå®ç°time_tå’Œtime_pointä¹‹é—´çš„ç›¸äº’è½¬æ¢ã€‚</p><p><strong>åœ¨ä½¿ç”¨chronoæä¾›çš„æ—¶é’Ÿç±»çš„æ—¶å€™ï¼Œä¸éœ€è¦åˆ›å»ºç±»å¯¹è±¡ï¼Œç›´æ¥è°ƒç”¨ç±»çš„é™æ€æ–¹æ³•å°±å¯ä»¥å¾—åˆ°æƒ³è¦çš„æ—¶é—´äº†ã€‚</strong></p><h4 id=31system_clock>3.1system_clock<a hidden class=anchor aria-hidden=true href=#31system_clock>#</a></h4><p>å®šä¹‰</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>system_clock</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>    <span class=c1>// using å®šä¹‰åˆ«å
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>rep</span>                       <span class=o>=</span> <span class=kt>long</span> <span class=kt>long</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>period</span>                    <span class=o>=</span> <span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=mi>10&#39;000&#39;000</span><span class=o>&gt;</span><span class=p>;</span> <span class=c1>// 100 çº³ç§’
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>duration</span>                  <span class=o>=</span> <span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=n>rep</span><span class=p>,</span> <span class=n>period</span><span class=o>&gt;</span><span class=p>;</span><span class=c1>//æ—¶é—´é—´éš”ä¸ºrep*period 100çº³ç§’
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>time_point</span>                <span class=o>=</span> <span class=n>chrono</span><span class=o>::</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>system_clock</span><span class=o>&gt;</span><span class=p>;</span> <span class=c1>//æ—¶é—´ç‚¹é€šè¿‡ç³»ç»Ÿæ—¶é’Ÿåšäº†åˆå§‹åŒ–
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_steady</span> <span class=o>=</span> <span class=nb>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_NODISCARD</span> <span class=k>static</span> <span class=n>time_point</span> <span class=nf>now</span><span class=p>()</span> <span class=k>noexcept</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=c1>// get current timeï¼Œè¿”å›è¡¨ç¤ºå½“å‰æ—¶é—´çš„æ—¶é—´ç‚¹ã€‚
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>time_point</span><span class=p>(</span><span class=n>duration</span><span class=p>(</span><span class=n>_Xtime_get_ticks</span><span class=p>()));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_NODISCARD</span> <span class=k>static</span> <span class=n>__time64_t</span> <span class=nf>to_time_t</span><span class=p>(</span><span class=k>const</span> <span class=n>time_point</span><span class=o>&amp;</span> <span class=n>_Time</span><span class=p>)</span> <span class=k>noexcept</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=c1>// convert to __time64_tï¼Œå°† time_point æ—¶é—´ç‚¹ç±»å‹è½¬æ¢ä¸º std::time_t ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>duration_cast</span><span class=o>&lt;</span><span class=n>seconds</span><span class=o>&gt;</span><span class=p>(</span><span class=n>_Time</span><span class=p>.</span><span class=n>time_since_epoch</span><span class=p>()).</span><span class=n>count</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>_NODISCARD</span> <span class=k>static</span> <span class=n>time_point</span> <span class=nf>from_time_t</span><span class=p>(</span><span class=n>__time64_t</span> <span class=n>_Tm</span><span class=p>)</span> <span class=k>noexcept</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> <span class=c1>// convert from __time64_tï¼Œå°† std::time_t ç±»å‹è½¬æ¢ä¸º time_point æ—¶é—´ç‚¹ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>return</span> <span class=n>time_point</span><span class=p>{</span><span class=n>seconds</span><span class=p>{</span><span class=n>_Tm</span><span class=p>}};</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;chrono&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ–°çºªå…ƒ1970.1.1æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>epoch</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span><span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>24</span><span class=o>&gt;&gt;</span> <span class=n>day</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ–°çºªå…ƒ1970.1.1æ—¶é—´ + 1å¤©
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>ppt</span><span class=p>(</span><span class=n>day</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>using</span> <span class=n>day_t</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>60</span> <span class=o>*</span> <span class=mi>60</span> <span class=o>*</span> <span class=mi>24</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ–°çºªå…ƒ1970.1.1æ—¶é—´ + 10å¤©
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// std::chrono::time_pointéœ€è¦æŒ‡å®šæ¨¡æ¿å‚æ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=p>,</span><span class=n>day_t</span><span class=o>&gt;</span> <span class=n>t</span><span class=p>(</span><span class=n>day_t</span><span class=p>(</span><span class=mi>10</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ç³»ç»Ÿå½“å‰æ—¶é—´
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// std::chrono::system_clock::time_point = chrono::time_point&lt;system_clock&gt;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>today</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// è½¬æ¢ä¸ºtime_tæ—¶é—´ç±»å‹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>time_t</span> <span class=n>tm</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>today</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;ä»Šå¤©çš„æ—¥æœŸæ˜¯:    &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>ctime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tm</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>time_t</span> <span class=n>tm1</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>today</span><span class=o>+</span><span class=n>day</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ˜å¤©çš„æ—¥æœŸæ˜¯:    &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>ctime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tm1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>time_t</span> <span class=n>tm2</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>epoch</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ–°çºªå…ƒæ—¶é—´:      &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>ctime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tm2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>time_t</span> <span class=n>tm3</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>ppt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ–°çºªå…ƒæ—¶é—´+1å¤©:  &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>ctime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tm3</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>time_t</span> <span class=n>tm4</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>system_clock</span><span class=o>::</span><span class=n>to_time_t</span><span class=p>(</span><span class=n>t</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ–°çºªå…ƒæ—¶é—´+10å¤©: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>ctime</span><span class=p>(</span><span class=o>&amp;</span><span class=n>tm4</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=32-steady_clock>3.2 steady_clock<a hidden class=anchor aria-hidden=true href=#32-steady_clock>#</a></h4><p>æƒ³è¦è·å–ç¨‹åºè€—æ—¶çš„æ—¶é•¿ï¼Œå¯ä»¥ä½¿ç”¨syetem_clockï¼Œå› ä¸ºè¿™ä¸ªæ—¶é—´å¯ä»¥è·Ÿéšç³»ç»Ÿçš„è®¾ç½®å‘ç”Ÿå˜åŒ–ã€‚</p><p>steady_clockç›¸å½“äºç§’è¡¨ï¼Œåªè¦å¯åŠ¨å°±ä¼šè¿›è¡Œæ—¶é—´çš„ç´¯åŠ ï¼Œå¹¶ä¸”ä¸èƒ½è¢«ä¿®æ”¹ï¼Œ</p><p>å®šä¹‰</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>struct</span> <span class=nc>steady_clock</span> <span class=p>{</span> <span class=c1>// wraps QueryPerformanceCounter
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>rep</span>                       <span class=o>=</span> <span class=kt>long</span> <span class=kt>long</span><span class=p>;</span><span class=c1>// é€šè¿‡long longæ•´å½¢æ¥è®°å½•æ—¶é’Ÿå‘¨æœŸçš„ä¸ªæ•°
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>period</span>                    <span class=o>=</span> <span class=n>nano</span><span class=p>;</span><span class=c1>// æ—¶é’Ÿå‘¨æœŸä¸º1çº³ç§’
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>duration</span>                  <span class=o>=</span> <span class=n>nanoseconds</span><span class=p>;</span> <span class=c1>// æ—¶é—´é—´éš”ä¸º1ns
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>using</span> <span class=n>time_point</span>                <span class=o>=</span> <span class=n>chrono</span><span class=o>::</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>steady_clock</span><span class=o>&gt;</span><span class=p>;</span> <span class=c1>// é€šè¿‡steady_clockå¯¹æ—¶é—´ç‚¹è¿›è¡Œåˆå§‹åŒ–
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>static</span> <span class=k>constexpr</span> <span class=kt>bool</span> <span class=n>is_steady</span> <span class=o>=</span> <span class=nb>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// get current time
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>_NODISCARD</span> <span class=k>static</span> <span class=n>time_point</span> <span class=nf>now</span><span class=p>()</span> <span class=k>noexcept</span> 
</span></span><span class=line><span class=cl>    <span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=c1>// doesn&#39;t change after system boot
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>const</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>_Freq</span> <span class=o>=</span> <span class=n>_Query_perf_frequency</span><span class=p>();</span> 
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>_Ctr</span>  <span class=o>=</span> <span class=n>_Query_perf_counter</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=k>static_assert</span><span class=p>(</span><span class=n>period</span><span class=o>::</span><span class=n>num</span> <span class=o>==</span> <span class=mi>1</span><span class=p>,</span> <span class=s>&#34;This assumes period::num == 1.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>_Whole</span> <span class=o>=</span> <span class=p>(</span><span class=n>_Ctr</span> <span class=o>/</span> <span class=n>_Freq</span><span class=p>)</span> <span class=o>*</span> <span class=n>period</span><span class=o>::</span><span class=n>den</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>const</span> <span class=kt>long</span> <span class=kt>long</span> <span class=n>_Part</span>  <span class=o>=</span> <span class=p>(</span><span class=n>_Ctr</span> <span class=o>%</span> <span class=n>_Freq</span><span class=p>)</span> <span class=o>*</span> <span class=n>period</span><span class=o>::</span><span class=n>den</span> <span class=o>/</span> <span class=n>_Freq</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>time_point</span><span class=p>(</span><span class=n>duration</span><span class=p>(</span><span class=n>_Whole</span> <span class=o>+</span> <span class=n>_Part</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></div><p>example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;chrono&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è·å–å¼€å§‹æ—¶é—´ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>start</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// éœ€è¦è·å–ç¨‹åºè€—æ—¶çš„ä»£ç æ®µ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;print 1000 stars ....&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>1000</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;*&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è·å–ç»“æŸæ—¶é—´ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>last</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è®¡ç®—å·®å€¼ï¼Œæ˜¯ä¸€ä¸ªæ—¶é—´é—´éš”
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>auto</span> <span class=n>dt</span> <span class=o>=</span> <span class=n>last</span> <span class=o>-</span> <span class=n>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// dt.count()è¿”å›æ—¶é—´é—´éš”ä¸­æœ‰å¤šå°‘ä¸ªæ—¶é’Ÿå‘¨æœŸ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ€»å…±è€—æ—¶: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>dt</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;çº³ç§’&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ€»å…±è€—æ—¶: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>dt</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>/</span> <span class=p>(</span><span class=kt>double</span><span class=p>)</span><span class=mi>1000000</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;ms&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=33-high_resolution_clock>3.3 high_resolution_clock<a hidden class=anchor aria-hidden=true href=#33-high_resolution_clock>#</a></h4><p>high_resolution_clockæä¾›çš„æ—¶é’Ÿç²¾åº¦æ¯”system_clockè¦é«˜ï¼Œå®ƒä¹Ÿæ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ã€‚åœ¨åº•å±‚æºç ä¸­ï¼Œè¿™ä¸ªç±»å…¶å®æ˜¯steady_clockç±»çš„åˆ«å</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>using</span> <span class=n>high_resolution_clock</span> <span class=o>=</span> <span class=n>steady_clock</span><span class=p>;</span>
</span></span></code></pre></div><p>å› æ­¤ä½¿ç”¨æ–¹å¼å’Œsteady_clockæ˜¯ä¸€æ ·çš„</p><h3 id=4è½¬æ¢å‡½æ•°>4.è½¬æ¢å‡½æ•°<a hidden class=anchor aria-hidden=true href=#4è½¬æ¢å‡½æ•°>#</a></h3><h4 id=41duration_cast>4.1duration_cast<a hidden class=anchor aria-hidden=true href=#41duration_cast>#</a></h4><p>duration_castæ˜¯chronoåº“æä¾›çš„ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸å±äºdurationç±»ã€‚é€šè¿‡è¿™ä¸ªå‡½æ•°å¯ä»¥å¯¹durationç±»å¯¹è±¡å†…éƒ¨çš„æ—¶é’Ÿå‘¨æœŸPeriodï¼Œå’Œå‘¨æœŸæ¬¡æ•°çš„ç±»å‹Repè¿›è¡Œä¿®æ”¹ã€‚</p><p>å®šä¹‰å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>ToDuration</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Rep</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Period</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=k>constexpr</span> <span class=n>ToDuration</span> <span class=n>duration_cast</span> <span class=p>(</span><span class=k>const</span> <span class=n>duration</span><span class=o>&lt;</span><span class=n>Rep</span><span class=p>,</span><span class=n>Period</span><span class=o>&gt;&amp;</span> <span class=n>dtn</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>// è¿”å›ç›®æ ‡ç±»å‹ToDurationçš„æ—¶é—´é—´éš”
</span></span></span></code></pre></div><p>æ³¨æ„ï¼š</p><p>å¦‚æœæ˜¯å¯¹æ—¶é’Ÿå‘¨æœŸè¿›è¡Œè½¬æ¢ï¼šæºæ—¶é’Ÿå‘¨æœŸå¿…é¡»èƒ½å¤Ÿæ•´é™¤ç›®çš„æ—¶é’Ÿå‘¨æœŸï¼ˆæ¯”å¦‚ï¼šå°æ—¶åˆ°åˆ†é’Ÿï¼‰ã€‚
å¦‚æœæ˜¯å¯¹æ—¶é’Ÿå‘¨æœŸæ¬¡æ•°çš„ç±»å‹è¿›è¡Œè½¬æ¢ï¼šä½ç­‰ç±»å‹é»˜è®¤å¯ä»¥å‘é«˜ç­‰ç±»å‹è¿›è¡Œè½¬æ¢ï¼ˆæ¯”å¦‚ï¼šint è½¬ doubleï¼‰ã€‚
å¦‚æœæ—¶é’Ÿå‘¨æœŸå’Œæ—¶é’Ÿå‘¨æœŸæ¬¡æ•°ç±»å‹éƒ½å˜äº†ï¼Œæ ¹æ®ç¬¬äºŒç‚¹è¿›è¡Œæ¨å¯¼ï¼ˆä¹Ÿå°±æ˜¯çœ‹æ—¶é—´å‘¨æœŸæ¬¡æ•°ç±»å‹ï¼‰ã€‚
ä»¥ä¸Šæ¡ä»¶éƒ½ä¸æ»¡è¶³ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ duration_cast è¿›è¡Œæ˜¾ç¤ºè½¬æ¢ï¼Œæ¯”å¦‚å°çš„æ—¶é’Ÿå‘¨æœŸè½¬å¤§çš„æ—¶é’Ÿå‘¨æœŸã€‚</p><p>example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;chrono&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=kt>void</span> <span class=nf>f</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;print 1000 stars ....&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>i</span> <span class=o>&lt;</span> <span class=mi>1000</span><span class=p>;</span> <span class=o>++</span><span class=n>i</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;*&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è·å–å¼€å§‹æ—¶é—´ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>start</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// éœ€è¦è·å–ç¨‹åºè€—æ—¶çš„ä»£ç æ®µ
</span></span></span><span class=line><span class=cl><span class=c1></span>   	<span class=n>f</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=c1>// è·å–ç»“æŸæ—¶é—´ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>time_point</span> <span class=n>last</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>steady_clock</span><span class=o>::</span><span class=n>now</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// è®¡ç®—å·®å€¼ï¼Œæ˜¯ä¸€ä¸ªä¸ºå¤šå°‘nsçš„æ—¶é—´é—´éš”
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>auto</span> <span class=n>dt</span> <span class=o>=</span> <span class=n>last</span> <span class=o>-</span> <span class=n>start</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=c1>// dt.count()è¿”å›æ—¶é—´é—´éš”ä¸­æœ‰å¤šå°‘ä¸ªæ—¶é’Ÿå‘¨æœŸ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;æ€»å…±è€—æ—¶: &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>dt</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;çº³ç§’&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// è½¬æ¢
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// æ•´æ•°æ—¶é•¿ï¼šæ—¶é’Ÿå‘¨æœŸçº³ç§’è½¬æ¯«ç§’ï¼Œå°è½¬å¤§ï¼Œå¹¶ä¸”æ˜¯intè½¬intï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è½¬ï¼Œè¦æ±‚ duration_cast
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>auto</span> <span class=n>int_ms</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration_cast</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>milliseconds</span><span class=o>&gt;</span><span class=p>(</span><span class=n>dt</span><span class=p>);</span>
</span></span><span class=line><span class=cl>     <span class=c1>// å°æ•°æ—¶é•¿ï¼šintè½¬doubleï¼Œç¬¦åˆç¬¬äºŒç‚¹ï¼Œè™½ç„¶æ˜¯å°è½¬å¤§ä½†ä¸è¦æ±‚ duration_cast
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>duration</span><span class=o>&lt;</span><span class=kt>double</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>ratio</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=mi>1000</span><span class=o>&gt;&gt;</span> <span class=n>fp_ms</span> <span class=o>=</span> <span class=n>dt</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;f() took &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>fp_ms</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; ms, &#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>&lt;&lt;</span> <span class=s>&#34;or &#34;</span> <span class=o>&lt;&lt;</span> <span class=n>int_ms</span><span class=p>.</span><span class=n>count</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; whole milliseconds</span><span class=se>\n</span><span class=s>&#34;</span><span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h4 id=42-time_point_cast>4.2 time_point_cast<a hidden class=anchor aria-hidden=true href=#42-time_point_cast>#</a></h4><p>time_point_castä¹Ÿæ˜¯chronoåº“æä¾›çš„ä¸€ä¸ªæ¨¡æ¿å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¸å±äºtime_pointç±»ã€‚å‡½æ•°çš„ä½œç”¨æ˜¯å¯¹æ—¶é—´ç‚¹è¿›è¡Œè½¬æ¢ï¼Œå› ä¸ºä¸åŒçš„æ—¶é—´ç‚¹å¯¹è±¡å†…éƒ¨çš„æ—¶é’Ÿå‘¨æœŸPeriodï¼Œå’Œå‘¨æœŸæ¬¡æ•°çš„ç±»å‹Repå¯èƒ½ä¹Ÿæ˜¯ä¸åŒçš„ï¼Œä¸€èˆ¬æƒ…å†µä¸‹å®ƒä»¬ä¹‹é—´å¯ä»¥è¿›è¡Œéšå¼ç±»å‹è½¬æ¢ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¯¥å‡½æ•°æ˜¾ç¤ºçš„è¿›è¡Œè½¬æ¢ã€‚</p><p>å®šä¹‰ï¼š</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=k>template</span> <span class=o>&lt;</span><span class=k>class</span> <span class=nc>ToDuration</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Clock</span><span class=p>,</span> <span class=k>class</span> <span class=nc>Duration</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=n>time_point</span><span class=o>&lt;</span><span class=n>Clock</span><span class=p>,</span> <span class=n>ToDuration</span><span class=o>&gt;</span> <span class=n>time_point_cast</span><span class=p>(</span><span class=k>const</span> <span class=n>time_point</span><span class=o>&lt;</span><span class=n>Clock</span><span class=p>,</span> <span class=n>Duration</span><span class=o>&gt;</span> <span class=o>&amp;</span><span class=n>t</span><span class=p>);</span>
</span></span></code></pre></div><p>example</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;chrono&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=c1>// å®šä¹‰åˆ«å
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>using</span> <span class=n>Clock</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>high_resolution_clock</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Ms</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>milliseconds</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>Sec</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>seconds</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>template</span><span class=o>&lt;</span><span class=k>class</span> <span class=nc>Duration</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=n>TimePoint</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>time_point</span><span class=o>&lt;</span><span class=n>Clock</span><span class=p>,</span> <span class=n>Duration</span><span class=o>&gt;</span><span class=p>;</span><span class=c1>//clockç±»å‹ä¸ºhigh_resolution_clock
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>print_ms</span><span class=p>(</span><span class=k>const</span> <span class=n>TimePoint</span><span class=o>&lt;</span><span class=n>Ms</span><span class=o>&gt;&amp;</span> <span class=n>time_point</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>time_point</span><span class=p>.</span><span class=n>time_since_epoch</span><span class=p>().</span><span class=n>count</span><span class=p>()</span> <span class=o>&lt;&lt;</span> <span class=s>&#34; ms</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>TimePoint</span><span class=o>&lt;</span><span class=n>Sec</span><span class=o>&gt;</span> <span class=n>time_point_sec</span><span class=p>(</span><span class=n>Sec</span><span class=p>(</span><span class=mi>6</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=c1>// æ— ç²¾åº¦æŸå¤±, å¯ä»¥è¿›è¡Œéšå¼ç±»å‹è½¬æ¢
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>TimePoint</span><span class=o>&lt;</span><span class=n>Ms</span><span class=o>&gt;</span> <span class=n>time_point_ms</span><span class=p>(</span><span class=n>time_point_sec</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>print_ms</span><span class=p>(</span><span class=n>time_point_ms</span><span class=p>);</span>    <span class=c1>// 6000 ms
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=n>time_point_ms</span> <span class=o>=</span> <span class=n>TimePoint</span><span class=o>&lt;</span><span class=n>Ms</span><span class=o>&gt;</span><span class=p>(</span><span class=n>Ms</span><span class=p>(</span><span class=mi>6789</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=c1>// errorï¼Œä¼šæŸå¤±ç²¾åº¦ï¼Œä¸å…è®¸è¿›è¡Œéšå¼çš„ç±»å‹è½¬æ¢
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>TimePoint</span><span class=o>&lt;</span><span class=n>Sec</span><span class=o>&gt;</span> <span class=n>sec</span><span class=p>(</span><span class=n>time_point_ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// æ˜¾ç¤ºç±»å‹è½¬æ¢,ä¼šæŸå¤±ç²¾åº¦ã€‚6789 truncated to 6000
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>time_point_sec</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>chrono</span><span class=o>::</span><span class=n>time_point_cast</span><span class=o>&lt;</span><span class=n>Sec</span><span class=o>&gt;</span><span class=p>(</span><span class=n>time_point_ms</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>print_ms</span><span class=p>(</span><span class=n>time_point_sec</span><span class=p>);</span> <span class=c1>// 6000 ms
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://dueplay.github.io/tags/c++11/>C++11</a></li></ul><nav class=paginav><a class=prev href=https://dueplay.github.io/posts/zsh/><span class=title>Â« Prev</span><br><span>zshå®‰è£…ä¸é…ç½®</span>
</a><a class=next href=https://dueplay.github.io/posts/git/><span class=title>Next Â»</span><br><span>Git Tutorial</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://dueplay.github.io/>Cookie's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>