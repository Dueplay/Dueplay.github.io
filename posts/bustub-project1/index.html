<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>bustub project1 | Cookie's Blog</title>
<meta name=keywords content="bustub"><meta name=description content="Desc Text."><meta name=author content="Me"><link rel=canonical href=https://canonical.url/to/page><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2eadbb982468c11a433a3e291f01326f2ba43f065e256bf792dbd79640a92316.js integrity="sha256-Lq27mCRowRpDOj4pHwEybyukPwZeJWv3ktvXlkCpIxY=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://dueplay.github.io/posts/bustub-project1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4XHWHM02GB"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4XHWHM02GB",{anonymize_ip:!1})}</script><meta property="og:title" content="bustub project1"><meta property="og:description" content="Desc Text."><meta property="og:type" content="article"><meta property="og:url" content="https://dueplay.github.io/posts/bustub-project1/"><meta property="og:image" content="https://dueplay.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-11-28T10:32:01+08:00"><meta property="article:modified_time" content="2023-11-28T10:32:01+08:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dueplay.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="bustub project1"><meta name=twitter:description content="Desc Text."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://dueplay.github.io/posts/"},{"@type":"ListItem","position":2,"name":"bustub project1","item":"https://dueplay.github.io/posts/bustub-project1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"bustub project1","name":"bustub project1","description":"Desc Text.","keywords":["bustub"],"articleBody":"buffer poolæ˜¯è´Ÿè´£åœ¨å†…å­˜å’Œç£ç›˜ä¹‹é—´ç§»åŠ¨é¡µé¢(æ•°æ®åº“æ–‡ä»¶æ˜¯ä»¥é¡µæ¥ç»„ç»‡çš„)ã€‚buffer poolçš„æ“ä½œå¯¹äºç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶æ˜¯ é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªpage_idï¼ˆè¿™æ˜¯å”¯ä¸€çš„ï¼‰å»åƒbuffer poolè¯·æ±‚è¿™ä¸ªé¡µé¢ï¼Œæ˜¯ä¸çŸ¥é“è¿™ä¸ªé¡µæ˜¯ä¸æ˜¯å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Œè¿˜æ˜¯éœ€è¦ä»ç£ç›˜ä¸­è¯»ã€‚\nå¯æ‹“å±•hash table ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯éœ€è¦å®ç°ä¸€ä¸ªå¯æ‹“å±•hash tableï¼Œè¿™ä¸ªhash tableçš„ä½œç”¨æ˜¯è´Ÿè´£ç®¡ç†page_idåˆ°buffer poolä¸­é¡µé¢id(frame_id)çš„æ˜ å°„ã€‚buffer poolç®¡ç†Nä¸ªé¡µé¢çš„å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ªé¡µé¢çš„å†…å­˜ç©ºé—´å°±å«åšframeã€‚éœ€è¦è¯»å–ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå°±å°†ä¸€ä¸ªframeåˆ†é…è¿™ä¸ªé¡µé¢ï¼Œç„¶åç”¨hash tableè®°å½•è¿™ä¸ªæ˜ å°„å…³ç³»ã€‚\nåœ¨å®ç°ä¹‹å‰éœ€è¦ç†è§£ä¸€äº›å¯æ‹“å±•å“ˆå¸Œè¡¨ä¸­çš„æ¦‚å¿µï¼š[å‚è€ƒæ–‡çŒ®](Extendible Hashing (Dynamic approach to DBMS) - GeeksforGeeks)\nç›®å½•dirï¼šè¿™ä¸ªå®¹å™¨å­˜å‚¨æŒ‡å‘æ¡¶çš„æŒ‡é’ˆã€‚æ¯ä¸ªdirç»™å®šä¸€ä¸ªå”¯ä¸€çš„idï¼Œå½“æ‰©å¼ å‘ç”Ÿæ—¶idå¯èƒ½éšä¹‹æ”¹å˜ã€‚å“ˆå¸Œå‡½æ•°è¿”å›è¿™ä¸ªç›®å½•çš„idï¼Œè¿™ä¸ªidè¢«ç”¨æ¥æŒ‡å‘åˆé€‚çš„æ¡¶ã€‚dirçš„æ•°é‡ = 2^{å…¨å±€æ·±åº¦} æ¡¶: å­˜å‚¨å“ˆå¸Œé”®ã€‚ç›®å½•æŒ‡å‘æ¡¶ã€‚å¦‚æœå±€éƒ¨æ·±åº¦å°äºå…¨å±€æ·±åº¦æ—¶ï¼Œä¸€ä¸ªæ¡¶å¯èƒ½åŒ…å«ä¸æ­¢ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒã€‚ å…¨å±€æ·±åº¦ï¼šå®ƒè·Ÿç›®å½•ç›¸å…³è”ã€‚å®ƒä»¬è¡¨ç¤ºå“ˆå¸Œå‡½æ•°ä½¿ç”¨çš„æ¯”ç‰¹ä½æ•°ç›®å»åˆ†ç±»è¿™äº›é”®ã€‚å…¨å±€æ·±åº¦=ç›®å½•idçš„æ¯”ç‰¹ä½æ•° å±€éƒ¨æ·±åº¦ï¼šå’Œå…¨å±€æ·±åº¦ç±»ä¼¼ï¼Œå±€éƒ¨æ·±åº¦æ˜¯è·Ÿæ¡¶å…³è”ï¼Œè€Œä¸æ˜¯è·Ÿç›®å½•ã€‚å½“æ¡¶æº¢å‡ºå‘ç”Ÿæ—¶ï¼Œå±€éƒ¨æ·±åº¦æ ¹æ®å…¨å±€æ·±åº¦å»å†³å®šæ‰§è¡Œçš„è¡Œä¸ºã€‚å±€éƒ¨æ·±åº¦é€šå¸¸å°äºç­‰äºå…¨å±€æ·±åº¦ã€‚ æ¡¶åˆ†è£‚ï¼šå½“æ¡¶çš„å…ƒç´ è¶…è¿‡äº†ç‰¹å®šçš„å¤§å°ï¼Œé‚£ä¹ˆæ¡¶åˆ†è£‚æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚ ç›®å½•æ‰©å®¹ï¼šå½“æ¡¶æº¢å‡ºæ—¶ï¼Œå¯èƒ½ä¼šæœ‰ç›®å½•æ‰©å®¹ã€‚å½“æº¢å‡ºæ¡¶çš„å±€éƒ¨æ·±åº¦ç­‰äºå…¨å±€æ·±åº¦æ—¶ï¼Œç›®å½•æ‰©å®¹è¢«æ‰§è¡Œã€‚ é¦–å…ˆéœ€è¦å®ç°çš„æ˜¯Bucketï¼ŒBucketé‡‡ç”¨çš„std::list","wordCount":"102","inLanguage":"en","image":"https://dueplay.github.io/%3Cimage%20path/url%3E","datePublished":"2023-11-28T10:32:01+08:00","dateModified":"2023-11-28T10:32:01+08:00","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://dueplay.github.io/posts/bustub-project1/"},"publisher":{"@type":"Organization","name":"Cookie's Blog","logo":{"@type":"ImageObject","url":"https://dueplay.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dueplay.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu><li><a href=https://dueplay.github.io/archives/ title=â±archives><span>â±archives</span></a></li><li><a href=https://dueplay.github.io/search/ title=ğŸ”Search><span>ğŸ”Search</span></a></li><li><a href=https://dueplay.github.io/tags/ title=ğŸ”–Tags><span>ğŸ”–Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://dueplay.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://dueplay.github.io/posts/>Posts</a></div><h1 class=post-title>bustub project1</h1><div class=post-description>Desc Text.</div><div class=post-meta>&lt;span title='2023-11-28 10:32:01 +0800 +0800'>2023-11-28&lt;/span>&amp;nbsp;Â·&amp;nbsp;1 min&amp;nbsp;Â·&amp;nbsp;102 words&amp;nbsp;Â·&amp;nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/Dueplay/blog/content/posts/bustub%20project1.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#å¯æ‹“å±•hash-table>å¯æ‹“å±•hash table</a></li><li><a href=#lru_kæ›¿æ¢ç­–ç•¥>lru_kæ›¿æ¢ç­–ç•¥</a></li><li><a href=#buffer_pool_manager_instance>buffer_pool_manager_instance</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>buffer poolæ˜¯è´Ÿè´£åœ¨å†…å­˜å’Œç£ç›˜ä¹‹é—´ç§»åŠ¨é¡µé¢(æ•°æ®åº“æ–‡ä»¶æ˜¯ä»¥é¡µæ¥ç»„ç»‡çš„)ã€‚buffer poolçš„æ“ä½œå¯¹äºç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶æ˜¯ é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªpage_idï¼ˆè¿™æ˜¯å”¯ä¸€çš„ï¼‰å»åƒbuffer poolè¯·æ±‚è¿™ä¸ªé¡µé¢ï¼Œæ˜¯ä¸çŸ¥é“è¿™ä¸ªé¡µæ˜¯ä¸æ˜¯å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Œè¿˜æ˜¯éœ€è¦ä»ç£ç›˜ä¸­è¯»ã€‚</p><h3 id=å¯æ‹“å±•hash-table>å¯æ‹“å±•hash table<a hidden class=anchor aria-hidden=true href=#å¯æ‹“å±•hash-table>#</a></h3><p>ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯éœ€è¦å®ç°ä¸€ä¸ªå¯æ‹“å±•hash tableï¼Œè¿™ä¸ªhash tableçš„ä½œç”¨æ˜¯è´Ÿè´£ç®¡ç†page_idåˆ°buffer poolä¸­é¡µé¢id(frame_id)çš„æ˜ å°„ã€‚buffer poolç®¡ç†Nä¸ªé¡µé¢çš„å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ªé¡µé¢çš„å†…å­˜ç©ºé—´å°±å«åšframeã€‚éœ€è¦è¯»å–ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå°±å°†ä¸€ä¸ªframeåˆ†é…è¿™ä¸ªé¡µé¢ï¼Œç„¶åç”¨hash tableè®°å½•è¿™ä¸ªæ˜ å°„å…³ç³»ã€‚</p><p><img loading=lazy src=..%5cimage-20231201165826536.png alt=image-20231201165826536></p><p>åœ¨å®ç°ä¹‹å‰éœ€è¦ç†è§£ä¸€äº›å¯æ‹“å±•å“ˆå¸Œè¡¨ä¸­çš„æ¦‚å¿µï¼š[å‚è€ƒæ–‡çŒ®](<a href=https://www.geeksforgeeks.org/extendible-hashing-dynamic-approach-to-dbms/>Extendible Hashing (Dynamic approach to DBMS) - GeeksforGeeks</a>)</p><ul><li><strong>ç›®å½•dir</strong>ï¼šè¿™ä¸ªå®¹å™¨å­˜å‚¨æŒ‡å‘æ¡¶çš„æŒ‡é’ˆã€‚æ¯ä¸ªdirç»™å®šä¸€ä¸ªå”¯ä¸€çš„idï¼Œå½“æ‰©å¼ å‘ç”Ÿæ—¶<code>id</code>å¯èƒ½éšä¹‹æ”¹å˜ã€‚å“ˆå¸Œå‡½æ•°è¿”å›è¿™ä¸ªç›®å½•çš„idï¼Œè¿™ä¸ª<code>id</code>è¢«ç”¨æ¥æŒ‡å‘åˆé€‚çš„æ¡¶ã€‚dirçš„æ•°é‡ = 2^{å…¨å±€æ·±åº¦}</li><li><strong>æ¡¶:</strong> å­˜å‚¨å“ˆå¸Œé”®ã€‚ç›®å½•æŒ‡å‘æ¡¶ã€‚å¦‚æœå±€éƒ¨æ·±åº¦å°äºå…¨å±€æ·±åº¦æ—¶ï¼Œä¸€ä¸ªæ¡¶å¯èƒ½åŒ…å«ä¸æ­¢ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒã€‚</li><li><strong>å…¨å±€æ·±åº¦</strong>ï¼šå®ƒè·Ÿç›®å½•ç›¸å…³è”ã€‚å®ƒä»¬è¡¨ç¤ºå“ˆå¸Œå‡½æ•°ä½¿ç”¨çš„æ¯”ç‰¹ä½æ•°ç›®å»åˆ†ç±»è¿™äº›é”®ã€‚å…¨å±€æ·±åº¦=ç›®å½•idçš„æ¯”ç‰¹ä½æ•°</li><li><strong>å±€éƒ¨æ·±åº¦</strong>ï¼šå’Œå…¨å±€æ·±åº¦ç±»ä¼¼ï¼Œå±€éƒ¨æ·±åº¦æ˜¯è·Ÿæ¡¶å…³è”ï¼Œè€Œä¸æ˜¯è·Ÿç›®å½•ã€‚å½“æ¡¶æº¢å‡ºå‘ç”Ÿæ—¶ï¼Œå±€éƒ¨æ·±åº¦æ ¹æ®å…¨å±€æ·±åº¦å»å†³å®šæ‰§è¡Œçš„è¡Œä¸ºã€‚å±€éƒ¨æ·±åº¦é€šå¸¸å°äºç­‰äºå…¨å±€æ·±åº¦ã€‚</li><li><strong>æ¡¶åˆ†è£‚</strong>ï¼šå½“æ¡¶çš„å…ƒç´ è¶…è¿‡äº†ç‰¹å®šçš„å¤§å°ï¼Œé‚£ä¹ˆæ¡¶åˆ†è£‚æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚</li><li><strong>ç›®å½•æ‰©å®¹</strong>ï¼šå½“æ¡¶æº¢å‡ºæ—¶ï¼Œå¯èƒ½ä¼šæœ‰ç›®å½•æ‰©å®¹ã€‚å½“æº¢å‡ºæ¡¶çš„å±€éƒ¨æ·±åº¦ç­‰äºå…¨å±€æ·±åº¦æ—¶ï¼Œç›®å½•æ‰©å®¹è¢«æ‰§è¡Œã€‚</li></ul><p><img loading=lazy src=..%5cimage-20231201172128528.png alt=image-20231201172128528></p><p>é¦–å…ˆéœ€è¦å®ç°çš„æ˜¯Bucketï¼ŒBucketé‡‡ç”¨çš„std::list&lt;pair&lt;K,V&#187;æ¥ä½œä¸ºå­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œstlå¯ä»¥è®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„å®ç°æ•°æ®çš„å¢åˆ æŸ¥æ”¹ã€‚æŸ¥æ‰¾ä¸€ä¸ªkeyå¯ä»¥é€šè¿‡std::find_ifæˆ–è€…éå†è¿™ä¸ªlistï¼Œæ’å…¥æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦è¶…å‡ºè¿™ä¸ªæ¡¶çš„å¤§å°ã€‚</p><p>æœ‰äº†Bucketï¼Œå°±å¯ä»¥å¼€å§‹å®ç°æˆ‘ä»¬çš„å¯æ‹“å±•hashè¡¨ï¼Œå®ƒçš„å…¨å±€æ·±åº¦é¦–å…ˆè¢«åˆå§‹åŒ–ä¸º0ï¼Œç”±äºæ¡¶çš„æ•°é‡æ˜¯2^å…¨å±€æ·±åº¦ï¼Œæ‰€ä»¥åœ¨å¼€å§‹æ—¶åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œå³dirä¸­åªæœ‰ä¸€ä¸ªBucketæŒ‡é’ˆã€‚</p><p>é‡ç‚¹æ˜¯insertæ“ä½œ(æ’å…¥ä¸€ä¸ªkeyï¼Œvalueå¯¹)çš„å®ç°ã€‚é¦–å…ˆæ˜¯æ ¹æ®hashå‡½æ•°è®¡ç®—å‡ºkeyçš„dir indexï¼Œç„¶åå†åœ¨å¯¹åº”çš„æ¡¶ä¸­å®ç°æ’å…¥ã€‚åœ¨æ’å…¥åˆ°æ¡¶ä¸­æ—¶å¯èƒ½å› ä¸ºæ¡¶å·²æ»¡è€Œæ’å…¥å¤±è´¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œç›®å½•æ‰©å¼ å’Œæ¡¶åˆ†è£‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¹¶ä¸æ˜¯æ¡¶æ»¡äº†å°±éœ€è¦æ‰§è¡Œç›®å½•çš„åˆ†è£‚ï¼Œè€Œæ˜¯å½“æ¡¶çš„å±€éƒ¨æ·±åº¦=å…¨å±€æ·±åº¦æ—¶ï¼Œæ‰éœ€è¦è¿›è¡Œæ¡¶çš„åˆ†è£‚ã€‚åœ¨æ¡¶çš„å±€éƒ¨æ·±åº¦å°äºå…¨å±€æ·±åº¦æ—¶æ˜¯ä¸éœ€è¦æ‰©å¼ ç›®å½•çš„ï¼Œæ­¤æ—¶æ˜¯æœ‰å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ¡¶ï¼Œæˆ‘ä»¬åªéœ€è¦å†åˆ›å»ºä¸€ä¸ªæ–°æ¡¶ï¼Œç„¶åå†å°†è¿™ä¸ªå·²æ»¡æ¡¶ä¸­çš„å…ƒç´ é‡æ–°åˆ†é…å³å¯ï¼Œåˆ›å»ºæ–°æ¡¶éœ€è¦å°†å±€éƒ¨æ·±åº¦+1ã€‚åœ¨æ¡¶æ‰©å¼ æ—¶ï¼Œå°†æ–°æ‰©å¼ çš„dir(æ¡¶æŒ‡é’ˆ)æŒ‡å‘åŒä¸€ä¸ªæ¡¶ï¼Œå½“éœ€è¦æ—¶å†å»åˆ›å»ºæ–°çš„æ¡¶ã€‚</p><p>eg: global_depth = 2, local_depth = 2, dir_size = 2^2 = 4ï¼Œæ’å…¥kvåˆ°idx = 3 çš„æ¡¶ï¼Œä½†è¿™ä¸ªæ¡¶å·²ç»æ»¡äº†ã€‚åˆ™éœ€è¦æ‰§è¡Œdiræ‰©å¼ ï¼Œæ‰©å¼ ä¸ºåŸæ¥çš„2å€ï¼Œå³dir_size = 2^2* &#171; 1,æ‰©å¼ ä¸º8ã€‚idx = 3 = 011ï¼Œ3 + old_dir_size = 7 = 111ï¼Œ7çš„ä½ç½®åˆ™æ˜¯æ–°å»ºçš„æ¡¶ã€‚å…¶ä»–æ–°æ‰©å¼ åº”è¯¥æŒ‡å‘ä¹‹å‰çš„æ¡¶ï¼Œç­‰åˆ°ä¹‹é—´çš„æ¡¶æ»¡ï¼Œå†åˆ›å»ºã€‚å³4æŒ‡å‘0æŒ‡å‘çš„æ¡¶ï¼Œç­‰ç­‰ã€‚</p><p>ç”±äºæ˜¯è¦æ”¯æŒå¹¶å‘æ“ä½œçš„ï¼Œå› æ­¤ä¹Ÿéœ€è¦åœ¨åˆé€‚çš„åœ°æ–¹åŠ é”ã€‚</p><p>é€ æˆæ­»é”çš„ä¸€ç§æƒ…å†µï¼šå½“ä¸€ä¸ªå‡½æ•°ä¸­å·²ç»åŠ é”å†å»è°ƒç”¨å¦ä¸€ä¸ªéœ€è¦åŒä¸€æŠŠé”çš„å‡½æ•°ï¼Œè¿™ä¼šé€ æˆæ­»é”ã€‚</p><h3 id=lru_kæ›¿æ¢ç­–ç•¥>lru_kæ›¿æ¢ç­–ç•¥<a hidden class=anchor aria-hidden=true href=#lru_kæ›¿æ¢ç­–ç•¥>#</a></h3><p>åœ¨frameä¸­pageï¼Œåœ¨æ•´ä¸ªbuffer poolä¸­çš„æ‰€æœ‰frameéƒ½è¢«ä½¿ç”¨æ—¶ï¼Œè¿™æ—¶å€™åˆ™éœ€è¦é€‰æ‹©ä¸€ä¸ªvictimæ¥æ›¿æ¢ã€‚å¸¸ä½¿ç”¨çš„æ˜¯lruç®—æ³•ï¼Œlru_kåˆ™æ˜¯å†lruçš„åŸºç¡€ä¸Šå¤šåŠ äº†ä¸€ä¸ªè®¿é—®kæ¬¡ä»¥ä¸Šçš„é¡µï¼Œæ˜¯è¦æ¯”é‚£äº›å°äºkæ¬¡æ›´æ™šè¢«æ¢å‡ºã€‚ç®€å•çš„ç†è§£å°±æ˜¯ï¼Œå°†æ‰€æœ‰åœ¨frameä¸­çš„é¡µé¢åˆ†ä¸ºè®¿é—®å°äºkæ¬¡çš„å’Œå¤§äºç­‰äºkæ¬¡çš„ï¼Œä¸¤ç§éƒ½æ˜¯é‡‡ç”¨lruç®—æ³•ï¼Œä½†æ˜¯æ˜¯å…ˆæ›¿æ¢å°äºkæ¬¡çš„é¡µé¢ï¼Œå°äºkæ¬¡é¡µé¢çš„å…¨éƒ¨ä¸èƒ½è¢«æ›¿æ¢æˆ–è€…å½“æ²¡æœ‰å°äºkæ¬¡è¿˜éœ€è¦Evictä¸€ä¸ªpageæ—¶ï¼Œæ‰å»Evictä¸€ä¸ªå¤§äºkæ¬¡çš„é¡µé¢ã€‚</p><p>ä¸èƒ½è¢«æ›¿æ¢çš„pageæ˜¯é‚£äº›è¢«pinçš„ï¼Œä¹Ÿå°±æ˜¯è¿˜åœ¨ä½¿ç”¨çš„pageã€‚</p><p><code>std::vector&lt;LRUKFrameRecord *> frames_</code> è®°å½•buffer poolä¸­æ‰€æœ‰frameçš„ä¸€ä¸ªè®¿é—®è®°å½•ï¼Œ<code>LRUKFrameRecord</code> æ˜¯è®°å½•ä¸€ä¸ªframeçš„æœ€å¤škæ¬¡è®¿é—®è®°å½•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥setæ¥å°†æ‰€æœ‰å¯è¢«Evictçš„frameåˆ†ä¸ºå°äºkæ¬¡çš„ä¸€ä¸ªsetï¼Œå’Œå¤§äºç­‰äºkæ¬¡çš„ä¸€ä¸ªsetï¼Œå¹¶ä¸”é‡è½½<code>LRUKFrameRecord</code> çš„operator&lt;ï¼Œä½¿å…¶è®¿é—®æ—¶é—´æœ€æ—©çš„åœ¨setçš„æœ€å‰é¢ï¼ŒEvictæ—¶åˆ™é€‰æ‹©set.begind()çš„frameã€‚ä¸å¯è¢«Evictçš„frameä¸åº”è¯¥å‡ºç°åœ¨setä¸­ï¼Œä¸èƒ½è¢«lruçš„æœºåˆ¶æ‰€Evictã€‚</p><p>SetEvictableè¿™ä¸ªå‡½æ•°å°†ä¸€ä¸ªframeè®¾ç½®ä¸ºå¯ä¸å¯è¢«Evict, ä¸€ç§æƒ…å†µæ˜¯å°†ä¸å¯è¢«Evictè®¾ç½®ä¸ºå¯Evictï¼Œéœ€è¦å†å¯¹åº”çš„setä¸­åŠ å…¥ï¼›ä¸€ç§æ˜¯å¯Evictè®¾ç½®ä¸ºä¸å¯Evictï¼Œéœ€è¦å°†å…¶åœ¨å¯¹åº”çš„setä¸­ç§»é™¤ã€‚</p><h3 id=buffer_pool_manager_instance>buffer_pool_manager_instance<a hidden class=anchor aria-hidden=true href=#buffer_pool_manager_instance>#</a></h3><p>bpmåˆ™å°†ä¸Šé¢å®ç°çš„ç»„ä»¶ååŒèµ·æ¥å®ç°æ•´ä¸ªbuffer_poolçš„é€»è¾‘ã€‚</p><p>bpmç®¡ç†ç€ä¸€ä¸ª<code>std::list&lt;frame_id_t> free_list_</code>, è®°å½•ç€æœªè¢«ä½¿ç”¨çš„frameï¼Œfree_list_ä¸ºç©ºæ—¶ï¼Œåˆ™éœ€è¦ç”¨lru_kæ›¿æ¢ä¸€ä¸ªframeã€‚</p><p>NewPgImpéœ€è¦åœ¨buffer poolä¸­åˆ›å»ºpage_idçš„pageï¼Œå¦‚æœfree_list_ä¸ºç©ºæ—¶ï¼Œåˆ™éœ€è¦ç”¨lru_kæ›¿æ¢ä¸€ä¸ªframeã€‚æ›¿æ¢è¿™ä¸ªframeå¦‚æœä»–çš„çŠ¶æ€æ˜¯dirtyçš„ï¼Œåˆ™éœ€è¦è°ƒç”¨disk_managerå°†å…¶å†™å›ã€‚åˆ›å»ºæ–°pageåï¼Œéœ€è¦ç”¨hash tableè®°å½•å…¶å¯¹åº”çš„frameï¼Œä»¥åŠéœ€è¦è®°å½•è®¿é—®è®°å½•ä»¥ä¸Šlru_kæ›¿æ¢å™¨æ¥ç®¡ç†ã€‚</p><p>FetchPgImpåœ¨buffer poolä¸­è·å–æŒ‡å®špage_idçš„é¡µé¢ï¼Œå­˜åœ¨åˆ™ç›´æ¥è·å–ï¼ŒåŒæ—¶è®°å½•è®¿é—®å’Œpin++,å¹¶ä¸”è®¾ç½®ä¸å¯Evictã€‚è‹¥ä¸å­˜åœ¨ï¼Œåˆ™éœ€è¦åƒnewPageä¸€æ ·ã€‚</p><p>fetch å’Œ newpageçš„åŒºåˆ«æ˜¯ï¼šnewæ˜¯åœ¨buffer poolä¸­åŠ å…¥ä¸€ä¸ªæ–°çš„é¡µé¢ï¼Œè€Œfetchæ˜¯è·å¾—åœ¨buffer poolä¸­å·²æœ‰çš„é¡µé¢,æ²¡æœ‰å†å°è¯•evict a frame and read page_id page from disk</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://dueplay.github.io/tags/bustub/>Bustub</a></li></ul><nav class=paginav><a class=prev href=https://dueplay.github.io/posts/bustub-project2/><span class=title>Â« Prev</span><br><span>bustub project2</span>
</a><a class=next href=https://dueplay.github.io/posts/bustub-project0/><span class=title>Next Â»</span><br><span>bustub project0</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://dueplay.github.io/>Cookie's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>