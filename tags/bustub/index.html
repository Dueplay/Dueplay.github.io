<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Bustub | Cookie's Blog</title>
<meta name=keywords content><meta name=description content="ExampleSite description"><meta name=author content="Me"><link rel=canonical href=https://dueplay.github.io/tags/bustub/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as=style><link rel=icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://dueplay.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://dueplay.github.io/tags/bustub/index.xml><link rel=alternate hreflang=en href=https://dueplay.github.io/tags/bustub/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4XHWHM02GB"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4XHWHM02GB",{anonymize_ip:!1})}</script><meta property="og:title" content="Bustub"><meta property="og:description" content="ExampleSite description"><meta property="og:type" content="website"><meta property="og:url" content="https://dueplay.github.io/tags/bustub/"><meta property="og:image" content="https://dueplay.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dueplay.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Bustub"><meta name=twitter:description content="ExampleSite description"></head><body class=list id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://dueplay.github.io/ accesskey=h title="Home (Alt + H)">Home</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></span></div><ul id=menu><li><a href=https://dueplay.github.io/archives/ title=â±archives><span>â±archives</span></a></li><li><a href=https://dueplay.github.io/search/ title=ğŸ”Search><span>ğŸ”Search</span></a></li><li><a href=https://dueplay.github.io/tags/ title=ğŸ”–Tags><span>ğŸ”–Tags</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://dueplay.github.io/>Home</a>&nbsp;Â»&nbsp;<a href=https://dueplay.github.io/tags/>Tags</a></div><h1>Bustub
<a href=index.xml title=RSS aria-label=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" height="23"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></h1></header><article class="post-entry tag-entry"><header class=entry-header><h2>bustub project2</h2></header><div class=entry-content><p>å®éªŒä¸­ç»™å‡ºçš„ B+ æ ‘æ¥å£éå¸¸ç®€å•ï¼ŒåŸºæœ¬åªæœ‰æŸ¥è¯¢ã€æ’å…¥å’Œåˆ é™¤ä¸‰ä¸ªæ¥å£ï¼Œå†…éƒ¨åŸºæœ¬æ²¡æœ‰ç»™å‡ºåˆ«çš„è¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±å‘æŒ¥ï¼ˆæ— ä»ä¸‹æ‰‹ï¼‰ã€‚å› æ­¤ï¼Œä»»ä½•åˆæ³•çš„ B+ æ ‘å®ç°éƒ½æ˜¯å…è®¸çš„ã€‚
B+ æ ‘ç´¢å¼•åœ¨ Bustub ä¸­çš„ä½ç½®å¦‚å›¾æ‰€ç¤º:
B+æ ‘ç§éœ€è¦çš„pageéƒ½éœ€è¦ä½¿ç”¨åœ¨ Project 1 ä¸­å®ç°çš„ buffer pool manager æ¥è·å–ã€‚
Checkpoint1 Single Thread B+Tree Checkpoint1 åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š
Task1: B+Tree pagesï¼ŒB+æ ‘ä¸­çš„å„ç§ pageã€‚åœ¨ Bustub ç´¢å¼• B+ æ ‘ä¸­ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ª pageã€‚åŒ…å« leaf pageï¼Œinternal page ï¼Œå’Œå®ƒä»¬çš„çˆ¶ç±» tree pageã€‚ Task2ï¼šB+Tree Data Structure (Insertion, Deletion, Point Search)ã€‚Checkpoint1 çš„é‡ç‚¹ï¼Œå³ B+æ ‘çš„æ’å…¥ã€åˆ é™¤å’Œå•ç‚¹æŸ¥è¯¢ã€‚ Task1 B+Tree Pages task1 ä¸»è¦å®ç°leaf pageå’Œinternal pageè¿™ä¸¤ä¸ªç±»ï¼Œéƒ½ç»§æ‰¿è‡ªBPlusTreePageè¿™ä¸ªçˆ¶ç±»ï¼Œå®ç°ä¸€äº›Getterå’ŒSetteræ–¹æ³•ã€‚
é¦–å…ˆä»‹ç»ä¸€ä¸‹pageçš„å†…å­˜å¸ƒå±€
å…¶ä¸­ï¼Œdata_ æ˜¯å®é™…å­˜æ”¾ page æ•°æ®çš„åœ°æ–¹ï¼Œå¤§å°ä¸º BUSTUB_PAGE_SIZEï¼Œä¸º 4KBã€‚å…¶ä»–çš„æˆå‘˜æ˜¯ page çš„ metadataã€‚
B+æ ‘ä¸­çš„ tree page æ•°æ®å‡å­˜æ”¾åœ¨ page çš„ data æˆå‘˜ä¸­ï¼Œä¹Ÿå°±æ˜¯B+æ ‘ä¸­çš„èŠ‚ç‚¹æ˜¯Pageçš„dataæ•°æ®æˆå‘˜ã€‚...</p></div><footer class=entry-footer>&lt;span title='2023-12-10 18:12:01 +0800 +0800'>2023-12-10&lt;/span>&amp;nbsp;Â·&amp;nbsp;5 min&amp;nbsp;Â·&amp;nbsp;913 words&amp;nbsp;Â·&amp;nbsp;Me</footer><a class=entry-link aria-label="post link to bustub project2" href=https://dueplay.github.io/posts/bustub-project2/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>bustub project1</h2></header><div class=entry-content><p>buffer poolæ˜¯è´Ÿè´£åœ¨å†…å­˜å’Œç£ç›˜ä¹‹é—´ç§»åŠ¨é¡µé¢(æ•°æ®åº“æ–‡ä»¶æ˜¯ä»¥é¡µæ¥ç»„ç»‡çš„)ã€‚buffer poolçš„æ“ä½œå¯¹äºç³»ç»Ÿçš„å…¶ä»–ç»„ä»¶æ˜¯ é€æ˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿåªéœ€è¦ä½¿ç”¨ä¸€ä¸ªpage_idï¼ˆè¿™æ˜¯å”¯ä¸€çš„ï¼‰å»åƒbuffer poolè¯·æ±‚è¿™ä¸ªé¡µé¢ï¼Œæ˜¯ä¸çŸ¥é“è¿™ä¸ªé¡µæ˜¯ä¸æ˜¯å·²ç»åœ¨å†…å­˜ä¸­äº†ï¼Œè¿˜æ˜¯éœ€è¦ä»ç£ç›˜ä¸­è¯»ã€‚
å¯æ‹“å±•hash table ç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯éœ€è¦å®ç°ä¸€ä¸ªå¯æ‹“å±•hash tableï¼Œè¿™ä¸ªhash tableçš„ä½œç”¨æ˜¯è´Ÿè´£ç®¡ç†page_idåˆ°buffer poolä¸­é¡µé¢id(frame_id)çš„æ˜ å°„ã€‚buffer poolç®¡ç†Nä¸ªé¡µé¢çš„å†…å­˜ç©ºé—´ï¼Œä¸€ä¸ªé¡µé¢çš„å†…å­˜ç©ºé—´å°±å«åšframeã€‚éœ€è¦è¯»å–ä¸€ä¸ªé¡µé¢æ—¶ï¼Œå°±å°†ä¸€ä¸ªframeåˆ†é…è¿™ä¸ªé¡µé¢ï¼Œç„¶åç”¨hash tableè®°å½•è¿™ä¸ªæ˜ å°„å…³ç³»ã€‚
åœ¨å®ç°ä¹‹å‰éœ€è¦ç†è§£ä¸€äº›å¯æ‹“å±•å“ˆå¸Œè¡¨ä¸­çš„æ¦‚å¿µï¼š[å‚è€ƒæ–‡çŒ®](Extendible Hashing (Dynamic approach to DBMS) - GeeksforGeeks)
ç›®å½•dirï¼šè¿™ä¸ªå®¹å™¨å­˜å‚¨æŒ‡å‘æ¡¶çš„æŒ‡é’ˆã€‚æ¯ä¸ªdirç»™å®šä¸€ä¸ªå”¯ä¸€çš„idï¼Œå½“æ‰©å¼ å‘ç”Ÿæ—¶idå¯èƒ½éšä¹‹æ”¹å˜ã€‚å“ˆå¸Œå‡½æ•°è¿”å›è¿™ä¸ªç›®å½•çš„idï¼Œè¿™ä¸ªidè¢«ç”¨æ¥æŒ‡å‘åˆé€‚çš„æ¡¶ã€‚dirçš„æ•°é‡ = 2^{å…¨å±€æ·±åº¦} æ¡¶: å­˜å‚¨å“ˆå¸Œé”®ã€‚ç›®å½•æŒ‡å‘æ¡¶ã€‚å¦‚æœå±€éƒ¨æ·±åº¦å°äºå…¨å±€æ·±åº¦æ—¶ï¼Œä¸€ä¸ªæ¡¶å¯èƒ½åŒ…å«ä¸æ­¢ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒã€‚ å…¨å±€æ·±åº¦ï¼šå®ƒè·Ÿç›®å½•ç›¸å…³è”ã€‚å®ƒä»¬è¡¨ç¤ºå“ˆå¸Œå‡½æ•°ä½¿ç”¨çš„æ¯”ç‰¹ä½æ•°ç›®å»åˆ†ç±»è¿™äº›é”®ã€‚å…¨å±€æ·±åº¦=ç›®å½•idçš„æ¯”ç‰¹ä½æ•° å±€éƒ¨æ·±åº¦ï¼šå’Œå…¨å±€æ·±åº¦ç±»ä¼¼ï¼Œå±€éƒ¨æ·±åº¦æ˜¯è·Ÿæ¡¶å…³è”ï¼Œè€Œä¸æ˜¯è·Ÿç›®å½•ã€‚å½“æ¡¶æº¢å‡ºå‘ç”Ÿæ—¶ï¼Œå±€éƒ¨æ·±åº¦æ ¹æ®å…¨å±€æ·±åº¦å»å†³å®šæ‰§è¡Œçš„è¡Œä¸ºã€‚å±€éƒ¨æ·±åº¦é€šå¸¸å°äºç­‰äºå…¨å±€æ·±åº¦ã€‚ æ¡¶åˆ†è£‚ï¼šå½“æ¡¶çš„å…ƒç´ è¶…è¿‡äº†ç‰¹å®šçš„å¤§å°ï¼Œé‚£ä¹ˆæ¡¶åˆ†è£‚æˆä¸¤ä¸ªéƒ¨åˆ†ã€‚ ç›®å½•æ‰©å®¹ï¼šå½“æ¡¶æº¢å‡ºæ—¶ï¼Œå¯èƒ½ä¼šæœ‰ç›®å½•æ‰©å®¹ã€‚å½“æº¢å‡ºæ¡¶çš„å±€éƒ¨æ·±åº¦ç­‰äºå…¨å±€æ·±åº¦æ—¶ï¼Œç›®å½•æ‰©å®¹è¢«æ‰§è¡Œã€‚ é¦–å…ˆéœ€è¦å®ç°çš„æ˜¯Bucketï¼ŒBucketé‡‡ç”¨çš„std::list&lt;pair&lt;K,VÂ»æ¥ä½œä¸ºå­˜å‚¨æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œstlå¯ä»¥è®©æˆ‘ä»¬å¾ˆæ–¹ä¾¿çš„å®ç°æ•°æ®çš„å¢åˆ æŸ¥æ”¹ã€‚æŸ¥æ‰¾ä¸€ä¸ªkeyå¯ä»¥é€šè¿‡std::find_ifæˆ–è€…éå†è¿™ä¸ªlistï¼Œæ’å…¥æ—¶éœ€è¦åˆ¤æ–­æ˜¯å¦è¶…å‡ºè¿™ä¸ªæ¡¶çš„å¤§å°ã€‚
æœ‰äº†Bucketï¼Œå°±å¯ä»¥å¼€å§‹å®ç°æˆ‘ä»¬çš„å¯æ‹“å±•hashè¡¨ï¼Œå®ƒçš„å…¨å±€æ·±åº¦é¦–å…ˆè¢«åˆå§‹åŒ–ä¸º0ï¼Œç”±äºæ¡¶çš„æ•°é‡æ˜¯2^å…¨å±€æ·±åº¦ï¼Œæ‰€ä»¥åœ¨å¼€å§‹æ—¶åªæœ‰ä¸€ä¸ªæ¡¶ï¼Œå³dirä¸­åªæœ‰ä¸€ä¸ªBucketæŒ‡é’ˆã€‚
é‡ç‚¹æ˜¯insertæ“ä½œ(æ’å…¥ä¸€ä¸ªkeyï¼Œvalueå¯¹)çš„å®ç°ã€‚é¦–å…ˆæ˜¯æ ¹æ®hashå‡½æ•°è®¡ç®—å‡ºkeyçš„dir indexï¼Œç„¶åå†åœ¨å¯¹åº”çš„æ¡¶ä¸­å®ç°æ’å…¥ã€‚åœ¨æ’å…¥åˆ°æ¡¶ä¸­æ—¶å¯èƒ½å› ä¸ºæ¡¶å·²æ»¡è€Œæ’å…¥å¤±è´¥ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦è¿›è¡Œç›®å½•æ‰©å¼ å’Œæ¡¶åˆ†è£‚ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå¹¶ä¸æ˜¯æ¡¶æ»¡äº†å°±éœ€è¦æ‰§è¡Œç›®å½•çš„åˆ†è£‚ï¼Œè€Œæ˜¯å½“æ¡¶çš„å±€éƒ¨æ·±åº¦=å…¨å±€æ·±åº¦æ—¶ï¼Œæ‰éœ€è¦è¿›è¡Œæ¡¶çš„åˆ†è£‚ã€‚åœ¨æ¡¶çš„å±€éƒ¨æ·±åº¦å°äºå…¨å±€æ·±åº¦æ—¶æ˜¯ä¸éœ€è¦æ‰©å¼ ç›®å½•çš„ï¼Œæ­¤æ—¶æ˜¯æœ‰å¤šä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªæ¡¶ï¼Œæˆ‘ä»¬åªéœ€è¦å†åˆ›å»ºä¸€ä¸ªæ–°æ¡¶ï¼Œç„¶åå†å°†è¿™ä¸ªå·²æ»¡æ¡¶ä¸­çš„å…ƒç´ é‡æ–°åˆ†é…å³å¯ï¼Œåˆ›å»ºæ–°æ¡¶éœ€è¦å°†å±€éƒ¨æ·±åº¦+1ã€‚åœ¨æ¡¶æ‰©å¼ æ—¶ï¼Œå°†æ–°æ‰©å¼ çš„dir(æ¡¶æŒ‡é’ˆ)æŒ‡å‘åŒä¸€ä¸ªæ¡¶ï¼Œå½“éœ€è¦æ—¶å†å»åˆ›å»ºæ–°çš„æ¡¶ã€‚
eg: global_depth = 2, local_depth = 2, dir_size = 2^2 = 4ï¼Œæ’å…¥kvåˆ°idx = 3 çš„æ¡¶ï¼Œä½†è¿™ä¸ªæ¡¶å·²ç»æ»¡äº†ã€‚åˆ™éœ€è¦æ‰§è¡Œdiræ‰©å¼ ï¼Œæ‰©å¼ ä¸ºåŸæ¥çš„2å€ï¼Œå³dir_size = 2^2* Â« 1,æ‰©å¼ ä¸º8ã€‚idx = 3 = 011ï¼Œ3 + old_dir_size = 7 = 111ï¼Œ7çš„ä½ç½®åˆ™æ˜¯æ–°å»ºçš„æ¡¶ã€‚å…¶ä»–æ–°æ‰©å¼ åº”è¯¥æŒ‡å‘ä¹‹å‰çš„æ¡¶ï¼Œç­‰åˆ°ä¹‹é—´çš„æ¡¶æ»¡ï¼Œå†åˆ›å»ºã€‚å³4æŒ‡å‘0æŒ‡å‘çš„æ¡¶ï¼Œç­‰ç­‰ã€‚
ç”±äºæ˜¯è¦æ”¯æŒå¹¶å‘æ“ä½œçš„ï¼Œå› æ­¤ä¹Ÿéœ€è¦åœ¨åˆé€‚çš„åœ°æ–¹åŠ é”ã€‚
é€ æˆæ­»é”çš„ä¸€ç§æƒ…å†µï¼šå½“ä¸€ä¸ªå‡½æ•°ä¸­å·²ç»åŠ é”å†å»è°ƒç”¨å¦ä¸€ä¸ªéœ€è¦åŒä¸€æŠŠé”çš„å‡½æ•°ï¼Œè¿™ä¼šé€ æˆæ­»é”ã€‚
lru_kæ›¿æ¢ç­–ç•¥ åœ¨frameä¸­pageï¼Œåœ¨æ•´ä¸ªbuffer poolä¸­çš„æ‰€æœ‰frameéƒ½è¢«ä½¿ç”¨æ—¶ï¼Œè¿™æ—¶å€™åˆ™éœ€è¦é€‰æ‹©ä¸€ä¸ªvictimæ¥æ›¿æ¢ã€‚å¸¸ä½¿ç”¨çš„æ˜¯lruç®—æ³•ï¼Œlru_kåˆ™æ˜¯å†lruçš„åŸºç¡€ä¸Šå¤šåŠ äº†ä¸€ä¸ªè®¿é—®kæ¬¡ä»¥ä¸Šçš„é¡µï¼Œæ˜¯è¦æ¯”é‚£äº›å°äºkæ¬¡æ›´æ™šè¢«æ¢å‡ºã€‚ç®€å•çš„ç†è§£å°±æ˜¯ï¼Œå°†æ‰€æœ‰åœ¨frameä¸­çš„é¡µé¢åˆ†ä¸ºè®¿é—®å°äºkæ¬¡çš„å’Œå¤§äºç­‰äºkæ¬¡çš„ï¼Œä¸¤ç§éƒ½æ˜¯é‡‡ç”¨lruç®—æ³•ï¼Œä½†æ˜¯æ˜¯å…ˆæ›¿æ¢å°äºkæ¬¡çš„é¡µé¢ï¼Œå°äºkæ¬¡é¡µé¢çš„å…¨éƒ¨ä¸èƒ½è¢«æ›¿æ¢æˆ–è€…å½“æ²¡æœ‰å°äºkæ¬¡è¿˜éœ€è¦Evictä¸€ä¸ªpageæ—¶ï¼Œæ‰å»Evictä¸€ä¸ªå¤§äºkæ¬¡çš„é¡µé¢ã€‚
ä¸èƒ½è¢«æ›¿æ¢çš„pageæ˜¯é‚£äº›è¢«pinçš„ï¼Œä¹Ÿå°±æ˜¯è¿˜åœ¨ä½¿ç”¨çš„pageã€‚
std::vector&lt;LRUKFrameRecord *> frames_ è®°å½•buffer poolä¸­æ‰€æœ‰frameçš„ä¸€ä¸ªè®¿é—®è®°å½•ï¼ŒLRUKFrameRecord æ˜¯è®°å½•ä¸€ä¸ªframeçš„æœ€å¤škæ¬¡è®¿é—®è®°å½•ã€‚...</p></div><footer class=entry-footer>&lt;span title='2023-11-28 10:32:01 +0800 +0800'>2023-11-28&lt;/span>&amp;nbsp;Â·&amp;nbsp;1 min&amp;nbsp;Â·&amp;nbsp;102 words&amp;nbsp;Â·&amp;nbsp;Me</footer><a class=entry-link aria-label="post link to bustub project1" href=https://dueplay.github.io/posts/bustub-project1/></a></article><article class="post-entry tag-entry"><header class=entry-header><h2>bustub project0</h2></header><div class=entry-content><p>æ¦‚è§ˆ éœ€è¦å®ç°ä¸€ä¸ªæ•°æ®ç»“æ„ä¸ºTrieæ ‘çš„kvå­˜å‚¨ï¼ŒTrieä¸€ç§é«˜æ•ˆçš„æœ‰åºæ ‘æ•°æ®ç»“æ„ï¼Œç”¨äºæ£€ç´¢ç»™å®šé”®çš„å€¼ã€‚Trieä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨ä¸€ä¸ªkeyçš„å•ä¸ªå­—ç¬¦ï¼Œå¹¶ä¸”å¯ä»¥å¾ˆå¤šå­—èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹ä»£è¡¨keyçš„ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚keyçš„æœ«å°¾å­—ç¬¦çš„èŠ‚ç‚¹(ç»ˆç«¯èŠ‚ç‚¹)ä¼šç”¨ä¸€ä¸ªflagæ ‡è®°è¿™æ˜¯ä¸€ä¸ªkeyçš„ç»“æŸï¼Œå¹¶å­˜å‚¨ç›¸åº”çš„valã€‚
ä¸‹é¢è¿™ä¸ªTrieæ ‘ï¼Œæœ‰ab->1,ac->â€œvalâ€ï¼Œä¸¤ä¸ªkvå¯¹ï¼Œæ³¨æ„valå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚
å®ç° TrieNode TrieNodeç±»ä»£è¡¨æ ‘ä¸­çš„å•ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨ä¸€ä¸ªkeyä¸­çš„å•ä¸ªcharã€‚ä¸€ä¸ªTrieNodeå¯ä»¥æœ‰å¾ˆå¤šå­èŠ‚ç‚¹ï¼Œå› æ­¤ç”¨unordered_mapæ¥å­˜å‚¨æ¯ä¸ªå­èŠ‚ç‚¹çš„å­—ç¬¦å’Œå­èŠ‚ç‚¹æŒ‡é’ˆçš„æ˜ å°„ã€‚æ­¤å¤–è¿˜éœ€è¦ä¸€ä¸ªflagæ¥è¡¨ç¤ºè¯¥èŠ‚ç‚¹æ˜¯å¦æ˜¯ä¸€ä¸ªkeyçš„ç»“å°¾ã€‚ä¸ºäº†é¿å…å†…å­˜æ³„éœ²ï¼Œé‡‡ç”¨æ™ºèƒ½æŒ‡é’ˆã€‚
TrieNodeWithValue è¯¥ç±»ä»£è¡¨ä¸€ä¸ªkeyçš„ç»ˆç«¯èŠ‚ç‚¹ï¼Œå®ƒç»§æ‰¿äº†TrieNodeï¼Œå¹¶ä¸”å¢åŠ äº†è‡ªå·±ç‰¹æœ‰çš„å±æ€§ï¼Œå³éœ€è¦å­˜å‚¨çš„val.
å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼æ¥åˆ›å»ºç»ˆç«¯èŠ‚ç‚¹ï¼š
æ’å…¥ä¸€ä¸ªkeyï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç»ˆç«¯èŠ‚ç‚¹ã€‚ æ’å…¥ä¸€ä¸ªkeyï¼Œå°†éç»ˆç«¯èŠ‚ç‚¹è½¬æ¢ä¸ºç»ˆç«¯èŠ‚ç‚¹ï¼Œå³å°†TrieNodeè½¬ä¸ºTrieNodeWithValueã€‚å› æ­¤éœ€è¦ç»™è¯¥ç±»å®ç°ä¸€ä¸ªTrieNodeWithValue(TrieNode &&amp;trieNode, T value)æœ‰å‚æ„é€ ï¼Œç”¨äºå°†å·²æœ‰çš„éç»ˆç«¯èŠ‚ç‚¹è½¬ä¸ºç»ˆç«¯èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ„é€ éœ€è¦å»è°ƒç”¨TrieNodeçš„ç§»åŠ¨æ„é€ å°†trieNodeçš„èµ„æºè½¬ç§»åˆ°ç»ˆç«¯èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬è¡¨ç¤ºçš„å­—ç¬¦å’Œå­èŠ‚ç‚¹mapã€‚ Trie æˆå‘˜å˜é‡æœ‰rootèŠ‚ç‚¹çš„æŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªæ ¹èŠ‚ç‚¹(ç”¨å­—ç¬¦â€˜\0â€™æ ‡è¯†)ï¼›ä¸ºäº†æ”¯æŒå¹¶å‘ï¼Œè¿˜éœ€è¦ä¸€ä¸ªè¯»å†™é” ReaderWriterLatch latch_
éœ€è¦å®ç°å¢åˆ æŸ¥ä¸‰ä¸ªåŠŸèƒ½
Insert æ’å…¥ä¸€ä¸ªkvå¯¹åˆ°Trieä¸­ï¼Œä¸€ä¸ªkeyçš„æ¯ä¸ªå­—ç¬¦éƒ½æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤éœ€è¦åšçš„å°±æ˜¯ä»rootèŠ‚ç‚¹å¼€å§‹ï¼Œä¸€å±‚ä¸€å±‚çš„æ’å…¥æ–°èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰è¯¥å­—ç¬¦çš„èŠ‚ç‚¹äº†ï¼Œæˆ‘ä»¬åº”è¯¥é‡ç”¨å®ƒã€‚keyæœ€åä¸€ä¸ªå­—ç¬¦éœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨çˆ¶èŠ‚ç‚¹ä¸­æ’å…¥æ–°èŠ‚ç‚¹ã€‚
éœ€è¦åˆ¤æ–­æ˜¯å¦è¯¥ç»“å°¾å­—ç¬¦å·²ç»åœ¨Trieæ ‘ä¸­ï¼Œå¦‚æœæ˜¯ï¼Œå†åˆ¤æ–­è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯ä¸€ä¸ªç»ˆç«¯èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼Œåˆ™æ’å…¥å¤±è´¥ï¼Œå› ä¸ºä¸æ”¯æŒé‡å¤çš„keyï¼Œå¦‚æœä¸æ˜¯ç»ˆç«¯èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦å°†éç»ˆç«¯çš„TrieNodeè½¬ä¸ºç»ˆç«¯èŠ‚ç‚¹TrieNodeWithValueã€‚
å¦‚æœç»“å°¾å­—ç¬¦ä¸åœ¨Trieæ ‘ä¸­ï¼Œåˆ›å»ºæ–°çš„TrieNodeWithValueï¼Œç„¶åæ’å…¥åˆ°çˆ¶èŠ‚ç‚¹ä¸­ï¼Œæ’å…¥å®Œæˆã€‚
åŒæ—¶åœ¨Insertæ“ä½œä¸­ï¼Œåº”è¯¥æ˜¯ä¸Šå†™é”ï¼Œè¿”å›æ—¶åº”è¯¥è§£é”ã€‚
Remove ç§»é™¤ç»™å®škeyçš„valï¼ŒåŒæ—¶éœ€è¦åˆ é™¤ä¸€äº›æ²¡ç”¨èŠ‚ç‚¹ã€‚é¦–å…ˆæ˜¯æ ¹æ®è¿™ä¸ªkeyä»rootå¼€å§‹ä¸€å±‚ä¸€å±‚éå†ï¼Œæ‰¾åˆ°è¯¥keyçš„ç»ˆç«¯èŠ‚ç‚¹ï¼Œæ²¡æœ‰è¯¥keyå¯¹åº”çš„ç»ˆç«¯èŠ‚ç‚¹åˆ™ç›´æ¥è¿”å›falseã€‚æ‰¾åˆ°ç»ˆç«¯èŠ‚ç‚¹åï¼Œå°†å…¶flagè®¾ä¸ºfalseï¼Œè¡¨ç¤ºè¿™ä¸æ˜¯ä¸€ä¸ªç»ˆç«¯èŠ‚ç‚¹ï¼Œé€»è¾‘ä¸Šåˆ é™¤è¿™ä¸ªkvã€‚ä¸‹ä¸€æ­¥æˆ‘ä»¬éœ€è¦ä»è¯¥èŠ‚ç‚¹å¼€å§‹å‘ä¸Šé€’å½’çš„åˆ é™¤é‚£äº›æ²¡æœ‰ä»»ä½•å­èŠ‚ç‚¹çš„éç»ˆç«¯èŠ‚ç‚¹ï¼Œå› ä¸ºè¿™äº›èŠ‚ç‚¹è‚¯å®šæ˜¯ä¸å†ä¼šè¢«ç”¨åˆ°çš„ï¼Œæ—¢ä¸æ˜¯ä¸€ä¸ªkeyçš„ç»“å°¾ï¼Œä¹Ÿä¸æ˜¯ä¸€ä¸ªkeyçš„ä¸­é—´èŠ‚ç‚¹ã€‚å®ç°ä¸Šå¯ä»¥é€šè¿‡ä»rootå¼€å§‹å°†éå†åˆ°è¯¥èŠ‚ç‚¹çš„è·¯å¾„ä¿å­˜ï¼Œç„¶ååœ¨è·¯å¾„ä¸­ä»åå¾€å‰éå†æ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦å±äºè¿™ç§æƒ…å†µï¼Œæ˜¯åˆ™åœ¨å…¶çˆ¶èŠ‚ç‚¹çš„mapä¸­ç§»é™¤ã€‚
åŒæ ·çš„åœ¨Removeæ“ä½œä¸­ï¼Œåº”è¯¥æ˜¯ä¸Šå†™é”ï¼Œè¿”å›æ—¶åº”è¯¥è§£é”ã€‚
GetValue è¿”å›æŒ‡å®škeyå¯¹åº”çš„valï¼Œæ³¨æ„è¿™ä¸ªvalçš„ç±»å‹æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå‡½æ•°æ¨¡æ¿ã€‚è¿˜æ˜¯é¦–å…ˆä»æ ¹èŠ‚ç‚¹å¼€å§‹ä¸€å±‚ä¸€å±‚éå†keyçš„æ¯ä¸ªå­—ç¬¦æ‰¾åˆ°æœ€åä¸€ä¸ªå­—ç¬¦æ‰€åœ¨çš„èŠ‚ç‚¹ï¼Œç„¶åä¸æ˜¯ç»ˆç«¯èŠ‚ç‚¹æˆ–è€…æ²¡æœ‰è¯¥èŠ‚ç‚¹ï¼Œå¤±è´¥ç›´æ¥è¿”å›ã€‚æœ‰è¿™ä¸ªkeyæ‰€å¯¹åº”çš„ç»ˆç«¯èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¿”å›è¿™ä¸ªç»ˆç«¯èŠ‚ç‚¹çš„valã€‚è¿™æ ·å°±okäº†å—ï¼Ÿå…¶å®ä¸æ˜¯ï¼Œç”±äºvalæ˜¯ä»»æ„ç±»å‹çš„ï¼Œæ‰€ä»¥è¿˜éœ€è¦åˆ¤æ–­è¿™ä¸ªvalæ˜¯ä¸æ˜¯æˆ‘ä»¬æ‰€è¦çš„valç±»å‹ã€‚è¦æ£€æŸ¥è¿™ä¸¤ä¸ªç±»å‹æ˜¯å¦ç›¸åŒï¼Œå°†ç»ˆç«¯ TrieNode é€šè¿‡dynamic_castè½¬ä¸º TrieNodeWithValueã€‚ å¦‚æœè½¬æ¢ç»“æœä¸æ˜¯ nullptrï¼Œåˆ™ç±»å‹ T æ˜¯æ­£ç¡®çš„ç±»å‹ã€‚åœ¨ç±»å‹ä¸åŒ¹é…æ—¶ï¼Œå³ä½¿æœ‰keyæ‰€å¯¹åº”çš„ç»ˆç«¯èŠ‚ç‚¹ï¼Œä¹Ÿåº”è¯¥å¤±è´¥ç›´æ¥è¿”å›ã€‚åªæœ‰åœ¨ç±»å‹åŒ¹é…æ—¶ï¼Œæ‰æ­£ç¡®è¿”å›å…¶valã€‚
åŒæ ·çš„åœ¨GetValueæ“ä½œä¸­ï¼Œåº”è¯¥æ˜¯ä¸Šè¯»é”ï¼Œè¿”å›æ—¶åº”è¯¥è§£é”ã€‚
ReaderWriterLatch åœ¨c++ä¸­å¯ä»¥é€šè¿‡std::shared_mutex mutex_å¾ˆå®¹æ˜“å¾—å®ç°ä¸€ä¸ªè¯»å†™é”ã€‚åœ¨bustubä¸­å·²ç»æœ‰ä¸€ä¸ªå®ç°å¥½çš„è¯»å†™é”ï¼Œä¸Šå†™é”mutex_.lock() ,ä¸Šè¯»é”mutex_.lock_shared(),å¯¹åº”çš„è§£é”æ“ä½œåˆ†åˆ«æ˜¯ï¼šmutex_.unlock() å’Œmutex_.unlock_shared()ã€‚
æºç  //===----------------------------------------------------------------------===// // // BusTub // // p0_trie.h // // Identification: src/include/primer/p0_trie.h // // Copyright (c) 2015-2022, Carnegie Mellon University Database Group // //===----------------------------------------------------------------------===// #pragma once #include &lt;memory> #include &lt;stdexcept> #include &lt;string> #include &lt;unordered_map> #include &lt;utility> #include &lt;vector> #include "common/exception....</p></div><footer class=entry-footer>&lt;span title='2023-11-20 13:42:01 +0800 +0800'>2023-11-20&lt;/span>&amp;nbsp;Â·&amp;nbsp;10 min&amp;nbsp;Â·&amp;nbsp;2043 words&amp;nbsp;Â·&amp;nbsp;Me</footer><a class=entry-link aria-label="post link to bustub project0" href=https://dueplay.github.io/posts/bustub-project0/></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://dueplay.github.io/>Cookie's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>